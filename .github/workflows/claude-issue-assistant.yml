name: ğŸ¯ Claude Issue Assistant

on:
  issues:
    types: [opened, reopened, edited]
  issue_comment:
    types: [created]
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to process'
        required: true
        type: string

jobs:
  claude-assistant:
    runs-on: ubuntu-latest
    # Only run if issue mentions @claude or is manually triggered
    if: |
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'issues' && (
        contains(github.event.issue.body, '@claude') || 
        contains(github.event.issue.title, '@claude') ||
        contains(github.event.issue.labels.*.name, 'claude-assist')
      )) ||
      (github.event_name == 'issue_comment' && 
        contains(github.event.comment.body, '@claude'))
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      id-token: write
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ¤– Claude Issue Analysis & Resolution
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            ISSUE NUMBER: ${{ github.event.issue.number || github.event.inputs.issue_number }}

            ğŸ¯ **SafeWork ì´ìŠˆ ë¶„ì„ ë° í•´ê²° ì „ë¬¸ê°€**
            
            SafeWorkëŠ” Flask 3.0 ê¸°ë°˜ì˜ ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
            ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  ê°€ëŠ¥í•œ ê²½ìš° ì§ì ‘ í•´ê²°í•´ì£¼ì„¸ìš”.

            **ë¶„ì„ ë° ì²˜ë¦¬ ë‹¨ê³„:**

            **1. ì´ìŠˆ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ í‰ê°€**
            - ë²„ê·¸/ê¸°ëŠ¥ìš”ì²­/ê°œì„ ì‚¬í•­/ì§ˆë¬¸ ë¶„ë¥˜
            - Critical/High/Medium/Low ìš°ì„ ìˆœìœ„ ì„¤ì •
            - SafeWork ì‹œìŠ¤í…œ ì˜í–¥ë„ í‰ê°€

            **2. ê¸°ìˆ ì  ë¶„ì„**
            - Flask 3.0 ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì•„í‚¤í…ì²˜ ê´€ì 
            - SQLAlchemy 2.0 ë°ì´í„° ëª¨ë¸ ì˜í–¥ë„
            - Docker ì»¨í…Œì´ë„ˆ í™˜ê²½ ê³ ë ¤ì‚¬í•­
            - ì‚°ì—…ì•ˆì „ë³´ê±´ ë„ë©”ì¸ ë¡œì§ ê²€í† 

            **3. ìë™ í•´ê²° ê°€ëŠ¥í•œ ì´ìŠˆë“¤**
            - ì„¤ì • íŒŒì¼ ì˜¤ë¥˜ ìˆ˜ì •
            - ì½”ë“œ í¬ë§·íŒ… ë° ë¦°íŒ… ë¬¸ì œ
            - ê°„ë‹¨í•œ ë²„ê·¸ ìˆ˜ì •
            - ë¬¸ì„œí™” ê°œì„ 
            - í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€
            - ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
            - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆ˜ì •

            **4. ë³µì¡í•œ ì´ìŠˆ ì²˜ë¦¬**
            - ìƒì„¸í•œ ë¶„ì„ ë¦¬í¬íŠ¸ ì œê³µ
            - ë‹¨ê³„ë³„ í•´ê²° ë°©ì•ˆ ì œì‹œ
            - ê´€ë ¨ ì½”ë“œ íŒŒì¼ ë° ë¼ì¸ ì°¸ì¡°
            - í…ŒìŠ¤íŠ¸ ë°©ë²• ì œì•ˆ

            **5. SafeWork ë„ë©”ì¸ ì „ë¬¸ ì§€ì‹ í™œìš©**
            - ì„¤ë¬¸ì¡°ì‚¬ ì‹œìŠ¤í…œ (001 ê·¼ê³¨ê²©ê³„, 002 ì‹ ê·œì±„ìš©ì)
            - ì‚°ì—…ì•ˆì „ë³´ê±´ ê·œì • ì¤€ìˆ˜
            - ê°œì¸ì •ë³´ë³´í˜¸ ë° ì˜ë£Œì •ë³´ ì²˜ë¦¬
            - í•œêµ­ì–´ UI/UX ìµœì í™”

            ì´ìŠˆë¥¼ ì² ì €íˆ ë¶„ì„í•˜ê³ , ê°€ëŠ¥í•œ ê²½ìš° ì½”ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ Pull Requestë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.
            ë³µì¡í•œ ì´ìŠˆì˜ ê²½ìš° ë‹¨ê³„ë³„ í•´ê²° ë°©í–¥ì„ ì œì‹œí•´ì£¼ì„¸ìš”.

          claude_args: |
            --allowedTools "mcp__serena__*,mcp__sequential-thinking__*,mcp__shrimp-task-manager__*,mcp__github__*,Bash(gh issue:*),Bash(gh pr:*),Bash(git:*)"