name: ðŸ§ª Build Test

# Simple build test workflow to verify Docker builds work
concurrency:
  group: build-test-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch:
    inputs:
      test_service:
        description: 'Service to test (app, postgres, redis, or all)'
        required: false
        default: 'all'
        type: choice
        options:
          - 'all'
          - 'app'
          - 'postgres'
          - 'redis'

permissions:
  contents: read
  packages: write

jobs:
  build-test:
    name: ðŸ”¨ Build Test
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ðŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: ðŸ³ Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ðŸ” Test PostgreSQL Build
        if: ${{ inputs.test_service == 'all' || inputs.test_service == 'postgres' }}
        run: |
          echo "ðŸ” Testing PostgreSQL Docker build..."
          docker build ./postgres -t test-postgres:latest
          echo "âœ… PostgreSQL build successful"

      - name: ðŸ” Test Redis Build
        if: ${{ inputs.test_service == 'all' || inputs.test_service == 'redis' }}
        run: |
          echo "ðŸ” Testing Redis Docker build..."
          docker build ./redis -t test-redis:latest
          echo "âœ… Redis build successful"

      - name: ðŸ” Test App Build
        if: ${{ inputs.test_service == 'all' || inputs.test_service == 'app' }}
        run: |
          echo "ðŸ” Testing Flask App Docker build..."
          docker build ./app -t test-app:latest
          echo "âœ… App build successful"

      - name: ðŸ“Š Build Test Summary
        run: |
          echo "# ðŸ§ª Build Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## âœ… All Docker builds completed successfully" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Service:** ${{ inputs.test_service || 'all' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** Success" >> $GITHUB_STEP_SUMMARY
          echo "- **Time:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY