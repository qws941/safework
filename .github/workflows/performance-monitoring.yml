name: SafeWork Performance Monitoring

on:
  schedule:
    - cron: '0 */4 * * *'  # 4ì‹œê°„ë§ˆë‹¤ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
    - cron: '0 9 * * 1'    # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ ìƒì„¸ ë¦¬í¬íŠ¸
  workflow_dispatch:
    inputs:
      monitoring_type:
        description: 'ëª¨ë‹ˆí„°ë§ ìœ í˜•'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - api_performance
          - database_performance
          - load_test
          - health_check
      duration_minutes:
        description: 'ëª¨ë‹ˆí„°ë§ ì§€ì† ì‹œê°„ (ë¶„)'
        required: false
        default: '10'
        type: string

env:
  SAFEWORK_BASE_URL: https://safework.jclee.me
  MONITORING_TIMEOUT: 30
  MAX_RESPONSE_TIME: 3000  # 3ì´ˆ

jobs:
  # ğŸš€ API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  api-performance-test:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    outputs:
      api_performance_score: ${{ steps.api_test.outputs.performance_score }}
      critical_endpoints_failed: ${{ steps.api_test.outputs.critical_failed }}
      
    steps:
      - name: ğŸš€ SafeWork API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        id: api_test
        run: |
          echo "ğŸš€ SafeWork API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘..."
          echo "â° í…ŒìŠ¤íŠ¸ ì‹œì‘: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          
          # API ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
          declare -A API_ENDPOINTS=(
            ["homepage"]="/"
            ["health"]="/health"
            ["survey_001"]="/survey/001"
            ["survey_002"]="/survey/002" 
            ["admin_login"]="/auth/login"
            ["admin_dashboard"]="/admin"
            ["api_workers"]="/api/safework/v2/workers"
            ["api_health_checks"]="/api/safework/v2/health-checks"
            ["api_statistics"]="/api/safework/v2/statistics"
          )
          
          TOTAL_SCORE=0
          TESTED_COUNT=0
          FAILED_ENDPOINTS=()
          CRITICAL_FAILED=false
          
          echo "ğŸ” API ì—”ë“œí¬ì¸íŠ¸ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸:"
          
          for endpoint_name in "${!API_ENDPOINTS[@]}"; do
            endpoint_path="${API_ENDPOINTS[$endpoint_name]}"
            full_url="${{ env.SAFEWORK_BASE_URL }}$endpoint_path"
            
            echo "ğŸ“Š í…ŒìŠ¤íŠ¸ ì¤‘: $endpoint_name ($endpoint_path)"
            
            # ì‘ë‹µ ì‹œê°„ ì¸¡ì • (3ë²ˆ ì‹œë„)
            RESPONSE_TIMES=()
            SUCCESS_COUNT=0
            
            for i in {1..3}; do
              start_time=$(date +%s%N)
              response_code=$(curl -s -o /dev/null -w "%{http_code}" \
                --connect-timeout ${{ env.MONITORING_TIMEOUT }} \
                --max-time ${{ env.MONITORING_TIMEOUT }} \
                "$full_url" || echo "000")
              end_time=$(date +%s%N)
              
              response_time_ms=$(( (end_time - start_time) / 1000000 ))
              
              if [ "$response_code" -eq 200 ] || [ "$response_code" -eq 302 ] || [ "$response_code" -eq 401 ]; then
                RESPONSE_TIMES+=($response_time_ms)
                SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
                echo "  âœ“ ì‹œë„ $i: ${response_time_ms}ms (HTTP $response_code)"
              else
                echo "  âœ— ì‹œë„ $i: ì‹¤íŒ¨ (HTTP $response_code)"
              fi
            done
            
            # í‰ê·  ì‘ë‹µ ì‹œê°„ ê³„ì‚°
            if [ $SUCCESS_COUNT -gt 0 ]; then
              total_time=0
              for time in "${RESPONSE_TIMES[@]}"; do
                total_time=$((total_time + time))
              done
              avg_time=$((total_time / SUCCESS_COUNT))
              
              # ì„±ëŠ¥ ì ìˆ˜ ê³„ì‚° (ì‘ë‹µì‹œê°„ ê¸°ì¤€)
              if [ $avg_time -lt 1000 ]; then
                endpoint_score=100
                echo "  ğŸŸ¢ í‰ê· : ${avg_time}ms (ìš°ìˆ˜)"
              elif [ $avg_time -lt 2000 ]; then
                endpoint_score=80
                echo "  ğŸŸ¡ í‰ê· : ${avg_time}ms (ì–‘í˜¸)"
              elif [ $avg_time -lt ${{ env.MAX_RESPONSE_TIME }} ]; then
                endpoint_score=60
                echo "  ğŸŸ  í‰ê· : ${avg_time}ms (ë³´í†µ)"
              else
                endpoint_score=30
                echo "  ğŸ”´ í‰ê· : ${avg_time}ms (ëŠë¦¼)"
              fi
              
              TOTAL_SCORE=$((TOTAL_SCORE + endpoint_score))
              TESTED_COUNT=$((TESTED_COUNT + 1))
              
            else
              echo "  âŒ $endpoint_name ì™„ì „ ì‹¤íŒ¨"
              FAILED_ENDPOINTS+=("$endpoint_name")
              
              # ì¤‘ìš” ì—”ë“œí¬ì¸íŠ¸ ì‹¤íŒ¨ ì²´í¬
              if [[ "$endpoint_name" == "health" || "$endpoint_name" == "homepage" || "$endpoint_name" == "survey_001" ]]; then
                CRITICAL_FAILED=true
              fi
            fi
          done
          
          # ì „ì²´ ì„±ëŠ¥ ì ìˆ˜ ê³„ì‚°
          if [ $TESTED_COUNT -gt 0 ]; then
            OVERALL_SCORE=$((TOTAL_SCORE / TESTED_COUNT))
          else
            OVERALL_SCORE=0
          fi
          
          echo "ğŸ“Š API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼:"
          echo "  - í…ŒìŠ¤íŠ¸ëœ ì—”ë“œí¬ì¸íŠ¸: $TESTED_COUNTê°œ"
          echo "  - ì‹¤íŒ¨í•œ ì—”ë“œí¬ì¸íŠ¸: ${#FAILED_ENDPOINTS[@]}ê°œ"
          echo "  - ì „ì²´ ì„±ëŠ¥ ì ìˆ˜: $OVERALL_SCORE/100"
          
          if [ ${#FAILED_ENDPOINTS[@]} -gt 0 ]; then
            echo "  - ì‹¤íŒ¨ ëª©ë¡: ${FAILED_ENDPOINTS[*]}"
          fi
          
          echo "performance_score=$OVERALL_SCORE" >> $GITHUB_OUTPUT
          echo "critical_failed=$CRITICAL_FAILED" >> $GITHUB_OUTPUT
          echo "failed_endpoints=${FAILED_ENDPOINTS[*]}" >> $GITHUB_OUTPUT

  # ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (ê°„ì ‘)
  database-health-check:
    runs-on: ubuntu-latest 
    timeout-minutes: 15
    
    outputs:
      db_performance_score: ${{ steps.db_test.outputs.db_score }}
      
    steps:
      - name: ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ê°„ì ‘ í…ŒìŠ¤íŠ¸
        id: db_test
        run: |
          echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ê°„ì ‘ í…ŒìŠ¤íŠ¸..."
          
          # APIë¥¼ í†µí•œ ë°ì´í„°ë² ì´ìŠ¤ ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸
          DB_ENDPOINTS=(
            "/api/safework/v2/workers"
            "/api/safework/v2/health-checks"
            "/api/safework/v2/statistics" 
            "/survey/001"
            "/admin"
          )
          
          TOTAL_DB_SCORE=0
          TESTED_DB_COUNT=0
          
          for endpoint in "${DB_ENDPOINTS[@]}"; do
            echo "ğŸ” DB ì—°ë™ í…ŒìŠ¤íŠ¸: $endpoint"
            
            start_time=$(date +%s%N)
            response_code=$(curl -s -o /dev/null -w "%{http_code}" \
              --connect-timeout 15 \
              --max-time 15 \
              "${{ env.SAFEWORK_BASE_URL }}$endpoint" || echo "000")
            end_time=$(date +%s%N)
            
            response_time_ms=$(( (end_time - start_time) / 1000000 ))
            
            if [ "$response_code" -eq 200 ] || [ "$response_code" -eq 302 ] || [ "$response_code" -eq 401 ]; then
              # DB ì‘ë‹µ ì‹œê°„ ê¸°ì¤€ ì ìˆ˜
              if [ $response_time_ms -lt 2000 ]; then
                db_score=100
                echo "  ğŸŸ¢ DB ì‘ë‹µ: ${response_time_ms}ms (ìš°ìˆ˜)"
              elif [ $response_time_ms -lt 4000 ]; then
                db_score=80
                echo "  ğŸŸ¡ DB ì‘ë‹µ: ${response_time_ms}ms (ì–‘í˜¸)"
              elif [ $response_time_ms -lt 6000 ]; then
                db_score=60
                echo "  ğŸŸ  DB ì‘ë‹µ: ${response_time_ms}ms (ë³´í†µ)"
              else
                db_score=40
                echo "  ğŸ”´ DB ì‘ë‹µ: ${response_time_ms}ms (ëŠë¦¼)"
              fi
              
              TOTAL_DB_SCORE=$((TOTAL_DB_SCORE + db_score))
              TESTED_DB_COUNT=$((TESTED_DB_COUNT + 1))
            else
              echo "  âŒ DB ì—°ë™ ì‹¤íŒ¨: HTTP $response_code"
            fi
          done
          
          if [ $TESTED_DB_COUNT -gt 0 ]; then
            OVERALL_DB_SCORE=$((TOTAL_DB_SCORE / TESTED_DB_COUNT))
          else
            OVERALL_DB_SCORE=0
          fi
          
          echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ì ìˆ˜: $OVERALL_DB_SCORE/100"
          echo "db_score=$OVERALL_DB_SCORE" >> $GITHUB_OUTPUT

  # ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ (ê°€ë²¼ìš´ ìˆ˜ì¤€)
  light-load-test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    outputs:
      load_test_score: ${{ steps.load_test.outputs.load_score }}
      
    steps:
      - name: ğŸ“Š SafeWork ê°€ë²¼ìš´ ë¶€í•˜ í…ŒìŠ¤íŠ¸
        id: load_test
        run: |
          echo "ğŸ“Š SafeWork ê°€ë²¼ìš´ ë¶€í•˜ í…ŒìŠ¤íŠ¸..."
          
          # ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ (5ê°œ ë™ì‹œ ì—°ê²°)
          TEST_URL="${{ env.SAFEWORK_BASE_URL }}/health"
          CONCURRENT_REQUESTS=5
          TOTAL_REQUESTS=20
          
          echo "ğŸ”„ ë™ì‹œì„± í…ŒìŠ¤íŠ¸: $CONCURRENT_REQUESTS ë™ì‹œ ì—°ê²°, ì´ $TOTAL_REQUESTS ìš”ì²­"
          
          SUCCESS_COUNT=0
          TOTAL_TIME=0
          
          # ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          for batch in $(seq 1 $((TOTAL_REQUESTS / CONCURRENT_REQUESTS))); do
            echo "ğŸ“Š ë°°ì¹˜ $batch ì‹¤í–‰ ì¤‘..."
            
            # ë°±ê·¸ë¼ìš´ë“œë¡œ ë™ì‹œ ìš”ì²­ ì‹¤í–‰
            PIDS=()
            START_TIME=$(date +%s%N)
            
            for i in $(seq 1 $CONCURRENT_REQUESTS); do
              (
                response_code=$(curl -s -o /dev/null -w "%{http_code}" \
                  --connect-timeout 10 --max-time 10 \
                  "$TEST_URL" || echo "000")
                if [ "$response_code" -eq 200 ]; then
                  echo "SUCCESS"
                else
                  echo "FAILED:$response_code"
                fi
              ) &
              PIDS+=($!)
            done
            
            # ëª¨ë“  ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°
            SUCCESS_IN_BATCH=0
            for pid in "${PIDS[@]}"; do
              result=$(wait $pid && echo "SUCCESS" || echo "FAILED")
              if [ "$result" = "SUCCESS" ]; then
                SUCCESS_IN_BATCH=$((SUCCESS_IN_BATCH + 1))
              fi
            done
            
            END_TIME=$(date +%s%N)
            BATCH_TIME=$(( (END_TIME - START_TIME) / 1000000 ))
            
            SUCCESS_COUNT=$((SUCCESS_COUNT + SUCCESS_IN_BATCH))
            TOTAL_TIME=$((TOTAL_TIME + BATCH_TIME))
            
            echo "  âœ“ ë°°ì¹˜ $batch: $SUCCESS_IN_BATCH/$CONCURRENT_REQUESTS ì„±ê³µ, ${BATCH_TIME}ms"
            
            # ë°°ì¹˜ ê°„ ì§§ì€ íœ´ì‹
            sleep 2
          done
          
          # ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
          SUCCESS_RATE=$((SUCCESS_COUNT * 100 / TOTAL_REQUESTS))
          AVG_BATCH_TIME=$((TOTAL_TIME / (TOTAL_REQUESTS / CONCURRENT_REQUESTS)))
          
          echo "ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼:"
          echo "  - ì´ ìš”ì²­: $TOTAL_REQUESTSê°œ"
          echo "  - ì„±ê³µ ìš”ì²­: $SUCCESS_COUNTê°œ"
          echo "  - ì„±ê³µë¥ : $SUCCESS_RATE%"
          echo "  - í‰ê·  ë°°ì¹˜ ì‹œê°„: ${AVG_BATCH_TIME}ms"
          
          # ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì ìˆ˜ ê³„ì‚°
          if [ $SUCCESS_RATE -ge 95 ] && [ $AVG_BATCH_TIME -lt 3000 ]; then
            LOAD_SCORE=100
            echo "  ğŸŸ¢ ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥: ìš°ìˆ˜"
          elif [ $SUCCESS_RATE -ge 90 ] && [ $AVG_BATCH_TIME -lt 5000 ]; then
            LOAD_SCORE=80
            echo "  ğŸŸ¡ ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥: ì–‘í˜¸"
          elif [ $SUCCESS_RATE -ge 80 ] && [ $AVG_BATCH_TIME -lt 8000 ]; then
            LOAD_SCORE=60
            echo "  ğŸŸ  ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥: ë³´í†µ"
          else
            LOAD_SCORE=40
            echo "  ğŸ”´ ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥: ê°œì„  í•„ìš”"
          fi
          
          echo "load_score=$LOAD_SCORE" >> $GITHUB_OUTPUT

  # ğŸ“ˆ ì¢…í•© ì„±ëŠ¥ ë¦¬í¬íŠ¸ ë° ì•Œë¦¼
  performance-report:
    needs: [api-performance-test, database-health-check, light-load-test]
    if: always()
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“ˆ SafeWork ì¢…í•© ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
        id: report
        run: |
          echo "ğŸ“ˆ SafeWork ì¢…í•© ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±..."
          echo "â° ë¦¬í¬íŠ¸ ìƒì„± ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          
          # ì„±ëŠ¥ ì ìˆ˜ ìˆ˜ì§‘
          API_SCORE="${{ needs.api-performance-test.outputs.api_performance_score }}"
          DB_SCORE="${{ needs.database-health-check.outputs.db_performance_score }}"
          LOAD_SCORE="${{ needs.light-load-test.outputs.load_test_score }}"
          
          echo "ğŸ“Š ê°œë³„ ì„±ëŠ¥ ì ìˆ˜:"
          echo "  - API ì„±ëŠ¥: ${API_SCORE:-0}/100"
          echo "  - DB ì„±ëŠ¥: ${DB_SCORE:-0}/100"
          echo "  - ë¶€í•˜ ì²˜ë¦¬: ${LOAD_SCORE:-0}/100"
          
          # ì „ì²´ ì„±ëŠ¥ ì ìˆ˜ ê³„ì‚° (ê°€ì¤‘í‰ê· )
          API_WEIGHT=40
          DB_WEIGHT=35
          LOAD_WEIGHT=25
          
          TOTAL_SCORE=$(( (API_SCORE * API_WEIGHT + DB_SCORE * DB_WEIGHT + LOAD_SCORE * LOAD_WEIGHT) / 100 ))
          
          echo "ğŸ¯ ì „ì²´ ì„±ëŠ¥ ì ìˆ˜: $TOTAL_SCORE/100"
          
          # ì„±ëŠ¥ ë“±ê¸‰ ê²°ì •
          if [ $TOTAL_SCORE -ge 90 ]; then
            GRADE="A"
            GRADE_DESC="ìš°ìˆ˜"
            GRADE_COLOR="ğŸŸ¢"
          elif [ $TOTAL_SCORE -ge 80 ]; then
            GRADE="B" 
            GRADE_DESC="ì–‘í˜¸"
            GRADE_COLOR="ğŸŸ¡"
          elif [ $TOTAL_SCORE -ge 70 ]; then
            GRADE="C"
            GRADE_DESC="ë³´í†µ"
            GRADE_COLOR="ğŸŸ "
          else
            GRADE="D"
            GRADE_DESC="ê°œì„  í•„ìš”"
            GRADE_COLOR="ğŸ”´"
          fi
          
          echo "$GRADE_COLOR ì„±ëŠ¥ ë“±ê¸‰: $GRADE ($GRADE_DESC)"
          
          # ì¤‘ìš”í•œ ë¬¸ì œ í™•ì¸
          CRITICAL_ISSUES=()
          if [ "${{ needs.api-performance-test.outputs.critical_endpoints_failed }}" = "true" ]; then
            CRITICAL_ISSUES+=("ì¤‘ìš” API ì—”ë“œí¬ì¸íŠ¸ ì‹¤íŒ¨")
          fi
          
          if [ $API_SCORE -lt 60 ]; then
            CRITICAL_ISSUES+=("API ì„±ëŠ¥ ì €í•˜")
          fi
          
          if [ $DB_SCORE -lt 60 ]; then
            CRITICAL_ISSUES+=("ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ì €í•˜")
          fi
          
          if [ $LOAD_SCORE -lt 60 ]; then
            CRITICAL_ISSUES+=("ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥ ì €í•˜")
          fi
          
          echo "performance_grade=$GRADE" >> $GITHUB_OUTPUT
          echo "total_score=$TOTAL_SCORE" >> $GITHUB_OUTPUT
          echo "critical_issues_count=${#CRITICAL_ISSUES[@]}" >> $GITHUB_OUTPUT
          
          if [ ${#CRITICAL_ISSUES[@]} -gt 0 ]; then
            echo "ğŸš¨ ì¤‘ìš” ì„±ëŠ¥ ì´ìŠˆ ${#CRITICAL_ISSUES[@]}ê±´ ë°œê²¬:"
            printf '  - %s\n' "${CRITICAL_ISSUES[@]}"
            echo "PERFORMANCE_ALERT=true" >> $GITHUB_ENV
          else
            echo "âœ… ì¤‘ìš” ì„±ëŠ¥ ì´ìŠˆ ì—†ìŒ"
          fi

      - name: ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        run: |
          echo "ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸..."
          
          # ì„±ëŠ¥ íˆìŠ¤í† ë¦¬ ë¡œê·¸ ìƒì„± (êµ¬ì¡°í™”ëœ í˜•íƒœ)
          echo "PERFORMANCE_LOG|$(date -u +%Y-%m-%dT%H:%M:%SZ)|${{ steps.report.outputs.total_score }}|${{ steps.report.outputs.performance_grade }}|API:${{ needs.api-performance-test.outputs.api_performance_score }}|DB:${{ needs.database-health-check.outputs.db_performance_score }}|LOAD:${{ needs.light-load-test.outputs.load_test_score }}"
          
          # ì„±ëŠ¥ íŠ¸ë Œë“œ ë¶„ì„ì„ ìœ„í•œ ë©”íŠ¸ë¦­ ì €ì¥
          echo "ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê¸°ë¡ ì™„ë£Œ"

      - name: ğŸš¨ ì„±ëŠ¥ ì €í•˜ ì•Œë¦¼ ì´ìŠˆ ìƒì„±
        if: env.PERFORMANCE_ALERT == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const currentTime = new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'});
            
            const performanceIssue = {
              title: 'ğŸ“‰ [ì„±ëŠ¥ì €í•˜] SafeWork ì‹œìŠ¤í…œ ì„±ëŠ¥ ë¬¸ì œ ê°ì§€',
              body: `
            # ğŸ“‰ SafeWork ì„±ëŠ¥ ì €í•˜ ê°ì§€ë¨
            
            **â° ê°ì§€ ì‹œê°„:** ${currentTime}
            **ğŸ¯ ì „ì²´ ì„±ëŠ¥ ì ìˆ˜:** ${{ steps.report.outputs.total_score }}/100 (ë“±ê¸‰: ${{ steps.report.outputs.performance_grade }})
            **ğŸš¨ ì¤‘ìš” ì´ìŠˆ:** ${{ steps.report.outputs.critical_issues_count }}ê±´
            
            ## ğŸ“Š ì„¸ë¶€ ì„±ëŠ¥ ë¶„ì„
            
            ### ğŸš€ API ì„±ëŠ¥
            - **ì ìˆ˜:** ${{ needs.api-performance-test.outputs.api_performance_score }}/100
            - **ì¤‘ìš” ì—”ë“œí¬ì¸íŠ¸ ì‹¤íŒ¨:** ${{ needs.api-performance-test.outputs.critical_endpoints_failed }}
            - **ì‹¤íŒ¨ ì—”ë“œí¬ì¸íŠ¸:** ${{ needs.api-performance-test.outputs.failed_endpoints }}
            
            ### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥  
            - **ì ìˆ˜:** ${{ needs.database-health-check.outputs.db_performance_score }}/100
            - **ìƒíƒœ:** DB ì—°ë™ API ì‘ë‹µ ì‹œê°„ ê¸°ë°˜ ì¸¡ì •
            
            ### ğŸ“Š ë¶€í•˜ ì²˜ë¦¬ ëŠ¥ë ¥
            - **ì ìˆ˜:** ${{ needs.light-load-test.outputs.load_test_score }}/100
            - **ë™ì‹œ ì—°ê²°:** 5ê°œ ì—°ê²°ë¡œ í…ŒìŠ¤íŠ¸
            
            ## ğŸ¯ ê¶Œì¥ ì¡°ì¹˜ì‚¬í•­
            
            ### ì¦‰ì‹œ í™•ì¸ í•„ìš” (1-2ì‹œê°„ ë‚´)
            - [ ] **ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸**: https://safework.jclee.me/health
            - [ ] **ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ê²€**: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ë¥ 
            - [ ] **ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ**: MySQL ì—°ê²° ë° ì¿¼ë¦¬ ì„±ëŠ¥
            - [ ] **Redis ìºì‹œ ìƒíƒœ**: ìºì‹œ íˆíŠ¸ìœ¨ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
            
            ### ë‹¨ê¸° ê°œì„  ë°©ì•ˆ (1-3ì¼ ë‚´)  
            - [ ] **SQL ì¿¼ë¦¬ ìµœì í™”**: ëŠë¦° ì¿¼ë¦¬ ì‹ë³„ ë° ê°œì„ 
            - [ ] **ì¸ë±ìŠ¤ ìµœì í™”**: ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²€ìƒ‰ ì¡°ê±´ì— ì¸ë±ìŠ¤ ì¶”ê°€
            - [ ] **ìºì‹œ ì „ëµ ê°œì„ **: Redis ìºì‹± íŒ¨í„´ ìµœì í™”
            - [ ] **API ì‘ë‹µ ìµœì í™”**: ë¶ˆí•„ìš”í•œ ë°ì´í„° ì „ì†¡ ì œê±°
            
            ### ì¤‘ê¸° ìµœì í™” (1-2ì£¼ ë‚´)
            - [ ] **ì½”ë“œ í”„ë¡œíŒŒì¼ë§**: ì„±ëŠ¥ ë³‘ëª© ì§€ì  ì‹ë³„
            - [ ] **ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ìµœì í™”**: ì •ê·œí™” ë° íŒŒí‹°ì…”ë‹ ê²€í† 
            - [ ] **CDN ë„ì…**: ì •ì  ìì› ë¡œë”© ì†ë„ ê°œì„ 
            - [ ] **ë¡œë“œë°¸ëŸ°ì‹±**: íŠ¸ë˜í”½ ë¶„ì‚° ê³ ë ¤
            
            ## ğŸ“ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë§í¬
            
            - **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: https://safework.jclee.me/health
            - **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ**: https://safework.jclee.me/admin
            - **API ìƒíƒœ**: https://safework.jclee.me/api/safework/v2
            
            ## ğŸ¤– ìë™í™” ì§€ì›
            
            **ì¦‰ì‹œ ë¶„ì„ ìš”ì²­:** @claude ì´ ì„±ëŠ¥ ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  êµ¬ì²´ì ì¸ ìµœì í™” ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.
            
            ---
            ğŸ¤– *SafeWork ìë™ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ*`,
              labels: ['ğŸ“ˆ ê°œì„ ìš”ì²­', 'âš¡ ì„±ëŠ¥', 'P1-HIGH']
            };
            
            const { data: issue } = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ...performanceIssue
            });
            
            console.log(`ğŸ“‰ ì„±ëŠ¥ ì €í•˜ ì•Œë¦¼ ì´ìŠˆ ìƒì„±ë¨: #${issue.number}`);
            
            // Claude AI ìë™ í˜¸ì¶œ (ì„±ëŠ¥ ë¬¸ì œ ì¦‰ì‹œ ë¶„ì„)
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: '@claude SafeWork ì‹œìŠ¤í…œ ì„±ëŠ¥ ì €í•˜ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ì„±ëŠ¥ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ë‹¨ê³„ë³„ ìµœì í™” ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”. ìš°ì„ ìˆœìœ„: P1-HIGH'
            });

      - name: ğŸ‰ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì™„ë£Œ ì•Œë¦¼
        if: env.PERFORMANCE_ALERT != 'true'
        run: |
          echo "ğŸ‰ SafeWork ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì™„ë£Œ!"
          echo "ğŸ“Š ì „ì²´ ì„±ëŠ¥ ì ìˆ˜: ${{ steps.report.outputs.total_score }}/100"
          echo "ğŸ† ì„±ëŠ¥ ë“±ê¸‰: ${{ steps.report.outputs.performance_grade }}"
          echo "âœ… ëª¨ë“  ì„±ëŠ¥ ì§€í‘œê°€ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤."
          echo "â° ë‹¤ìŒ ëª¨ë‹ˆí„°ë§: 4ì‹œê°„ í›„"