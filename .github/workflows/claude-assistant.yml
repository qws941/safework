name: ğŸ¤– SafeWork Claude Assistant

# SafeWorkì— íŠ¹í™”ëœ Claude AI ìë™í™”
# - ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº” ë° ì‚°ì—…ì•ˆì „ ì½”ë“œ ë¦¬ë·°
# - ì´ìŠˆ ìë™ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ ì„¤ì •
# - í•œêµ­ì–´ ë¬¸ì„œ ìë™ ë²ˆì—­ ë° ë™ê¸°í™”

on:
  issues:
    types: [opened, labeled]
  pull_request:
    types: [opened, synchronize, labeled]
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  pull-requests: write
  actions: read

jobs:
  # SafeWork ë³´ì•ˆ ë° ì‚°ì—…ì•ˆì „ íŠ¹í™” ì½”ë“œ ë¦¬ë·°
  safework-code-review:
    name: ğŸ›¡ï¸ SafeWork Security & Safety Review
    runs-on: ubuntu-latest
    if: >
      github.event_name == 'pull_request' &&
      (contains(github.event.pull_request.title, 'security') ||
       contains(github.event.pull_request.title, 'ë³´ì•ˆ') ||
       contains(github.event.pull_request.labels.*.name, 'security') ||
       contains(github.event.pull_request.labels.*.name, 'safework'))

    steps:
      - name: ğŸ” SafeWork Security Analysis
        uses: anthropics/claude-code-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            SafeWork ì‚°ì—…ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ë³´ì•ˆ ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

            ## ğŸ¯ ë¶„ì„ ì´ˆì :
            1. **SQL Injection ë°©ì§€**: PostgreSQL ì¿¼ë¦¬ì˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© í™•ì¸
            2. **XSS ë°©ì§€**: Flask í…œí”Œë¦¿ì˜ ì‚¬ìš©ì ì…ë ¥ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
            3. **CSRF ë³´í˜¸**: í˜„ì¬ ë¹„í™œì„±í™”ëœ CSRF ë³´í˜¸ì˜ ë³´ì•ˆ ì˜í–¥
            4. **ì¸ì¦/ê¶Œí•œ**: Flask-Login ë° @admin_required ë°ì½”ë ˆì´í„° ì‚¬ìš©
            5. **ë¯¼ê°ì •ë³´**: í™˜ê²½ë³€ìˆ˜ ë° ì‹œí¬ë¦¿ í•˜ë“œì½”ë”© ì—¬ë¶€
            6. **íŒŒì¼ì—…ë¡œë“œ**: ì—…ë¡œë“œ íŒŒì¼ ê²€ì¦ ë° ê²½ë¡œ ìˆœíšŒ ê³µê²© ë°©ì§€
            7. **ì‚°ì—…ì•ˆì „ ë°ì´í„°**: ê·¼ë¡œì ê°œì¸ì •ë³´ ë° ê±´ê°•ì •ë³´ ë³´í˜¸

            ## ğŸ­ SafeWork íŠ¹í™” ê²€ì¦:
            - ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„° (ê·¼ê³¨ê²©ê³„, ì‹ ê·œì…ì‚¬ì) ë³´ì•ˆì„±
            - MSDS í™”í•™ë¬¼ì§ˆ ì •ë³´ ì ‘ê·¼ ì œì–´
            - ê±´ê°•ê²€ì§„ ê²°ê³¼ ì•”í˜¸í™” ë° ì ‘ê·¼ ë¡œê·¸
            - ê´€ë¦¬ì ê¶Œí•œ ë¶„ë¦¬ (ì¼ë°˜ ê´€ë¦¬ì vs ìµœê³  ê´€ë¦¬ì)

            ## ğŸ“Š ì¶œë ¥ í˜•ì‹:
            - ë°œê²¬ëœ ë³´ì•ˆ ì´ìŠˆë³„ ì‹¬ê°ë„ (Critical/High/Medium/Low)
            - êµ¬ì²´ì ì¸ ì½”ë“œ ìœ„ì¹˜ ë° ìˆ˜ì • ë°©ì•ˆ
            - SafeWork ë„ë©”ì¸ íŠ¹í™” ë³´ì•ˆ ê¶Œì¥ì‚¬í•­
            - í•œêµ­ ê°œì¸ì •ë³´ë³´í˜¸ë²•(PIPA) ì¤€ìˆ˜ ì—¬ë¶€

  # ì´ìŠˆ ìë™ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ ì„¤ì •
  safework-issue-triage:
    name: ğŸ·ï¸ SafeWork Issue Auto-Triage
    runs-on: ubuntu-latest
    if: >
      github.event_name == 'issues' &&
      github.event.action == 'opened'

    steps:
      - name: ğŸ” Issue Classification
        uses: anthropics/claude-code-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            SafeWork ì´ìŠˆë¥¼ ë¶„ì„í•˜ì—¬ ìë™ ë¶„ë¥˜ ë° ë¼ë²¨ì„ ì„¤ì •í•´ì£¼ì„¸ìš”:

            ## ğŸ·ï¸ ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬:
            **ê¸°ëŠ¥ë³„:**
            - `survey`: ì„¤ë¬¸ì¡°ì‚¬ (001 ê·¼ê³¨ê²©ê³„, 002 ì‹ ê·œì…ì‚¬ì)
            - `admin`: ê´€ë¦¬ì íŒ¨ë„ (13ê°œ SafeWork ê´€ë¦¬ ê¸°ëŠ¥)
            - `database`: PostgreSQL ìŠ¤í‚¤ë§ˆ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
            - `security`: ë³´ì•ˆ ë° ì¸ì¦ ê´€ë ¨
            - `api`: RESTful API v2 ì—”ë“œí¬ì¸íŠ¸
            - `ui`: Bootstrap 4.6 í”„ë¡ íŠ¸ì—”ë“œ
            - `docker`: ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ë°°í¬
            - `docs`: ë¬¸ì„œí™” ë° CLAUDE.md ì—…ë°ì´íŠ¸

            **ì‹¬ê°ë„ë³„:**
            - `critical`: ìš´ì˜ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ (P0)
            - `high`: ì£¼ìš” ê¸°ëŠ¥ ì˜¤ë¥˜ (P1)
            - `medium`: ì¼ë°˜ ë²„ê·¸ (P2)
            - `low`: ê°œì„ ì‚¬í•­ (P3)

            **SafeWork ë„ë©”ì¸:**
            - `industrial-safety`: ì‚°ì—…ì•ˆì „ë³´ê±´ë²• ê´€ë ¨
            - `health-survey`: ê±´ê°•ê²€ì§„ ë° ì„¤ë¬¸
            - `msds`: í™”í•™ë¬¼ì§ˆì•ˆì „ë°ì´í„°ì‹œíŠ¸
            - `worker-management`: ê·¼ë¡œì ì •ë³´ ê´€ë¦¬
            - `korean-compliance`: í•œêµ­ ë²•ê·œ ì¤€ìˆ˜

            ## ğŸ“ ë¶„ì„ í›„ ìˆ˜í–‰:
            1. ì ì ˆí•œ ë¼ë²¨ ì¡°í•© ì œì•ˆ (ìµœëŒ€ 5ê°œ)
            2. ìš°ì„ ìˆœìœ„ ì„¤ì • ê·¼ê±° ì„¤ëª…
            3. ë‹´ë‹¹ì í• ë‹¹ ì œì•ˆ (@qws941)
            4. ê´€ë ¨ ë¬¸ì„œ ë˜ëŠ” ì½”ë“œ ì°¸ì¡° ì œê³µ

            ì´ìŠˆ ì œëª©: "${{ github.event.issue.title }}"
            ì´ìŠˆ ë‚´ìš©: "${{ github.event.issue.body }}"

  # @claude ë©˜ì…˜ ì‘ë‹µ
  claude-mention-response:
    name: ğŸ’¬ Claude Mention Handler
    runs-on: ubuntu-latest
    if: >
      github.event_name == 'issue_comment' &&
      contains(github.event.comment.body, '@claude')

    steps:
      - name: ğŸ¤– Claude Response
        uses: anthropics/claude-code-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            SafeWork í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”:

            ## ğŸ­ SafeWork ì‹œìŠ¤í…œ ì •ë³´:
            - **ëª©ì **: í•œêµ­ ê±´ì„¤/ì‚°ì—… í™˜ê²½ì˜ ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬
            - **ê¸°ìˆ ìŠ¤íƒ**: Flask 3.0+, PostgreSQL 15+, Redis 7, Bootstrap 4.6
            - **í•µì‹¬ê¸°ëŠ¥**: ê±´ê°•ì„¤ë¬¸(001/002), 13ê°œ ê´€ë¦¬íŒ¨ë„, MSDS, ê·¼ë¡œìê´€ë¦¬
            - **ë°°í¬í™˜ê²½**: Docker, GitHub Actions, Watchtower ìë™ë°°í¬
            - **ì–¸ì–´**: í•œêµ­ì–´ UI, KST íƒ€ì„ì¡´

            ## ğŸ¯ ë‹µë³€ ê°€ì´ë“œë¼ì¸:
            1. SafeWork ë„ë©”ì¸ ì§€ì‹ì„ í™œìš©í•œ êµ¬ì²´ì  ë‹µë³€
            2. í•œêµ­ ì‚°ì—…ì•ˆì „ë³´ê±´ë²• ë° ê°œì¸ì •ë³´ë³´í˜¸ë²• ê³ ë ¤
            3. ì‹¤ì œ ì½”ë“œ ìœ„ì¹˜ ë° íŒŒì¼ëª… ì œê³µ
            4. ë‹¨ê³„ë³„ í•´ê²°ì±… ì œì‹œ
            5. ë³´ì•ˆ ë° ì•ˆì „ì„± ìµœìš°ì„  ê³ ë ¤

            **ì‚¬ìš©ì ì§ˆë¬¸**: "${{ github.event.comment.body }}"
            **ì´ìŠˆ ì œëª©**: "${{ github.event.issue.title }}"

  # ë¬¸ì„œ ìë™ ë™ê¸°í™” (í•œêµ­ì–´ â†” ì˜ì–´)
  safework-docs-sync:
    name: ğŸ“– SafeWork Documentation Sync
    runs-on: ubuntu-latest
    if: >
      github.event_name == 'pull_request' &&
      (contains(github.event.pull_request.changed_files, 'CLAUDE.md') ||
       contains(github.event.pull_request.changed_files, 'README.md'))

    steps:
      - name: ğŸ“ Document Translation & Sync
        uses: anthropics/claude-code-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            SafeWork í”„ë¡œì íŠ¸ ë¬¸ì„œì˜ í•œêµ­ì–´-ì˜ì–´ ë™ê¸°í™”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”:

            ## ğŸ“‹ ê²€ì¦ í•­ëª©:
            1. **CLAUDE.md**: ê°œë°œ ê°€ì´ë“œ ì¼ê´€ì„±
            2. **README.md**: í”„ë¡œì íŠ¸ ì†Œê°œ ë™ê¸°í™”
            3. **ê¸°ìˆ ìš©ì–´**: ì‚°ì—…ì•ˆì „ ì „ë¬¸ìš©ì–´ í†µì¼
            4. **ì„¤ì¹˜ê°€ì´ë“œ**: Docker ì»¨í…Œì´ë„ˆ ëª…ë ¹ì–´ ì •í™•ì„±
            5. **API ë¬¸ì„œ**: ì—”ë“œí¬ì¸íŠ¸ ë° íŒŒë¼ë¯¸í„° ì¼ì¹˜

            ## ğŸ”„ ë™ê¸°í™” ì‘ì—…:
            - ëˆ„ë½ëœ ë²ˆì—­ ë¶€ë¶„ ì‹ë³„
            - ê¸°ìˆ ì  ì •í™•ì„± ê²€ì¦
            - SafeWork ë„ë©”ì¸ ìš©ì–´ í†µì¼
            - í•œêµ­ ë²•ê·œ ê´€ë ¨ ë‚´ìš© ì •í™•ì„±

            ë³€ê²½ëœ íŒŒì¼ë“¤ì„ ë¶„ì„í•˜ì—¬ ë™ê¸°í™”ê°€ í•„ìš”í•œ ë¶€ë¶„ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.