name: ğŸ”§ Claude Maintenance & Health Check

on:
  schedule:
    # Run daily at 2 AM KST (17:00 UTC)
    - cron: '0 17 * * *'
  workflow_dispatch:
    inputs:
      maintenance_type:
        description: 'Type of maintenance to perform'
        required: false
        default: 'full'
        type: choice
        options:
          - 'full'
          - 'security'
          - 'performance'
          - 'dependencies'

jobs:
  claude-maintenance:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
      security-events: write
      id-token: write
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”§ Claude Automated Maintenance
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            MAINTENANCE TYPE: ${{ github.event.inputs.maintenance_type || 'full' }}

            ğŸ”§ **SafeWork ì‹œìŠ¤í…œ ìë™ ìœ ì§€ë³´ìˆ˜**
            
            SafeWork ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ì •ê¸°ì ì¸ ìœ ì§€ë³´ìˆ˜ë¥¼ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.

            **ìœ ì§€ë³´ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸:**

            **1. ë³´ì•ˆ ê²€ì‚¬**
            - Python íŒ¨í‚¤ì§€ ì·¨ì•½ì  ìŠ¤ìº” (requirements.txt)
            - Docker ì´ë¯¸ì§€ ë³´ì•ˆ ê²€ì‚¬
            - í™˜ê²½ë³€ìˆ˜ ë° ì‹œí¬ë¦¿ ê´€ë¦¬ ì ê²€
            - Flask ë³´ì•ˆ ì„¤ì • ê²€í† 
            - SQL ì¸ì ì…˜ ë° XSS ë°©ì§€ ê²€ì¦

            **2. ì„±ëŠ¥ ìµœì í™”**
            - ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„
            - Redis ìºì‹œ íš¨ìœ¨ì„± ê²€í† 
            - Docker ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì²´í¬
            - ë¡œê·¸ íŒŒì¼ í¬ê¸° ë° ë¡œí…Œì´ì…˜ í™•ì¸
            - í˜ì´ì§€ ë¡œë”© ì†ë„ ìµœì í™”

            **3. ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬**
            - Python ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ (flake8, black)
            - ë¯¸ì‚¬ìš© imports ë° ë³€ìˆ˜ ì œê±°
            - ì½”ë“œ ë³µì¡ë„ ë¶„ì„
            - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ì¸
            - ë¬¸ì„œí™” ìƒíƒœ ì ê²€

            **4. ì˜ì¡´ì„± ê´€ë¦¬**
            - Python íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ê°€ëŠ¥ì„± ê²€í† 
            - ë³´ì•ˆ ì—…ë°ì´íŠ¸ ìš°ì„ ìˆœìœ„ ë¶„ì„
            - í˜¸í™˜ì„± ê²€ì¦
            - ë¼ì´ì„¼ìŠ¤ ì¤€ìˆ˜ í™•ì¸

            **5. ë°ì´í„°ë² ì´ìŠ¤ ê±´ê°•ì„± ê²€ì‚¬**
            - ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
            - ì¸ë±ìŠ¤ ìµœì í™” ê²€í† 
            - ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
            - ë°±ì—… ì •ì±… ì ê²€

            **6. SafeWork íŠ¹í™” ì ê²€**
            - ì„¤ë¬¸ì¡°ì‚¬ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™ í™•ì¸
            - í•œêµ­ì–´ ì¸ì½”ë”© ë° KST ì‹œê°„ ì²˜ë¦¬
            - ì‚°ì—…ì•ˆì „ë³´ê±´ ë°ì´í„° ì •í•©ì„±
            - ê°œì¸ì •ë³´ë³´í˜¸ ì •ì±… ì¤€ìˆ˜

            **ìë™í™” ê°€ëŠ¥í•œ ì‘ì—…:**
            - íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ PR ìƒì„±
            - ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
            - ì½”ë“œ í¬ë§·íŒ… ìˆ˜ì •
            - ë¬¸ì„œ ì—…ë°ì´íŠ¸
            - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€

            ë°œê²¬ëœ ë¬¸ì œì ë“¤ì„ ë¶„ë¥˜í•˜ê³ , ìë™ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥í•œ ê²ƒë“¤ì€ PRì„ ìƒì„±í•´ì£¼ì„¸ìš”.
            ì¤‘ìš”í•œ ë³´ì•ˆ ì´ìŠˆëŠ” ë³„ë„ì˜ ì´ìŠˆë¡œ ìƒì„±í•˜ì—¬ ì•Œë ¤ì£¼ì„¸ìš”.

          claude_args: |
            --allowedTools "mcp__serena__*,mcp__sequential-thinking__*,mcp__shrimp-task-manager__*,mcp__github__*,Bash(gh:*),Bash(git:*),Bash(pip:*),Bash(docker:*)"