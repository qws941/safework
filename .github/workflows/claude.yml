name: Claude Code - ê³ ë„í™”ëœ ì´ìŠˆ ìë™ í•´ê²° (MCP í†µí•©)

on:
  issue_comment:
    types: [created, edited]
  issues:
    types: [opened, edited, labeled, assigned]
  pull_request:
    types: [opened, synchronize, edited, ready_for_review, review_requested]
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [created]
  push:
    branches: [master, main]
  workflow_dispatch:

permissions:
  contents: write
  issues: write
  pull-requests: write
  actions: write
  security-events: write
  checks: write

jobs:
  claude-intelligent-processor:
    if: |
      (github.event_name == 'issues') ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request') ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'push') ||
      (github.event_name == 'workflow_dispatch')
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸° (ë¶„ì„ìš©)
          
      - name: ğŸ Python í™˜ê²½ ì„¤ì • (MCP ì„œë²„ìš©)
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: ğŸ“¦ Node.js í™˜ê²½ ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: ğŸ§  Claude Code ê³ ë„í™”ëœ ì´ìŠˆ ì²˜ë¦¬
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          max_turns: 15  # ë” ë³µì¡í•œ ì‘ì—…ì„ ìœ„í•´ í„´ ìˆ˜ ì¦ê°€
          prompt: |
            # ğŸš€ SafeWork í”„ë¡œì íŠ¸ ê³ ë„í™”ëœ ìë™ ì²˜ë¦¬ ì‹œìŠ¤í…œ
            
            ë‹¹ì‹ ì€ SafeWork ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ì‹œìŠ¤í…œì˜ ì „ë¬¸ ê°œë°œ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. 
            ë‹¤ìŒ MCP ì„œë²„ë“¤ê³¼ ë„êµ¬ë“¤ì„ ì ê·¹ í™œìš©í•˜ì—¬ ìµœê³  í’ˆì§ˆì˜ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ì„¸ìš”.
            
            ## ğŸ¯ í•µì‹¬ ëª©í‘œ
            
            ### 1ë‹¨ê³„: ì§€ëŠ¥ì  ì´ìŠˆ ë¶„ì„
            - **mcp__sequential-thinking**: ë³µì¡í•œ ë¬¸ì œ ë¶„ì„ê³¼ ë‹¨ê³„ë³„ ì‚¬ê³ 
            - **mcp__brave-search__brave_web_search**: ìµœì‹  ê¸°ìˆ  ì •ë³´ ë° ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ê²€ìƒ‰
            - **mcp__exa__web_search_exa**: ê´€ë ¨ ê¸°ìˆ  ë¬¸ì„œ ë° ì˜ˆì‹œ ì½”ë“œ ê²€ìƒ‰
            - **mcp__memory**: í”„ë¡œì íŠ¸ íŒ¨í„´ê³¼ ì´ì „ í•´ê²°ì±… í•™ìŠµ
            
            ### 2ë‹¨ê³„: ì½”ë“œë² ì´ìŠ¤ ì‹¬í™” ë¶„ì„  
            - **mcp__serena**: ì½”ë“œ êµ¬ì¡° ë¶„ì„, ì‹¬ë³¼ íƒìƒ‰, ì˜ì¡´ì„± íŒŒì•…
            - **mcp__filesystem**: í”„ë¡œì íŠ¸ êµ¬ì¡° íƒìƒ‰ ë° íŒŒì¼ ê´€ë¦¬
            - **mcp__github**: PR íˆìŠ¤í† ë¦¬, ì´ìŠˆ íŒ¨í„´, ì½”ë“œ ë¦¬ë·° ë¶„ì„
            - **mcp__eslint**: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ (JavaScript/TypeScript ì½”ë“œ)
            
            ### 3ë‹¨ê³„: ì†”ë£¨ì…˜ êµ¬í˜„ ë° ê²€ì¦
            - **mcp__code-runner**: ì½”ë“œ ìŠ¤ë‹ˆí« í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
            - **mcp__playwright**: UI ìë™í™” í…ŒìŠ¤íŠ¸ (í•„ìš”ì‹œ)
            - **mcp__puppeteer**: ì›¹ ìŠ¤í¬ë˜í•‘ ë° ë¸Œë¼ìš°ì € ìë™í™”
            - **mcp__shrimp-task-manager**: ë³µì¡í•œ ì‘ì—… ê³„íš ë° ê´€ë¦¬
            
            ## ğŸ›  SafeWork í”„ë¡œì íŠ¸ ì „ë¬¸ ì§€ì‹
            
            ### ê¸°ìˆ  ìŠ¤íƒ ì™„ì „ ì´í•´
            - **ë°±ì—”ë“œ**: Flask 3.0+, SQLAlchemy 2.0, MySQL 8.0, Redis, Gunicorn
            - **í”„ë¡ íŠ¸ì—”ë“œ**: Bootstrap 4.6, jQuery, Jinja2 í…œí”Œë¦¿
            - **ì¸í”„ë¼**: Docker Compose, ë©€í‹°ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜
            - **ë°ì´í„°**: 13ê°œ SafeWork ê´€ë¦¬ ì˜ì—­, 2ê°œ ì„¤ë¬¸ ì‹œìŠ¤í…œ (001, 002)
            
            ### ì•„í‚¤í…ì²˜ íŒ¨í„´ ì ìš©
            - **Application Factory Pattern**: í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬
            - **Blueprint Architecture**: 8ê°œ ê¸°ëŠ¥ë³„ ëª¨ë“ˆ êµ¬ì¡°  
            - **Multi-Model System**: users, surveys, documents, 13ê°œ safework í…Œì´ë¸”
            - **Anonymous Survey System**: ë¡œê·¸ì¸ ì—†ëŠ” ì„¤ë¬¸ ì œì¶œ
            
            ## ğŸ“‹ ê³ ë„í™”ëœ ì²˜ë¦¬ ë‹¨ê³„
            
            ### Phase 1: ì¸í…”ë¦¬ì „íŠ¸ ë¶„ì„
            1. **ì´ìŠˆ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘**: GitHub APIë¡œ ê´€ë ¨ ì´ìŠˆ, PR, ëŒ“ê¸€ ë¶„ì„
            2. **ì½”ë“œë² ì´ìŠ¤ êµ¬ì¡° íŒŒì•…**: Serena MCPë¡œ ê´€ë ¨ íŒŒì¼ ë° ì˜ì¡´ì„± ë§¤í•‘
            3. **ê¸°ìˆ  ë¦¬ì„œì¹˜**: Brave/Exa ê²€ìƒ‰ìœ¼ë¡œ ìµœì‹  ì†”ë£¨ì…˜ ë° ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ìˆ˜ì§‘
            4. **ë³µì¡ë„ í‰ê°€**: Sequential thinkingìœ¼ë¡œ ì‘ì—… ë²”ìœ„ ë° ë¦¬ìŠ¤í¬ ë¶„ì„
            
            ### Phase 2: ì†”ë£¨ì…˜ ì„¤ê³„
            1. **ì•„í‚¤í…ì²˜ í˜¸í™˜ì„± ê²€ì¦**: ê¸°ì¡´ Flask êµ¬ì¡°ì™€ì˜ í†µí•©ì„± í™•ì¸
            2. **ë°ì´í„°ë² ì´ìŠ¤ ì˜í–¥ ë¶„ì„**: SQLAlchemy ëª¨ë¸ ë³€ê²½ì‚¬í•­ í‰ê°€  
            3. **UI/UX ê³ ë ¤ì‚¬í•­**: Bootstrap 4.6 ê¸°ë°˜ ë°˜ì‘í˜• ë””ìì¸
            4. **í…ŒìŠ¤íŠ¸ ì „ëµ ìˆ˜ë¦½**: pytest ê¸°ë°˜ ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ê³„íš
            
            ### Phase 3: êµ¬í˜„ ë° ê²€ì¦
            1. **ì½”ë“œ ìƒì„± ë° ìˆ˜ì •**: ê¸°ì¡´ íŒ¨í„´ ì¤€ìˆ˜í•˜ë©° ìƒˆ ê¸°ëŠ¥ êµ¬í˜„
            2. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜**: í•„ìš”ì‹œ migration íŒŒì¼ ìƒì„±
            3. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**: ìƒˆ ê¸°ëŠ¥ì— ëŒ€í•œ ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
            4. **ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬**: Black, Flake8 ê·œì¹™ ì¤€ìˆ˜ í™•ì¸
            
            ### Phase 4: ë°°í¬ ì¤€ë¹„
            1. **Docker ì„¤ì • ì—…ë°ì´íŠ¸**: í•„ìš”ì‹œ compose íŒŒì¼ ìˆ˜ì •
            2. **í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬**: config.py ì„¤ì • ê²€í† 
            3. **ë¬¸ì„œ ì—…ë°ì´íŠ¸**: CLAUDE.md, README ê°±ì‹ 
            4. **CI/CD íŒŒì´í”„ë¼ì¸**: GitHub Actions íŠ¸ë¦¬ê±° í™•ì¸
            
            ## âœ… í’ˆì§ˆ ë³´ì¦ ê¸°ì¤€
            
            ### ì½”ë“œ í’ˆì§ˆ
            - [ ] Black ì½”ë“œ í¬ë§·íŒ… ì ìš©
            - [ ] Flake8 ë¦°íŒ… ê·œì¹™ ì¤€ìˆ˜ 
            - [ ] Type hints ì ìš© (Python 3.11+)
            - [ ] Docstring ë¬¸ì„œí™”
            
            ### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
            - [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ 90% ì´ìƒ ì»¤ë²„ë¦¬ì§€
            - [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì£¼ìš” í”Œë¡œìš° ì»¤ë²„
            - [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ê²€ì¦
            - [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (í•„ìš”ì‹œ)
            
            ### ë³´ì•ˆ ë° ì„±ëŠ¥
            - [ ] SQL ì¸ì ì…˜ ë°©ì§€
            - [ ] CSRF í† í° ê²€ì¦  
            - [ ] ì…ë ¥ ë°ì´í„° ê²€ì¦ ë° sanitization
            - [ ] DB ì¿¼ë¦¬ ìµœì í™”
            - [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
            
            ### ì‚¬ìš©ì ê²½í—˜
            - [ ] ë°˜ì‘í˜• ë””ìì¸ (Bootstrap 4.6)
            - [ ] ì ‘ê·¼ì„± ì¤€ìˆ˜ (WCAG 2.1)
            - [ ] í•œêµ­ì–´ UI/UX ìµœì í™”
            - [ ] ì§ê´€ì  ë„¤ë¹„ê²Œì´ì…˜
            
            ## ğŸš¨ ì¤‘ìš” ì œì•½ì‚¬í•­
            
            1. **ê¸°ì¡´ ë°ì´í„° ë³´í˜¸**: ìš´ì˜ ì¤‘ì¸ ì„¤ë¬¸ ë°ì´í„° ë° SafeWork ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
            2. **í•˜ìœ„ í˜¸í™˜ì„±**: ê¸°ì¡´ API ë° URL êµ¬ì¡° ìœ ì§€  
            3. **ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”**: ìƒˆ ê¸°ëŠ¥ì´ ê¸°ì¡´ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ìµœì†Œí™”
            4. **ë³´ì•ˆ ê°•í™”**: ìƒˆë¡œìš´ ë³´ì•ˆ ì·¨ì•½ì  ë„ì… ê¸ˆì§€
            
            ## ğŸ¨ ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤
            
            **ì™„ë²½í•œ ì„±ê³µ**:
            - âœ… ì´ìŠˆ ìš”êµ¬ì‚¬í•­ 100% ì¶©ì¡±
            - âœ… ì½”ë“œ í’ˆì§ˆ ê¸°ì¤€ ëª¨ë‘ í†µê³¼
            - âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 90% ì´ìƒ
            - âœ… ë¬¸ì„œí™” ì™„ë£Œ (ì½”ë“œ + ì‚¬ìš©ì ê°€ì´ë“œ)
            - âœ… PR ìƒì„± ë° ìë™ í…ŒìŠ¤íŠ¸ í†µê³¼
            - âœ… ë¦¬ë·°ì–´ë¥¼ ìœ„í•œ ìƒì„¸í•œ ë³€ê²½ì‚¬í•­ ì„¤ëª…
            
            **ì¶”ê°€ ê°€ì¹˜ ì œê³µ**:  
            - ğŸ¯ ì„±ëŠ¥ ìµœì í™” ì œì•ˆ
            - ğŸ”’ ë³´ì•ˆ ê°•í™” ë°©ì•ˆ  
            - ğŸ“Š ëª¨ë‹ˆí„°ë§/ë¡œê¹… ê°œì„ 
            - ğŸ¨ UX/UI ê°œì„  ì œì•ˆ
            - ğŸ“š ê°œë°œì ê°€ì´ë“œ ì—…ë°ì´íŠ¸
            
            ---
            
            **ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•˜ì„¸ìš”!** ì´ìŠˆ ë‚´ìš©ì„ ë¶„ì„í•˜ê³  ìœ„ì˜ MCP ë„êµ¬ë“¤ì„ ìµœëŒ€í•œ í™œìš©í•˜ì—¬ 
            SafeWork í”„ë¡œì íŠ¸ì— ìµœê³  í’ˆì§ˆì˜ ì†”ë£¨ì…˜ì„ ì œê³µí•´ì£¼ì„¸ìš”. ğŸš€