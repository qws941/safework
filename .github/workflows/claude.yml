name: Claude Code

on:
  issue_comment:
    types: [created]
  issues:
    types: [opened, labeled]
  schedule:
    # ë§¤ 30ë¶„ë§ˆë‹¤ ì—´ë¦° ì´ìŠˆ ìë™ ê°ì§€
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || !contains(github.event.issue.body, '@claude'))) ||
      github.event_name == 'schedule' ||
      github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
    
    steps:
      - name: ğŸ” ì—´ë¦° ì´ìŠˆ ìë™ ê°ì§€ ë° Claude í• ë‹¹
        if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            
            // ì—´ë¦° ì´ìŠˆ ì¤‘ @claude ì—†ëŠ” ê²ƒ ì°¾ê¸°
            const openIssues = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: 'open',
              per_page: 10
            });
            
            for (const issue of openIssues.data) {
              // PRì€ ì œì™¸
              if (issue.pull_request) continue;
              
              // ì´ë¯¸ @claudeê°€ ìˆëŠ”ì§€ í™•ì¸
              const comments = await github.rest.issues.listComments({
                owner,
                repo,
                issue_number: issue.number
              });
              
              const hasClaudeComment = comments.data.some(comment => 
                comment.body.includes('@claude')
              );
              
              const hasClaudeInBody = issue.body && issue.body.includes('@claude');
              
              // @claudeê°€ ì—†ë‹¤ë©´ ëŒ“ê¸€ ì¶”ê°€
              if (!hasClaudeComment && !hasClaudeInBody) {
                await github.rest.issues.createComment({
                  owner,
                  repo,
                  issue_number: issue.number,
                  body: `ğŸ¤– **ìë™ ê°ì§€**: ì´ ì´ìŠˆë¥¼ @claudeê°€ ë¶„ì„í•˜ê³  í•´ê²°í•˜ê² ìŠµë‹ˆë‹¤.
                  
**SafeWork ì‹œìŠ¤í…œ ê°œì„  ìš”ì²­**
- ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  ì‹¤ì œ ì½”ë“œë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”
- Flask íŒ¨í„´ê³¼ ê¸°ì¡´ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•´ ì£¼ì„¸ìš”  
- ì‘ì—… ì™„ë£Œ í›„ ì»¤ë°‹í•˜ê³  ì´ìŠˆë¥¼ ë‹«ì•„ì£¼ì„¸ìš”

@claude ì§€ê¸ˆ ë°”ë¡œ ì´ ì´ìŠˆë¥¼ í•´ê²°í•´ ì£¼ì„¸ìš”! ğŸš€`
                });
                
                console.log(`âœ… ì´ìŠˆ #${issue.number}ì— Claude ìë™ í• ë‹¹`);
              }
            }

      - uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: "--max-turns 0"

