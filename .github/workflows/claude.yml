name: ğŸ¤– Claude Code Assistant

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned, labeled]
  pull_request_review:
    types: [submitted]
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]
  workflow_run:
    workflows: ["ğŸš€ SafeWork Deployment Pipeline"]
    types: [completed]

permissions:
  contents: write
  issues: write
  pull-requests: write
  actions: read
  checks: read

jobs:
  claude-assistant:
    name: ğŸ¤– AI Assistant
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    # Only run if comment contains @claude or for specific events
    if: >
      github.event_name == 'workflow_run' ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && github.event.action == 'opened') ||
      (github.event_name == 'pull_request' && github.event.pull_request.draft == false) ||
      (github.event_name == 'pull_request_review' && github.event.review.state == 'changes_requested')
    
    steps:
      - name: ğŸ¤– Claude Code Action
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: ${{ github.event_name != 'workflow_run' }}
          prompt: |
            ${{ 
              github.event_name == 'workflow_run' && 'SafeWork ë°°í¬ ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë°°í¬ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ë¬¸ì œê°€ ìˆë‹¤ë©´ í•´ê²° ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”. í•„ìš”ì‹œ GitHub ì´ìŠˆë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.' ||
              github.event_name == 'pull_request' && 'SafeWork Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Pull Requestë¥¼ ì¢…í•©ì ìœ¼ë¡œ ê²€í† í•´ì£¼ì„¸ìš”. ì½”ë“œ í’ˆì§ˆ, ë³´ì•ˆ, ì„±ëŠ¥, í…ŒìŠ¤íŠ¸ ê´€ì ì—ì„œ ë¶„ì„í•˜ê³  ê°œì„  ì‚¬í•­ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.' ||
              github.event_name == 'issues' && 'SafeWork í”„ë¡œì íŠ¸ì˜ ìƒˆë¡œìš´ ì´ìŠˆë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”. ë¬¸ì œ í•´ê²° ë°©ì•ˆì„ ì œì‹œí•˜ê³  í•„ìš”ì‹œ ì½”ë“œ ìˆ˜ì •ì„ ë„ì™€ì£¼ì„¸ìš”.' ||
              'SafeWork í”„ë¡œì íŠ¸ ê´€ë ¨ ì§ˆë¬¸ì— ëŒ€í•´ ë„ì›€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. Flask, MySQL, Redis, Docker í™˜ê²½ì—ì„œì˜ ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°œë°œì„ ì§€ì›í•©ë‹ˆë‹¤.'
            }}
            
            **í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸:**
            - SafeWork: ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œ (Flask 3.0+)
            - ê¸°ìˆ  ìŠ¤íƒ: Python Flask, MySQL 8.0, Redis, Docker
            - ì£¼ìš” ê¸°ëŠ¥: ì„¤ë¬¸ ì‹œìŠ¤í…œ, MSDS ê´€ë¦¬, ì•ˆì „ êµìœ¡, ê±´ê°• ê²€ì§„
            - ë°°í¬: Docker Registry (registry.jclee.me), Watchtower ìë™ ë°°í¬
            
            **ì‘ë‹µ ì–¸ì–´:** í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.
          claude_args: |
            --model claude-sonnet-4-20250514
            --maxTokens 8192
            --temperature 0.1
            --allowedTools "mcp__serena__*,mcp__github__*,mcp__sequential-thinking__*,mcp__memory__*"
            --systemPrompt "SafeWork Flask ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ë¬¸ê°€. ì‚°ì—…ì•ˆì „ë³´ê±´ ë„ë©”ì¸ ì§€ì‹ê³¼ Flask/Python/MySQL/Docker ê¸°ìˆ  ì „ë¬¸ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì‹¤ìš©ì ì´ê³  ì•ˆì „í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. ì½”ë“œ í’ˆì§ˆ, ë³´ì•ˆ, ì„±ëŠ¥ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤."