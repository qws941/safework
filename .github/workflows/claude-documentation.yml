name: ğŸ“š Claude Documentation Sync

on:
  push:
    branches: [master, main]
    paths:
      - 'app/**/*.py'
      - 'models*.py'
      - 'requirements.txt'
      - 'CLAUDE.md'
  workflow_dispatch:
    inputs:
      doc_type:
        description: 'Documentation type to update'
        required: false
        default: 'all'
        type: choice
        options:
          - 'all'
          - 'api'
          - 'models'
          - 'deployment'

jobs:
  claude-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      id-token: write
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“š Claude Documentation Update
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            DOC TYPE: ${{ github.event.inputs.doc_type || 'all' }}

            ğŸ“š **SafeWork ë¬¸ì„œ ìë™ ë™ê¸°í™”**
            
            SafeWork ì‹œìŠ¤í…œì˜ ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•˜ì—¬ ë¬¸ì„œë¥¼ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”.

            **ë¬¸ì„œí™” ëŒ€ìƒ:**

            **1. API ë¬¸ì„œ (app/routes/)**
            - REST API ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œí™”
            - ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì„¤ëª…
            - ì¸ì¦ ë° ê¶Œí•œ ìš”êµ¬ì‚¬í•­
            - ì—ëŸ¬ ì½”ë“œ ë° ë©”ì‹œì§€
            - ì‚¬ìš© ì˜ˆì‹œ ë° curl ëª…ë ¹ì–´

            **2. ë°ì´í„° ëª¨ë¸ ë¬¸ì„œ (models*.py)**
            - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ëª…
            - í…Œì´ë¸” ê´€ê³„ë„
            - í•„ë“œ ì„¤ëª… ë° ì œì•½ì¡°ê±´
            - ì¸ë±ìŠ¤ ë° ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­
            - ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬

            **3. ë°°í¬ ë° ìš´ì˜ ë¬¸ì„œ**
            - Docker ì»¨í…Œì´ë„ˆ ì„¤ì •
            - í™˜ê²½ ë³€ìˆ˜ ì„¤ëª…
            - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
            - ëª¨ë‹ˆí„°ë§ ë° ë¡œê·¸ ê´€ë¦¬
            - ë°±ì—… ë° ë³µêµ¬ ì ˆì°¨

            **4. SafeWork ë„ë©”ì¸ ë¬¸ì„œ**
            - ì„¤ë¬¸ì¡°ì‚¬ ì‹œìŠ¤í…œ êµ¬ì¡°
            - ì‚°ì—…ì•ˆì „ë³´ê±´ ë°ì´í„° ëª¨ë¸
            - í•œêµ­ì–´/KST ì²˜ë¦¬ ë°©ì‹
            - ë³´ì•ˆ ë° ê°œì¸ì •ë³´ë³´í˜¸ ì •ì±…

            **5. ê°œë°œì ê°€ì´ë“œ**
            - ê°œë°œ í™˜ê²½ ì„¤ì •
            - ì½”ë”© ì»¨ë²¤ì…˜
            - í…ŒìŠ¤íŠ¸ ì‘ì„± ë°©ë²•
            - ê¸°ì—¬ ê°€ì´ë“œë¼ì¸

            **ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë°©ì‹:**
            1. ê¸°ì¡´ README.md ë° docs/ í´ë” ë¶„ì„
            2. ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•œ ë¬¸ì„œ ì—…ë°ì´íŠ¸
            3. ìƒˆë¡œìš´ ê¸°ëŠ¥ì— ëŒ€í•œ ë¬¸ì„œ ì¶”ê°€
            4. ì˜ˆì œ ì½”ë“œ ë° ì‚¬ìš©ë²• ì—…ë°ì´íŠ¸
            5. í•œêµ­ì–´ ë° ì˜ì–´ ë¬¸ì„œ ë³‘í–‰ ê´€ë¦¬

            ë³€ê²½ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ì—¬ ê´€ë ¨ ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê³ ,
            í•„ìš”í•œ ê²½ìš° ìƒˆë¡œìš´ ë¬¸ì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.

          claude_args: |
            --allowedTools "mcp__serena__*,mcp__sequential-thinking__*,mcp__shrimp-task-manager__*,mcp__github__*,Bash(gh pr:*),Bash(git:*)"