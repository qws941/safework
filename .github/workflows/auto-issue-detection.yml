name: SafeWork Auto Issue Detection

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  detect-claude-requests:
    if: contains(github.event.comment.body, '@claude')
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Detect Claude Request
        uses: actions/github-script@v7
        with:
          script: |
            const comment = context.payload.comment;
            const isClaudeRequest = comment.body.includes('@claude');
            
            if (isClaudeRequest) {
              // Add claude label
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: ['claude-request']
              });
              
              // Create response comment
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: \`🤖 Claude AI 요청이 감지되었습니다! 

**SafeWork 산업보건안전 시스템 전문가**로서 도움을 드리겠습니다.

📋 **도메인 전문성:**
- 의료/보건: 근골격계 설문(001), 신규자 건강검진(002)
- 기술스택: Flask 3.0+, MySQL 8.0, Redis, Docker
- 13개 SafeWork 관리패널 시스템

⚠️ **참고**: 현재 comment 이벤트에서는 제한된 기능만 제공됩니다. 
전체 기능을 사용하려면 새로운 Issue나 PR을 생성하고 \\\`@claude\\\` 멘션을 사용해주세요.

🔍 **분석 중**: \${comment.body}

더 상세한 도움이 필요하시면 새 Issue를 생성해주세요! 🚀\`
              });
            }

      - name: Update Memory
        run: |
          echo "Claude request detected and processed for SafeWork project"
          echo "Comment ID: \${{ github.event.comment.id }}"
          echo "Issue/PR: #\${{ github.event.issue.number || github.event.pull_request.number }}"