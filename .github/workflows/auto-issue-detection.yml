name: ìë™ ì´ìŠˆ ê°ì§€ ë° Claude í• ë‹¹

on:
  schedule:
    - cron: '*/30 * * * *'  # 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch:

env:
  TZ: Asia/Seoul

jobs:
  detect-and-assign:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: ì—´ë¦° ì´ìŠˆ ìë™ Claude í• ë‹¹
        uses: actions/github-script@v7
        with:
          script: |
            console.log('ğŸ” ì—´ë¦° ì´ìŠˆ ìë™ Claude í• ë‹¹ ì‹œì‘...');
            
            const { owner, repo } = context.repo;
            let assignedCount = 0;
            
            try {
              // ì—´ë¦° ì´ìŠˆ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
              const { data: issues } = await github.rest.issues.listForRepo({
                owner,
                repo,
                state: 'open',
                per_page: 10,
                sort: 'created',
                direction: 'desc'
              });
              
              console.log(`ğŸ“‹ ${issues.length}ê°œì˜ ì—´ë¦° ì´ìŠˆ ë°œê²¬`);
              
              for (const issue of issues) {
                // PR ì œì™¸
                if (issue.pull_request) continue;
                
                console.log(`ğŸ” ì´ìŠˆ #${issue.number} ê²€í† : ${issue.title}`);
                
                // 24ì‹œê°„ ì´ë‚´ ìƒì„±ëœ ì´ìŠˆë§Œ ì²˜ë¦¬
                const created = new Date(issue.created_at);
                const now = new Date();
                const hoursOld = (now - created) / (1000 * 60 * 60);
                
                if (hoursOld > 24) {
                  console.log(`â­ï¸ ì´ìŠˆ #${issue.number}: 24ì‹œê°„ ê²½ê³¼`);
                  continue;
                }
                
                // ê¸°ì¡´ Claude ëŒ“ê¸€ í™•ì¸
                const { data: comments } = await github.rest.issues.listComments({
                  owner,
                  repo,
                  issue_number: issue.number
                });
                
                const hasClaudeComment = comments.some(comment => 
                  comment.body.includes('@claude') ||
                  comment.body.includes('Claude ì‘ì—…') ||
                  comment.body.includes('Claude ìë™ í• ë‹¹')
                );
                
                if (hasClaudeComment) {
                  console.log(`â­ï¸ ì´ìŠˆ #${issue.number}: ì´ë¯¸ Claude ì²˜ë¦¬ ì¤‘`);
                  continue;
                }
                
                // Claude ìë™ í• ë‹¹
                console.log(`âœ… ì´ìŠˆ #${issue.number} Claude ìë™ í• ë‹¹ ì¤‘...`);
                
                const commentBody = `ğŸ¤– **Claude ìë™ í• ë‹¹**

ğŸ“‹ **ìë™ ê°ì§€ëœ ì´ìŠˆ**
- **ì´ìŠˆ**: ${issue.title}
- **ìƒì„±ì‹œê°„**: ${created.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}
- **í• ë‹¹ì‹œê°„**: ${new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}

ğŸ¯ **Claude ì‘ì—… ì‹œì‘**
@claude ì´ ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  í•´ê²°í•´ì£¼ì„¸ìš”.

SafeWork í”„ë¡œì íŠ¸ íŒ¨í„´ì„ ë”°ë¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•´ì£¼ì„¸ìš”:
1. ì´ìŠˆ ë‚´ìš© ì •í™•í•œ ë¶„ì„
2. ê´€ë ¨ íŒŒì¼ ì‹ë³„ ë° í˜„ì¬ ìƒíƒœ í™•ì¸
3. ì ì ˆí•œ í•´ê²°ë°©ì•ˆ êµ¬í˜„
4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦
5. ì»¤ë°‹ ë° ì´ìŠˆ ì™„ë£Œ (ì—”ë“œí¬ì¸íŠ¸ URL í¬í•¨)

---
_ğŸ•’ ìë™ í• ë‹¹ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë¨_`;
                
                await github.rest.issues.createComment({
                  owner,
                  repo,
                  issue_number: issue.number,
                  body: commentBody
                });
                
                assignedCount++;
                console.log(`âœ… ì´ìŠˆ #${issue.number} Claude ìë™ í• ë‹¹ ì™„ë£Œ`);
                
                // API ì œí•œì„ ìœ„í•œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 2000));
              }
              
              console.log(`ğŸ¯ ì´ ${assignedCount}ê°œ ì´ìŠˆì— Claude ìë™ í• ë‹¹ ì™„ë£Œ`);
              
            } catch (error) {
              console.error('âŒ ì´ìŠˆ í• ë‹¹ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }