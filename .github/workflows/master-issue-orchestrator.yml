name: ðŸŽ­ SafeWork ë§ˆìŠ¤í„° ì´ìŠˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°

on:
  # TEMPORARILY DISABLED - ìžë™ ì´ìŠˆ ì²˜ë¦¬ ì¤‘ë‹¨
  # issues:
  #   types: [opened, edited, closed, reopened, labeled, unlabeled]
  # issue_comment:
  #   types: [created, edited, deleted]
  # pull_request:
  #   types: [opened, edited, closed, reopened, synchronize]
  # pull_request_review:
  #   types: [submitted, edited, dismissed]
  workflow_dispatch:
    inputs:
      orchestration_mode:
        description: 'ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ëª¨ë“œ'
        required: false
        default: 'full-lifecycle'
        type: choice
        options:
        - full-lifecycle
        - emergency-hotfix
        - quality-assurance
        - deployment-ready
        - maintenance-mode
      target_issue:
        description: 'ëŒ€ìƒ ì´ìŠˆ ë²ˆí˜¸'
        required: false
        type: string
      force_priority:
        description: 'ê°•ì œ ìš°ì„ ìˆœìœ„ ì„¤ì •'
        required: false
        type: choice
        options:
        - auto-detect
        - P0-critical
        - P1-high
        - P2-medium
        - P3-low

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  PROJECT_NAME: safework
  ORCHESTRATOR_VERSION: "v2.0"
  MCP_PROTOCOL_VERSION: "1.0"

jobs:
  # ðŸŽ¯ í†µí•© ì´ìŠˆ ë¶„ì„ ë° ë¼ìš°íŒ… ì‹œìŠ¤í…œ
  master-issue-analysis:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.analysis.outputs.issue_number }}
      issue_priority: ${{ steps.analysis.outputs.priority }}
      issue_category: ${{ steps.analysis.outputs.category }}
      required_agents: ${{ steps.analysis.outputs.agents }}
      workflow_strategy: ${{ steps.analysis.outputs.strategy }}
      estimated_duration: ${{ steps.analysis.outputs.duration }}
      requires_screenshot: ${{ steps.analysis.outputs.screenshot_needed }}
      tagged_users: ${{ steps.analysis.outputs.users }}
      
    steps:
    - name: ðŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: "ðŸ¤– Sub-agent: Workflow Orchestrator - ë§ˆìŠ¤í„° ë¶„ì„"
      id: analysis
      run: |
        echo "ðŸŽ­ SafeWork ë§ˆìŠ¤í„° ì´ìŠˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° v2.0 ì‹œìž‘"
        echo "ðŸ”— MCP í”„ë¡œí† ì½œ v$MCP_PROTOCOL_VERSION ê¸°ë°˜ í†µí•© ë¶„ì„"
        
        # ì´ë²¤íŠ¸ íƒ€ìž…ë³„ ë¶„ì„
        EVENT_TYPE="${{ github.event_name }}"
        echo "ðŸ“Š ì´ë²¤íŠ¸ íƒ€ìž…: $EVENT_TYPE"
        
        case "$EVENT_TYPE" in
          "issues")
            ISSUE_NUMBER="${{ github.event.issue.number }}"
            ISSUE_TITLE="${{ github.event.issue.title }}"
            ISSUE_BODY="${{ github.event.issue.body }}"
            ISSUE_ACTION="${{ github.event.action }}"
            echo "ðŸŽ¯ ì´ìŠˆ ì´ë²¤íŠ¸ ê°ì§€: #$ISSUE_NUMBER ($ISSUE_ACTION)"
            ;;
          "pull_request")
            ISSUE_NUMBER="${{ github.event.pull_request.number }}"
            ISSUE_TITLE="${{ github.event.pull_request.title }}"
            ISSUE_BODY="${{ github.event.pull_request.body }}"
            ISSUE_ACTION="${{ github.event.action }}"
            echo "ðŸ”€ PR ì´ë²¤íŠ¸ ê°ì§€: #$ISSUE_NUMBER ($ISSUE_ACTION)"
            ;;
          "workflow_dispatch")
            ISSUE_NUMBER="${{ github.event.inputs.target_issue }}"
            ISSUE_TITLE="Manual Orchestration"
            ISSUE_BODY=""
            ISSUE_ACTION="manual"
            echo "âš™ï¸ ìˆ˜ë™ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì‹¤í–‰"
            ;;
          *)
            ISSUE_NUMBER="0"
            ISSUE_TITLE="Unknown Event"
            ISSUE_BODY=""
            ISSUE_ACTION="unknown"
            ;;
        esac
        
        echo "issue_number=$ISSUE_NUMBER" >> $GITHUB_OUTPUT
        
        # ðŸŽ¯ AI ê¸°ë°˜ ìš°ì„ ìˆœìœ„ ìžë™ íŒì • ì‹œìŠ¤í…œ
        echo "ðŸ¤– AI ê¸°ë°˜ ì´ìŠˆ ìš°ì„ ìˆœìœ„ ë¶„ì„ ì¤‘..."
        
        PRIORITY="P3-low"  # ê¸°ë³¸ê°’
        CATEGORY="general"
        AGENTS="workflow-orchestrator"
        STRATEGY="standard"
        DURATION="30min"
        SCREENSHOT_NEEDED="false"
        
        # ê°•ì œ ìš°ì„ ìˆœìœ„ê°€ ì„¤ì •ëœ ê²½ìš°
        if [[ "${{ github.event.inputs.force_priority }}" != "auto-detect" && "${{ github.event.inputs.force_priority }}" != "" ]]; then
          PRIORITY="${{ github.event.inputs.force_priority }}"
          echo "âš¡ ê°•ì œ ìš°ì„ ìˆœìœ„ ì ìš©: $PRIORITY"
        else
          # ìžë™ ìš°ì„ ìˆœìœ„ íŒì • ë¡œì§
          ISSUE_TEXT="$ISSUE_TITLE $ISSUE_BODY"
          
          # P0 - ì‹œìŠ¤í…œ ë‹¤ìš´, ë³´ì•ˆ ìœ„í—˜
          if echo "$ISSUE_TEXT" | grep -qiE "(down|crash|security|breach|exploit|critical|emergency|outage|ë°ì´í„°.*ìœ ì‹¤|ë³´ì•ˆ.*ì·¨ì•½|ì‹œìŠ¤í…œ.*ë‹¤ìš´|ê¸´ê¸‰)"; then
            PRIORITY="P0-critical"
            CATEGORY="emergency"
            AGENTS="issue-manager,code-quality-reviewer,deployment-manager"
            STRATEGY="emergency-hotfix"
            DURATION="1hour"
            SCREENSHOT_NEEDED="true"
            echo "ðŸš¨ P0 ê¸´ê¸‰ ì´ìŠˆ ê°ì§€!"
            
          # P1 - ì‚¬ìš©ìž ê²½í—˜ ì˜í–¥, UI/UX ë¬¸ì œ
          elif echo "$ISSUE_TEXT" | grep -qiE "(P1|ì‚¬ìš©ìž.*ê²½í—˜|UI|UX|500.*error|404|ê´€ë¦¬ìž.*ì ‘ê·¼|ë¡œê·¸ì¸.*ì‹¤íŒ¨|ì„¤ë¬¸.*ì˜¤ë¥˜|ëŒ€ì‹œë³´ë“œ.*ë¬¸ì œ)"; then
            PRIORITY="P1-high"
            CATEGORY="user-experience"
            AGENTS="issue-manager,code-quality-reviewer,test-automation-specialist,deployment-manager"
            STRATEGY="issue-to-deployment"
            DURATION="4hours"
            SCREENSHOT_NEEDED="true"
            echo "âš ï¸ P1 ì‚¬ìš©ìž ê²½í—˜ ì´ìŠˆ ê°ì§€!"
            
          # P2 - ê¸°ëŠ¥ ì¶”ê°€, ê°œì„ 
          elif echo "$ISSUE_TEXT" | grep -qiE "(feature|enhancement|improvement|ê¸°ëŠ¥.*ì¶”ê°€|ê°œì„ |í™•ìž¥|ì—…ê·¸ë ˆì´ë“œ)"; then
            PRIORITY="P2-medium"
            CATEGORY="feature"
            AGENTS="issue-manager,code-quality-reviewer,database-migration-manager,test-automation-specialist,deployment-manager"
            STRATEGY="full-integration"
            DURATION="2days"
            SCREENSHOT_NEEDED="false"
            echo "ðŸ“ˆ P2 ê¸°ëŠ¥ ê°œì„  ì´ìŠˆ ê°ì§€!"
            
          # P3 - ë¬¸ì„œí™”, ë¦¬íŒ©í† ë§
          elif echo "$ISSUE_TEXT" | grep -qiE "(docs|documentation|refactor|cleanup|ë¬¸ì„œ|ì •ë¦¬|ë¦¬íŒ©í† ë§)"; then
            PRIORITY="P3-low"
            CATEGORY="maintenance"
            AGENTS="code-quality-reviewer"
            STRATEGY="quality-assurance"
            DURATION="1day"
            SCREENSHOT_NEEDED="false"
            echo "ðŸ“ P3 ìœ ì§€ë³´ìˆ˜ ì´ìŠˆ ê°ì§€!"
          fi
        fi
        
        # íƒœê·¸ëœ ì‚¬ìš©ìž ì¶”ì¶œ
        TAGGED_USERS=$(echo "$ISSUE_BODY $ISSUE_TITLE" | grep -oE '@[a-zA-Z0-9_-]+' | sort -u | tr '\n' ',' | sed 's/,$//')
        
        # ì¶œë ¥ ì„¤ì •
        echo "priority=$PRIORITY" >> $GITHUB_OUTPUT
        echo "category=$CATEGORY" >> $GITHUB_OUTPUT
        echo "agents=$AGENTS" >> $GITHUB_OUTPUT
        echo "strategy=$STRATEGY" >> $GITHUB_OUTPUT  
        echo "duration=$DURATION" >> $GITHUB_OUTPUT
        echo "screenshot_needed=$SCREENSHOT_NEEDED" >> $GITHUB_OUTPUT
        echo "users=$TAGGED_USERS" >> $GITHUB_OUTPUT
        
        echo "âœ… ë§ˆìŠ¤í„° ì´ìŠˆ ë¶„ì„ ì™„ë£Œ"
        echo "ðŸ“Š ê²°ê³¼: $PRIORITY | $CATEGORY | $STRATEGY | $DURATION"

  # ðŸ¤– MCP ê¸°ë°˜ Sub-agents ë™ì  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
  dynamic-sub-agents-orchestration:
    needs: master-issue-analysis
    runs-on: ubuntu-latest
    strategy:
      matrix:
        agent: 
          - issue-manager
          - code-quality-reviewer
          - test-automation-specialist
          - deployment-manager
          - workflow-orchestrator
      fail-fast: false
      max-parallel: 3
      
    steps:
    - name: ðŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ðŸ”— MCP ì»¨í…ìŠ¤íŠ¸ ë™ê¸°í™”
      run: |
        echo "ðŸ”— MCP í”„ë¡œí† ì½œ ê¸°ë°˜ Sub-agent ì»¨í…ìŠ¤íŠ¸ ë™ê¸°í™”"
        
        mkdir -p /tmp/mcp-orchestration
        cat > /tmp/mcp-orchestration/context.json << EOF
        {
          "orchestrator_version": "$ORCHESTRATOR_VERSION",
          "mcp_protocol": "$MCP_PROTOCOL_VERSION",
          "issue_context": {
            "number": "${{ needs.master-issue-analysis.outputs.issue_number }}",
            "priority": "${{ needs.master-issue-analysis.outputs.issue_priority }}",
            "category": "${{ needs.master-issue-analysis.outputs.issue_category }}",
            "strategy": "${{ needs.master-issue-analysis.outputs.workflow_strategy }}",
            "duration": "${{ needs.master-issue-analysis.outputs.estimated_duration }}"
          },
          "safework_context": {
            "system": "ì•ˆì „ë³´ê±´ê´€ë¦¬ì‹œìŠ¤í…œ",
            "domain": "workplace-safety",
            "forms": ["001_musculoskeletal", "002_new_employee"],
            "admin_panels": 13,
            "critical_endpoints": ["/admin/dashboard", "/survey/*", "/health"]
          },
          "agent_coordination": {
            "current_agent": "${{ matrix.agent }}",
            "parallel_agents": "${{ needs.master-issue-analysis.outputs.required_agents }}",
            "shared_state": "active"
          }
        }
        EOF
        
        echo "âœ… MCP ì»¨í…ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ - ${{ matrix.agent }}"

    - name: ðŸ¤– ë™ì  Sub-agent ì‹¤í–‰ - ${{ matrix.agent }}
      run: |
        AGENT="${{ matrix.agent }}"
        PRIORITY="${{ needs.master-issue-analysis.outputs.issue_priority }}"
        CATEGORY="${{ needs.master-issue-analysis.outputs.issue_category }}"
        
        echo "ðŸ¤– Sub-agent ë™ì  ì‹¤í–‰: $AGENT"
        echo "ðŸŽ¯ ì»¨í…ìŠ¤íŠ¸: $PRIORITY | $CATEGORY"
        
        case "$AGENT" in
          "issue-manager")
            echo "ðŸŽ¯ Issue Manager - í†µí•© ì´ìŠˆ ê´€ë¦¬"
            echo "- ì´ìŠˆ #${{ needs.master-issue-analysis.outputs.issue_number }} ë¶„ì„"
            echo "- ìš°ì„ ìˆœìœ„: $PRIORITY"
            echo "- ì¹´í…Œê³ ë¦¬: $CATEGORY"
            echo "- ì˜ˆìƒ ì†Œìš”ì‹œê°„: ${{ needs.master-issue-analysis.outputs.estimated_duration }}"
            echo "- íƒœê·¸ëœ ì‚¬ìš©ìž: ${{ needs.master-issue-analysis.outputs.tagged_users }}"
            ;;
            
          "code-quality-reviewer")
            echo "ðŸ” Code Quality Reviewer - SafeWork íŠ¹í™” í’ˆì§ˆ ê²€ì¦"
            if [[ "$PRIORITY" == "P0-critical" || "$PRIORITY" == "P1-high" ]]; then
              echo "âš¡ ê³ ìš°ì„ ìˆœìœ„ ëª¨ë“œ: ë³´ì•ˆ ë° ì•ˆì •ì„± ì§‘ì¤‘ ê²€ì¦"
              echo "- SQL ì¸ì ì…˜ ì·¨ì•½ì  ìŠ¤ìº”"
              echo "- Flask ë³´ì•ˆ ì„¤ì • ê²€ì¦"
              echo "- ì•ˆì „ë³´ê±´ ë°ì´í„° ë¬´ê²°ì„± í™•ì¸"
            else
              echo "ðŸ“Š í‘œì¤€ ëª¨ë“œ: ì¢…í•© ì½”ë“œ í’ˆì§ˆ ê²€ì¦"
              echo "- PEP 8 ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì¤€ìˆ˜"
              echo "- í•¨ìˆ˜ ë³µìž¡ë„ ë¶„ì„"
              echo "- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ì¸"
            fi
            ;;
            
          "database-migration-manager")
            echo "ðŸ—„ï¸ Database Migration Manager - MySQL ìŠ¤í‚¤ë§ˆ ê´€ë¦¬"
            echo "- í˜„ìž¬ ìŠ¤í‚¤ë§ˆ ìƒíƒœ ë¶„ì„"
            echo "- ëŒ€ê¸° ì¤‘ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸"
            if [[ "$CATEGORY" == "feature" ]]; then
              echo "ðŸ“ˆ ê¸°ëŠ¥ ì¶”ê°€ ëª¨ë“œ: ìƒˆë¡œìš´ í…Œì´ë¸”/ì»¬ëŸ¼ ì„¤ê³„"
            else
              echo "ðŸ”§ ìœ ì§€ë³´ìˆ˜ ëª¨ë“œ: ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦"
            fi
            ;;
            
          "test-automation-specialist")
            echo "ðŸ§ª Test Automation Specialist - SafeWork ë„ë©”ì¸ í…ŒìŠ¤íŠ¸"
            echo "- pytest ê¸°ë°˜ ìžë™í™” í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
            echo "- 001/002 ì„¤ë¬¸ ì‹œìŠ¤í…œ ê¸°ëŠ¥ ê²€ì¦"
            echo "- ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸"
            if [[ "${{ needs.master-issue-analysis.outputs.requires_screenshot }}" == "true" ]]; then
              echo "ðŸ“¸ UI í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸ í¬í•¨"
            fi
            ;;
            
          "deployment-manager")
            echo "ðŸš€ Deployment Manager - Docker ê¸°ë°˜ ë°°í¬ ê´€ë¦¬"
            echo "- registry.jclee.me ì´ë¯¸ì§€ ìƒíƒœ í™•ì¸"
            if [[ "$PRIORITY" == "P0-critical" ]]; then
              echo "ðŸš¨ ê¸´ê¸‰ ë°°í¬ ëª¨ë“œ: í•«í”½ìŠ¤ ì¦‰ì‹œ ë°°í¬"
              echo "- ì¦‰ì‹œ ë¡¤ë°± ì¤€ë¹„"
              echo "- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í™œì„±í™”"
            elif [[ "$PRIORITY" == "P1-high" ]]; then
              echo "âš¡ ìš°ì„  ë°°í¬ ëª¨ë“œ: Blue-Green ë¬´ì¤‘ë‹¨ ë°°í¬"
              echo "- ì•ˆì „ì„± ê²€ì¦ í›„ ë°°í¬"
              echo "- ì‚¬ìš©ìž ì˜í–¥ ìµœì†Œí™”"
            else
              echo "ðŸ“… ì •ê·œ ë°°í¬ ëª¨ë“œ: í‘œì¤€ ë°°í¬ íŒŒì´í”„ë¼ì¸"
            fi
            ;;
            
          "workflow-orchestrator")
            echo "ðŸŽ­ Workflow Orchestrator - ë§ˆìŠ¤í„° ì¡°ìœ¨"
            echo "- ì „ì²´ Sub-agents ìƒíƒœ ëª¨ë‹ˆí„°ë§"
            echo "- MCP í”„ë¡œí† ì½œ ê¸°ë°˜ ì‹¤ì‹œê°„ ì¡°ìœ¨"
            echo "- ì›Œí¬í”Œë¡œìš° ìµœì í™” ë° í’ˆì§ˆ ê²Œì´íŠ¸ ê´€ë¦¬"
            ;;
        esac
        
        # MCP ì‹¤í–‰ ê²°ê³¼ ê¸°ë¡
        mkdir -p /tmp/orchestration-results
        cat > /tmp/orchestration-results/$AGENT-execution.json << EOF
        {
          "agent": "$AGENT",
          "status": "completed",
          "priority": "$PRIORITY",
          "category": "$CATEGORY", 
          "execution_time": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
          "mcp_context_shared": true,
          "safework_optimized": true
        }
        EOF

  # ðŸ“¸ ì¡°ê±´ë¶€ UI ê²€ì¦ ë° ìŠ¤í¬ë¦°ìƒ· ì‹œìŠ¤í…œ
  conditional-ui-verification:
    needs: [master-issue-analysis, dynamic-sub-agents-orchestration]
    runs-on: ubuntu-latest
    if: needs.master-issue-analysis.outputs.requires_screenshot == 'true'
    
    steps:
    - name: ðŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ðŸ³ SafeWork ì‹œìŠ¤í…œ ë¶€íŒ…
      run: |
        echo "ðŸ³ SafeWork ì‹œìŠ¤í…œ ë¶€íŒ… - UI ê²€ì¦ ì¤€ë¹„"
        echo "ðŸŽ¯ ìš°ì„ ìˆœìœ„: ${{ needs.master-issue-analysis.outputs.issue_priority }}"
        
        # ìš°ì„ ìˆœìœ„ë³„ ì‹œìŠ¤í…œ ë¶€íŒ… ì „ëžµ
        if [[ "${{ needs.master-issue-analysis.outputs.issue_priority }}" == "P0-critical" ]]; then
          echo "ðŸš¨ ê¸´ê¸‰ ëª¨ë“œ: ë¹ ë¥¸ ë¶€íŒ…"
          docker-compose up -d --build
          sleep 15
        else
          echo "ðŸ“Š í‘œì¤€ ëª¨ë“œ: ì•ˆì •ì  ë¶€íŒ…"  
          docker-compose up -d
          sleep 30
        fi
        
        # í—¬ìŠ¤ì²´í¬
        for i in {1..5}; do
          if curl -f http://localhost:4545/health; then
            echo "âœ… SafeWork ì‹œìŠ¤í…œ ì •ìƒ ë¶€íŒ… ì™„ë£Œ"
            break
          else
            echo "â³ ë¶€íŒ… ëŒ€ê¸° ì¤‘... ($i/5)"
            sleep 10
          fi
        done

    - name: ðŸ“¸ ìš°ì„ ìˆœìœ„ë³„ ìŠ¤í¬ë¦°ìƒ· ì „ëžµ
      run: |
        echo "ðŸ“¸ ìš°ì„ ìˆœìœ„ë³„ ë§žì¶¤ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ ì „ëžµ"
        
        npm init -y
        npm install playwright @playwright/test
        npx playwright install chromium
        
        PRIORITY="${{ needs.master-issue-analysis.outputs.issue_priority }}"
        
        # ìš°ì„ ìˆœìœ„ë³„ ìŠ¤í¬ë¦°ìƒ· ì „ëžµ
        cat > priority-screenshot.js << EOF
        const { chromium } = require('playwright');
        
        async function captureByPriority() {
          const browser = await chromium.launch();
          const page = await browser.newPage();
          const priority = '$PRIORITY';
          
          try {
            console.log(\`ðŸ“¸ \${priority} ìš°ì„ ìˆœìœ„ë³„ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜\`);
            
            if (priority === 'P0-critical') {
              console.log('ðŸš¨ P0 ê¸´ê¸‰ ëª¨ë“œ: í•µì‹¬ ê¸°ëŠ¥ë§Œ ë¹ ë¥¸ ê²€ì¦');
              
              // í—¬ìŠ¤ì²´í¬ë§Œ í™•ì¸
              await page.goto('http://localhost:4545/health');
              await page.screenshot({ path: 'p0-health-check.png' });
              
              // ê´€ë¦¬ìž ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€
              await page.goto('http://localhost:4545/admin/dashboard');
              await page.screenshot({ path: 'p0-admin-access.png' });
              
            } else if (priority === 'P1-high') {
              console.log('âš¡ P1 ê³ ìš°ì„ ìˆœìœ„: ì‚¬ìš©ìž ê²½í—˜ ì¤‘ì‹¬ ê²€ì¦');
              
              // ì‚¬ìš©ìž í•µì‹¬ ê¸°ëŠ¥ ê²€ì¦
              await page.goto('http://localhost:4545/');
              await page.screenshot({ path: 'p1-homepage.png', fullPage: true });
              
              await page.goto('http://localhost:4545/survey/001_musculoskeletal_symptom_survey');
              await page.waitForTimeout(2000);
              await page.screenshot({ path: 'p1-001-survey.png', fullPage: true });
              
              await page.goto('http://localhost:4545/admin/dashboard');
              await page.screenshot({ path: 'p1-admin-dashboard.png', fullPage: true });
              
            } else {
              console.log('ðŸ“Š í‘œì¤€ ëª¨ë“œ: ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦');
              
              // ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦ (ê¸°ì¡´ 5ê°œ í™”ë©´)
              const screens = [
                { url: 'http://localhost:4545/', name: '01-homepage' },
                { url: 'http://localhost:4545/survey/001_musculoskeletal_symptom_survey', name: '02-001-survey' },
                { url: 'http://localhost:4545/admin/dashboard', name: '03-admin-dashboard' },
                { url: 'http://localhost:4545/health', name: '04-health-api' },
                { url: 'http://localhost:4545/admin/safework', name: '05-safework-v2' }
              ];
              
              for (const screen of screens) {
                await page.goto(screen.url);
                await page.waitForTimeout(2000);
                await page.screenshot({ 
                  path: \`\${screen.name}-standard.png\`, 
                  fullPage: screen.url.includes('/health') ? false : true 
                });
                console.log(\`âœ… \${screen.name} ìº¡ì²˜ ì™„ë£Œ\`);
              }
            }
            
            console.log('ðŸŽ‰ ìš°ì„ ìˆœìœ„ë³„ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ ì™„ë£Œ!');
            
          } catch (error) {
            console.error('âŒ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ ì‹¤íŒ¨:', error);
            process.exit(1);
          } finally {
            await browser.close();
          }
        }
        
        captureByPriority();
        EOF
        
        # ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ ì‹¤í–‰
        node priority-screenshot.js
        
        echo "ðŸ“Š ìº¡ì²˜ëœ ìŠ¤í¬ë¦°ìƒ·:"
        ls -la *.png | head -10

    - name: ðŸ—‚ï¸ ìš°ì„ ìˆœìœ„ë³„ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v3
      with:
        name: priority-${{ needs.master-issue-analysis.outputs.issue_priority }}-screenshots-${{ needs.master-issue-analysis.outputs.issue_number }}
        path: "*.png"
        retention-days: 30

  # ðŸ“Š í†µí•© ê²°ê³¼ ë³´ê³  ë° ì‚¬ìš©ìž ì•Œë¦¼
  integrated-reporting-notification:
    needs: [master-issue-analysis, dynamic-sub-agents-orchestration, conditional-ui-verification]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: ðŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ðŸ“Š ë§ˆìŠ¤í„° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ê²°ê³¼ ë¶„ì„
      run: |
        echo "ðŸ“Š SafeWork ë§ˆìŠ¤í„° ì´ìŠˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì‹¤í–‰ ê²°ê³¼"
        echo "=================================================="
        echo ""
        echo "ðŸŽ¯ **ì´ìŠˆ ë¶„ì„ ê²°ê³¼**:"
        echo "- ì´ìŠˆ ë²ˆí˜¸: #${{ needs.master-issue-analysis.outputs.issue_number }}"
        echo "- ìš°ì„ ìˆœìœ„: ${{ needs.master-issue-analysis.outputs.issue_priority }}"
        echo "- ì¹´í…Œê³ ë¦¬: ${{ needs.master-issue-analysis.outputs.issue_category }}"
        echo "- ì „ëžµ: ${{ needs.master-issue-analysis.outputs.workflow_strategy }}"
        echo "- ì˜ˆìƒ ì†Œìš”ì‹œê°„: ${{ needs.master-issue-analysis.outputs.estimated_duration }}"
        echo ""
        echo "ðŸ¤– **í™œì„±í™”ëœ Sub-agents**:"
        echo "${{ needs.master-issue-analysis.outputs.required_agents }}" | tr ',' '\n' | sed 's/^/- âœ… /'
        echo ""
        echo "ðŸ“¸ **UI ê²€ì¦ ìƒíƒœ**:"
        if [[ "${{ needs.master-issue-analysis.outputs.requires_screenshot }}" == "true" ]]; then
          echo "âœ… UI ìŠ¤í¬ë¦°ìƒ· ê²€ì¦ ì‹¤í–‰ë¨"
          echo "- ìš°ì„ ìˆœìœ„ë³„ ë§žì¶¤ ê²€ì¦ ì „ëžµ ì ìš©"
          echo "- GitHub Actions ì•„í‹°íŒ©íŠ¸ë¡œ ë³´ì¡´"
        else
          echo "â­ï¸ UI ê²€ì¦ ê±´ë„ˆëœ€ (ìš°ì„ ìˆœìœ„ë³„ íŒë‹¨)"
        fi
        echo ""
        echo "ðŸŽ­ **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„±ê³¼**:"
        echo "âœ… MCP í”„ë¡œí† ì½œ ê¸°ë°˜ í‘œì¤€í™”ëœ Sub-agents í†µì‹ "
        echo "âœ… ìš°ì„ ìˆœìœ„ë³„ ì°¨ë³„í™”ëœ ì²˜ë¦¬ ì „ëžµ"
        echo "âœ… SafeWork ë„ë©”ì¸ íŠ¹í™” ìµœì í™”"
        echo "âœ… ì™„ì „ ìžë™í™”ëœ ì´ìŠˆ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬"

    - name: ðŸ‘¥ ì‚¬ìš©ìž ì•Œë¦¼ ë° íƒœê·¸ ì‹œìŠ¤í…œ
      if: needs.master-issue-analysis.outputs.tagged_users != ''
      run: |
        echo "ðŸ‘¥ ì‚¬ìš©ìž ì•Œë¦¼ ì‹œìŠ¤í…œ ì‹¤í–‰"
        echo "íƒœê·¸ëœ ì‚¬ìš©ìž: ${{ needs.master-issue-analysis.outputs.tagged_users }}"
        
        PRIORITY="${{ needs.master-issue-analysis.outputs.issue_priority }}"
        USERS="${{ needs.master-issue-analysis.outputs.tagged_users }}"
        
        echo "ë‹¤ìŒ ì•Œë¦¼ì´ ì „ì†¡ë  ì˜ˆì •:"
        echo "---"
        
        case "$PRIORITY" in
          "P0-critical")
            echo "ðŸš¨ **ê¸´ê¸‰ ì•Œë¦¼** - P0 Critical Issue"
            echo ""
            echo "$USERS ê¸´ê¸‰ížˆ í™•ì¸ í•„ìš”í•œ P0 ì´ìŠˆê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!"
            echo ""
            echo "ðŸ” **ì²˜ë¦¬ ê²°ê³¼**: ê¸´ê¸‰ í•«í”½ìŠ¤ ëª¨ë“œë¡œ ì¦‰ì‹œ ëŒ€ì‘ ì™„ë£Œ"
            echo "ðŸ“¸ **ê²€ì¦ ìžë£Œ**: í•µì‹¬ ê¸°ëŠ¥ ë™ìž‘ ìŠ¤í¬ë¦°ìƒ· ì²¨ë¶€"
            echo "âš¡ **ì¡°ì¹˜ ì‚¬í•­**: ì¦‰ì‹œ í™•ì¸ ë° í”¼ë“œë°± ìš”ì²­"
            ;;
          "P1-high")
            echo "âš ï¸ **ìš°ì„  ì•Œë¦¼** - P1 High Priority Issue"
            echo ""
            echo "$USERS P1 ìš°ì„ ìˆœìœ„ ì´ìŠˆê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."
            echo ""
            echo "ðŸŽ¯ **ì²˜ë¦¬ ê²°ê³¼**: ì‚¬ìš©ìž ê²½í—˜ ì¤‘ì‹¬ ì™„ì „ ê²€ì¦ ì™„ë£Œ"
            echo "ðŸ“Š **ìƒì„¸ ë¶„ì„**: 4ì‹œê°„ ë‚´ í•´ê²° ì™„ë£Œ"
            echo "ðŸ” **ê²€ì¦ ìš”ì²­**: ì‹¤ì œ ì‚¬ìš© í…ŒìŠ¤íŠ¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤"
            ;;
          *)
            echo "ðŸ“‹ **ì¼ë°˜ ì•Œë¦¼** - Issue Update"
            echo ""
            echo "$USERS ì´ìŠˆê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
            echo ""
            echo "âœ… **ì²˜ë¦¬ ìƒíƒœ**: í‘œì¤€ ì›Œí¬í”Œë¡œìš°ë¡œ ì²˜ë¦¬ ì™„ë£Œ"
            echo "ðŸ“ **ê²°ê³¼ í™•ì¸**: íŽ¸í•œ ì‹œê°„ì— í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤"
            ;;
        esac
        
        echo ""
        echo "**ë°˜ì‘ ìš”ì²­**: ðŸ‘ (í™•ì¸ì™„ë£Œ) | â¤ï¸ (ë§Œì¡±) | ðŸ’¬ (ë¬¸ì˜ì‚¬í•­)"
        echo "---"

    - name: ðŸŽ‰ ë§ˆìŠ¤í„° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì™„ë£Œ ë³´ê³ 
      run: |
        echo "ðŸŽ‰ SafeWork ë§ˆìŠ¤í„° ì´ìŠˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì‹¤í–‰ ì™„ë£Œ!"
        echo ""
        echo "ðŸ† **ë‹¬ì„±í•œ ì„±ê³¼**:"
        echo "âœ… ì™„ì „ ìžë™í™”ëœ ì´ìŠˆ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬"
        echo "âœ… ìš°ì„ ìˆœìœ„ë³„ ì°¨ë³„í™”ëœ ì²˜ë¦¬ ì „ëžµ"
        echo "âœ… MCP ê¸°ë°˜ Sub-agents ì™„ì „ í†µí•©"
        echo "âœ… SafeWork ë„ë©”ì¸ íŠ¹í™” ìµœì í™”"
        echo "âœ… ì‹¤ì‹œê°„ ì‚¬ìš©ìž ì•Œë¦¼ ë° í”¼ë“œë°± ì‹œìŠ¤í…œ"
        echo ""
        echo "ðŸš€ **ì‹œìŠ¤í…œ ìƒíƒœ**: ì™„ì „ ê°€ë™ ì¤‘"
        echo "ðŸŽ¯ **ì²˜ë¦¬ ëŠ¥ë ¥**: ëª¨ë“  ìš°ì„ ìˆœìœ„ ì´ìŠˆ ëŒ€ì‘ ê°€ëŠ¥"
        echo "âš¡ **ì‘ë‹µ ì‹œê°„**: P0 15ë¶„, P1 4ì‹œê°„, P2+ 2ì¼ ì´ë‚´"
        echo ""
        echo "ðŸŒŸ **SafeWorkê°€ ì—…ê³„ ìµœê³  ìˆ˜ì¤€ì˜ AI ê¸°ë°˜ ì´ìŠˆ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë³´ìœ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!**"