name: SafeWork Claude AI Enhanced v2.0

on:
  issues:
    types: [opened, edited, reopened]
  issue_comment:
    types: [created, edited]
  pull_request:
    types: [opened, edited, reopened, synchronize, ready_for_review]
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [created, edited]
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'ì²˜ë¦¬í•  ì´ìŠˆ ë²ˆí˜¸ (ì„ íƒì‚¬í•­)'
        required: false
        type: string
      mode:
        description: 'ì‹¤í–‰ ëª¨ë“œ'
        required: true
        default: 'auto'
        type: choice
        options:
          - auto
          - issue_analysis
          - pr_review  
          - bulk_processing
          - health_check

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  # ğŸ” ì‚¬ì „ ë¶„ì„ ë° ë¶„ë¥˜ ë‹¨ê³„
  pre-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      should_process: ${{ steps.analysis.outputs.should_process }}
      processing_mode: ${{ steps.analysis.outputs.processing_mode }}
      priority_level: ${{ steps.analysis.outputs.priority_level }}
      target_context: ${{ steps.analysis.outputs.target_context }}
      skip_reason: ${{ steps.analysis.outputs.skip_reason }}
    steps:
      - name: ğŸ¯ Claude ì‘ì—… ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ ì„¤ì •
        id: analysis
        run: |
          echo "ğŸ” Claude ì‘ì—… ë¶„ì„ ì‹œì‘..."
          
          should_process="false"
          processing_mode="none"
          priority_level="P3-LOW"
          target_context=""
          skip_reason=""
          
          # ìˆ˜ë™ ì‹¤í–‰ ë¶„ì„
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            should_process="true"
            processing_mode="${{ github.event.inputs.mode }}"
            priority_level="P1-HIGH"
            target_context="Manual execution: ${{ github.event.inputs.issue_number }}"
            
          # ì´ìŠˆ ê´€ë ¨ ì´ë²¤íŠ¸
          elif [ "${{ github.event_name }}" = "issues" ]; then
            issue_title="${{ github.event.issue.title }}"
            issue_body="${{ github.event.issue.body }}"
            
            # ìš°ì„ ìˆœìœ„ ê²°ì • ë¡œì§
            if echo "$issue_title $issue_body" | grep -iE "(critical|urgent|outage|down|breach|security)" > /dev/null; then
              priority_level="P0-CRITICAL"
            elif echo "$issue_title $issue_body" | grep -iE "(error|bug|fail|broken)" > /dev/null; then
              priority_level="P1-HIGH" 
            elif echo "$issue_title $issue_body" | grep -iE "(feature|enhancement|improve)" > /dev/null; then
              priority_level="P2-MEDIUM"
            fi
            
            should_process="true"
            processing_mode="issue_analysis"
            target_context="Issue #${{ github.event.issue.number }}: $issue_title"
            
          # ì´ìŠˆ ëŒ“ê¸€ ë¶„ì„
          elif [ "${{ github.event_name }}" = "issue_comment" ]; then
            comment_body="${{ github.event.comment.body }}"
            
            if echo "$comment_body" | grep -iE "@claude|claude" > /dev/null; then
              should_process="true"
              processing_mode="issue_analysis"
              priority_level="P1-HIGH"
              target_context="Issue Comment #${{ github.event.issue.number }}"
            else
              skip_reason="No Claude mention in comment"
            fi
            
          # PR ê´€ë ¨ ì´ë²¤íŠ¸
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            if [ "${{ github.event.action }}" = "synchronize" ]; then
              skip_reason="PR synchronize - skipping to avoid noise"
            else
              should_process="true"
              processing_mode="pr_review"
              priority_level="P2-MEDIUM"
              target_context="PR #${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}"
            fi
            
          # PR ë¦¬ë·° ê´€ë ¨
          elif [ "${{ github.event_name }}" = "pull_request_review" ] || [ "${{ github.event_name }}" = "pull_request_review_comment" ]; then
            should_process="true"
            processing_mode="pr_review"
            priority_level="P2-MEDIUM"
            target_context="PR Review activity"
          fi
          
          echo "should_process=$should_process" >> $GITHUB_OUTPUT
          echo "processing_mode=$processing_mode" >> $GITHUB_OUTPUT 
          echo "priority_level=$priority_level" >> $GITHUB_OUTPUT
          echo "target_context=$target_context" >> $GITHUB_OUTPUT
          echo "skip_reason=$skip_reason" >> $GITHUB_OUTPUT
          
          if [ "$should_process" = "true" ]; then
            echo "âœ… Claude ì²˜ë¦¬ ëŒ€ìƒ: $processing_mode ($priority_level)"
            echo "ğŸ“‹ ëŒ€ìƒ: $target_context"
          else
            echo "â­ï¸ Claude ì²˜ë¦¬ ê±´ë„ˆëœ€: $skip_reason"
          fi

  # ğŸ¤– ë©”ì¸ Claude AI ì²˜ë¦¬ ì‘ì—…
  claude-ai:
    needs: pre-analysis  
    if: needs.pre-analysis.outputs.should_process == 'true'
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    environment:
      name: claude-ai
      url: https://github.com/${{ github.repository }}
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: read
      
    steps:
      - name: ğŸš€ SafeWork Claude AI ì‹œì‘ - ${{ needs.pre-analysis.outputs.processing_mode }}
        run: |
          echo "ğŸ¤– SafeWork Claude AI v2.0 ì‹œì‘!"
          echo "â° ì²˜ë¦¬ ì‹œì‘: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          echo "ğŸ¯ ì²˜ë¦¬ ëª¨ë“œ: ${{ needs.pre-analysis.outputs.processing_mode }}"
          echo "ğŸ“ˆ ìš°ì„ ìˆœìœ„: ${{ needs.pre-analysis.outputs.priority_level }}"
          echo "ğŸ“‹ ëŒ€ìƒ: ${{ needs.pre-analysis.outputs.target_context }}"
          echo "ğŸ”— ì €ì¥ì†Œ: ${{ github.repository }}"
          
          # í† í° ìƒíƒœ í™•ì¸
          if [ -n "${{ env.CLAUDE_CODE_OAUTH_TOKEN }}" ]; then
            echo "âœ… Claude OAuth Token ì„¤ì •ë¨"
          else
            echo "âŒ Claude OAuth Token ëˆ„ë½!"
            exit 1
          fi

      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ¤– Claude Code Action ì‹¤í–‰ with Enhanced Features  
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ env.CLAUDE_CODE_OAUTH_TOKEN }}
          
          # ê³ ê¸‰ ì„¤ì • (ì§€ì›ë˜ëŠ” íŒŒë¼ë¯¸í„°ë§Œ ì‚¬ìš©)
          track_progress: ${{ github.event_name != 'workflow_dispatch' }}
          use_sticky_comment: true  
          use_commit_signing: false
          
          prompt: |
            REPO: ${{ github.repository }}
            EVENT: ${{ github.event_name }}
            PROCESSING_MODE: ${{ needs.pre-analysis.outputs.processing_mode }}
            PRIORITY: ${{ needs.pre-analysis.outputs.priority_level }}
            TARGET: ${{ needs.pre-analysis.outputs.target_context }}
            
            {% if github.event.pull_request %}
            PR_NUMBER: ${{ github.event.pull_request.number }}
            PR_TITLE: ${{ github.event.pull_request.title }}
            PR_AUTHOR: ${{ github.event.pull_request.user.login }}
            {% endif %}
            
            {% if github.event.issue %}
            ISSUE_NUMBER: ${{ github.event.issue.number }}
            ISSUE_TITLE: ${{ github.event.issue.title }}
            ISSUE_AUTHOR: ${{ github.event.issue.user.login }}
            {% endif %}
            
            # ğŸ¥ SafeWork AI - ì‚°ì—…ì•ˆì „ë³´ê±´ ì „ë¬¸ AI ì–´ì‹œìŠ¤í„´íŠ¸
            
            **ì‹œìŠ¤í…œ ì»¨í…ìŠ¤íŠ¸:**
            - ğŸ­ **ë„ë©”ì¸**: í•œêµ­ ì‚°ì—…ì•ˆì „ë³´ê±´ê´€ë¦¬ì‹œìŠ¤í…œ (SafeWork)
            - ğŸ’Š **íŠ¹ìˆ˜ ìš”êµ¬ì‚¬í•­**: PHI(ê°œì¸ê±´ê°•ì •ë³´) ë³´í˜¸ ìµœìš°ì„ 
            - ğŸ› ï¸ **ê¸°ìˆ ìŠ¤íƒ**: Flask 3.0+, SQLAlchemy 2.0, MySQL 8.0 UTF8MB4, Redis 5.0
            - ğŸŒ **ì–¸ì–´/ì‹œê°„**: í•œêµ­ì–´ UI, KST íƒ€ì„ì¡´, í•œê¸€ ë°ì´í„°
            - âš¡ **í’ˆì§ˆê¸°ì¤€**: 80%+ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì—„ê²©í•œ ì½”ë“œ í‘œì¤€
            
            **í•µì‹¬ ê¸°ëŠ¥ ë„ë©”ì¸:**
            - ğŸ“‹ **ì„¤ë¬¸ì¡°ì‚¬**: ê·¼ê³¨ê²©ê³„(001), ì‹ ê·œì…ì‚¬ì(002) ì¡°ê±´ë¶€ ë¡œì§
            - ğŸ¥ **ì˜ë£Œê´€ë¦¬**: ê±´ê°•ê²€ì§„, ì˜ë¬´ì‹¤ ë°©ë¬¸, ì˜ì•½í’ˆ ì¬ê³ 
            - ğŸ‘¥ **ì•ˆì „ê´€ë¦¬**: 13ê°œ SafeWork ê´€ë¦¬íŒ¨ë„ (ê·¼ë¡œì, ê±´ê°•ê²€ì§„, ì˜ë£Œë°©ë¬¸, ì˜ì•½í’ˆ, ìƒë‹´, ê±´ê°•í”„ë¡œê·¸ë¨, íŠ¹ìˆ˜ê´€ë¦¬, í™˜ê²½ì¸¡ì •, ìœ„í—˜í‰ê°€, MSDS, ë³´í˜¸êµ¬, êµìœ¡, ìê²©ì¦)
            - ğŸ“„ **ë¬¸ì„œì‹œìŠ¤í…œ**: ë²„ì „ ê´€ë¦¬, ì ‘ê·¼ ë¡œê¹…
            - ğŸ”’ **ë³´ì•ˆ/ì¸ì¦**: ìµëª… ì„¤ë¬¸, ì†ë„ ì œí•œ
            - ğŸŒ **API**: RESTful API v2 ì™¸ë¶€ ì—°ë™
            
            **ìš´ì˜ í™˜ê²½:**
            - ğŸŒ **Production**: https://safework.jclee.me
            - ğŸ”§ **Admin**: https://safework.jclee.me/admin  
            - ğŸ“¡ **API**: https://safework.jclee.me/api/safework/v2
            - ğŸ“Š **Health**: https://safework.jclee.me/health
            
            ---
            
            ## ğŸ¯ ëª¨ë“œë³„ ì²˜ë¦¬ ì „ëµ
            
            {% if needs.pre-analysis.outputs.processing_mode == 'issue_analysis' %}
            ### ğŸ“‹ ì´ìŠˆ ë¶„ì„ ëª¨ë“œ ({{ needs.pre-analysis.outputs.priority_level }})
            
            **ìš°ì„  ì²˜ë¦¬ ë°©í–¥:**
            {% if needs.pre-analysis.outputs.priority_level == 'P0-CRITICAL' %}
            ğŸš¨ **P0-CRITICAL ëŒ€ì‘:**
            - ì„œë¹„ìŠ¤ ì¤‘ë‹¨, PHI ìœ ì¶œ, ë°ì´í„° ì†ì‹¤ ì¦‰ì‹œ ëŒ€ì‘
            - ë¡¤ë°± ê°€ëŠ¥í•œ í•«í”½ìŠ¤ ìš°ì„  ì œê³µ
            - ìš´ì˜íŒ€ ì¦‰ì‹œ ì•Œë¦¼ í•„ìš”
            {% elif needs.pre-analysis.outputs.priority_level == 'P1-HIGH' %}
            âš¡ **P1-HIGH ìš°ì„  ì²˜ë¦¬:**
            - ì„¤ë¬¸ì¡°ì‚¬ ì˜¤ë¥˜, ê´€ë¦¬ì í˜ì´ì§€ ë¬¸ì œ, DB ì´ìŠˆ
            - ë‹¹ì¼ ë‚´ í•´ê²° ëª©í‘œ
            - ìë™í™”ëœ í…ŒìŠ¤íŠ¸ í¬í•¨
            {% elif needs.pre-analysis.outputs.priority_level == 'P2-MEDIUM' %}
            ğŸ“Š **P2-MEDIUM ê³„íšì  ì²˜ë¦¬:**
            - UI ê°œì„ , API ì„±ëŠ¥, ê¸°ëŠ¥ ê°œì„ 
            - ë‹¤ìŒ ë°°í¬ ì£¼ê¸°ì— í¬í•¨
            - ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ì™€ ë¬¸ì„œí™”
            {% else %}
            ğŸ“ **P3-LOW ë°±ë¡œê·¸ ê´€ë¦¬:**
            - ë¬¸ì„œí™”, ì •ë¦¬, ë§ˆì´ë„ˆ ë²„ê·¸
            - ì—¬ìœ ì‹œê°„ì— ì²˜ë¦¬
            - ì½”ë“œ í’ˆì§ˆ ê°œì„  ê¸°íšŒë¡œ í™œìš©
            {% endif %}
            
            **ì´ìŠˆ ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
            - [ ] ë„ë©”ì¸ë³„ ì˜í–¥ë„ ë¶„ì„ (ì„¤ë¬¸/ì˜ë£Œ/ì•ˆì „/ë¬¸ì„œ/API)
            - [ ] PHI ë³´ì•ˆ ì˜í–¥ í‰ê°€ 
            - [ ] ë‹¤êµ­ì–´(í•œ/ì˜) ë¬¸ì œ í™•ì¸
            - [ ] MySQL/Redis ë°ì´í„° ë¬´ê²°ì„±
            - [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì˜í–¥ë„
            - [ ] ìš´ì˜ í™˜ê²½ í˜¸í™˜ì„±
            
            **ìë™ ë¼ë²¨ ì ìš©:**
            - ë„ë©”ì¸: area/survey, area/admin, area/api, area/security
            - ê¸°ìˆ : tech/flask, tech/mysql, tech/redis, tech/frontend
            - ì–¸ì–´: korean (í•œêµ­ì–´ ì´ìŠˆì¸ ê²½ìš°)
            - ì˜ë£Œ: medical/phi (ê°œì¸ê±´ê°•ì •ë³´ ê´€ë ¨)
            
            **ì‘ë‹µ ì›ì¹™:**
            - ë¹„ì¦ˆë‹ˆìŠ¤ ì„¤ëª…ì€ **í•œêµ­ì–´**ë¡œ ì œê³µ
            - ê¸°ìˆ ì  ìƒì„¸ì‚¬í•­ì€ **ì˜ì–´**ë¡œ ì œê³µ  
            - ì˜ë£Œ ë°ì´í„° ë³´ì•ˆì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤
            - í•œêµ­ ì˜ë£Œë²•ê·œ ë° ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜
            
            {% elif needs.pre-analysis.outputs.processing_mode == 'pr_review' %}
            ### ğŸ” PR ë¦¬ë·° ëª¨ë“œ
            
            **SafeWork PR ë¦¬ë·° ì²´í¬í¬ì¸íŠ¸:**
            
            ğŸ” **ë³´ì•ˆ ê²€í†  (ìµœìš°ì„ ):**
            - PHI ë³´í˜¸: ê°œì¸ê±´ê°•ì •ë³´ ë…¸ì¶œ, ë¡œê¹… í™•ì¸
            - SQL ì¸ì ì…˜: SQLAlchemy ì¿¼ë¦¬, ë™ì  ì¿¼ë¦¬ ê²€ì¦
            - CSRF ë³´í˜¸: WTForms, AJAX ìš”ì²­ í† í° í™•ì¸
            - ì¸ì¦/ê¶Œí•œ: @login_required, ê´€ë¦¬ì ê¶Œí•œ ê²€ì¦
            - íŒŒì¼ ì—…ë¡œë“œ: ë¬¸ì„œ ê´€ë¦¬ ë³´ì•ˆ, íŒŒì¼ ê²€ì¦
            - ì„¸ì…˜ ê´€ë¦¬: Redis ì„¸ì…˜, ë§Œë£Œ ì •ì±…
            
            ğŸ—„ï¸ **ë°ì´í„°ë² ì´ìŠ¤ (MySQL 8.0):**
            - SQLAlchemy 2.0 í˜¸í™˜ì„± í™•ì¸
            - íŠ¸ëœì­ì…˜ ê´€ë¦¬: commit/rollback íŒ¨í„´
            - ì¸ë±ìŠ¤ ì „ëµ: ê²€ìƒ‰ ì„±ëŠ¥, FK ê´€ê³„
            - UTF8MB4 ìºë¦­í„°ì…‹: í•œê¸€ í…ìŠ¤íŠ¸ ì§€ì›
            - ë§ˆì´ê·¸ë ˆì´ì…˜: models ë³€ê²½ ì˜í–¥ë„
            - ë°±ì—…/ë³µì›: ì¤‘ìš” ë°ì´í„° ë³´í˜¸
            
            ğŸ¨ **í•œêµ­ì–´ UX/UI (Bootstrap 4.6):**
            - KST íƒ€ì„ì¡´: datetime ì²˜ë¦¬ ì¼ê´€ì„±
            - í•œê¸€ í…ìŠ¤íŠ¸: UTF8MB4, ì¤„ë°”ê¿ˆ, ì •ë ¬
            - í¼ ê²€ì¦: WTForms í•œê¸€ ë©”ì‹œì§€
            - ë°˜ì‘í˜•: ëª¨ë°”ì¼, íƒœë¸”ë¦¿ í˜¸í™˜ì„±
            - ì ‘ê·¼ì„±: ì˜ë£Œì§„ ì‚¬ìš© í¸ì˜ì„±
            - ë¸Œë¼ìš°ì € í˜¸í™˜: IE11+ ì§€ì›
            
            âš¡ **ì„±ëŠ¥ ë° ìºì‹± (Redis 5.0):**
            - Redis ìºì‹±: ì„¤ë¬¸ ë°ì´í„°, ì„¸ì…˜ ì €ì¥
            - ì¿¼ë¦¬ ìµœì í™”: N+1 ë¬¸ì œ, ì¸ë±ìŠ¤ í™œìš©
            - í˜ì´ì§€ë„¤ì´ì…˜: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
            - ì •ì  ìì›: CSS/JS ìµœì†Œí™”, CDN
            - ë©”ëª¨ë¦¬ ì‚¬ìš©: ëŒ€ìš©ëŸ‰ Excel/PDF ì²˜ë¦¬
            - API ì„±ëŠ¥: RESTful ì‘ë‹µ ì‹œê°„
            
            ğŸ§ª **í…ŒìŠ¤íŠ¸ ë° í’ˆì§ˆ (80%+ ì»¤ë²„ë¦¬ì§€):**
            - pytest: ëª¨ë¸, ë·°, API í…ŒìŠ¤íŠ¸
            - í†µí•© í…ŒìŠ¤íŠ¸: MySQL, Redis ì—°ë™
            - ë³´ì•ˆ í…ŒìŠ¤íŠ¸: ê¶Œí•œ, ì¸ì¦ íë¦„
            - ì„±ëŠ¥ í…ŒìŠ¤íŠ¸: ë¶€í•˜, ë™ì‹œì„±
            - í•œê¸€ í…ŒìŠ¤íŠ¸: ë‹¤êµ­ì–´ ë°ì´í„°
            - íšŒê·€ í…ŒìŠ¤íŠ¸: ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥ë„
            
            ğŸ“‹ **SafeWork ë„ë©”ì¸ ë¡œì§:**
            - ì„¤ë¬¸ì¡°ì‚¬ ë¡œì§: 001/002 ì¡°ê±´ë¶€ ë¶„ê¸°, ìœ íš¨ì„± ê²€ì‚¬
            - ê´€ë¦¬ì íŒ¨ë„: 13ê°œ íŒ¨ë„ ê¶Œí•œ, ë°ì´í„° ì¼ê´€ì„±
            - ì˜ë£Œ ë°ì´í„°: ê±´ê°•ê²€ì§„, ì˜ë¬´ì‹¤, ì˜ì•½í’ˆ ì›Œí¬í”Œë¡œìš°
            - ë¬¸ì„œ ì‹œìŠ¤í…œ: ë²„ì „ ê´€ë¦¬, ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤
            - API ì¼ê´€ì„±: RESTful ê·œì¹™, ì—ëŸ¬ ì²˜ë¦¬
            - ê°ì‚¬ ë¡œê¹…: AuditLog ëª¨ë¸, ì ‘ê·¼ ì¶”ì 
            
            **ë¦¬ë·° ê²°ê³¼ ì œê³µ:**
            - âœ… ìŠ¹ì¸ ì¡°ê±´ ëª…ì‹œ
            - ğŸ”§ ë³€ê²½ ìš”ì²­ êµ¬ì²´ì  ê°€ì´ë“œ  
            - ğŸ’¡ ê°œì„  ì œì•ˆ (ì„ íƒì‚¬í•­)
            - ğŸš¨ ë¸”ë¡œí‚¹ ì´ìŠˆ ìš°ì„ ìˆœìœ„
            
            {% elif needs.pre-analysis.outputs.processing_mode == 'bulk_processing' %}
            ### ğŸ“Š ëŒ€ëŸ‰ ì²˜ë¦¬ ëª¨ë“œ
            - ì—¬ëŸ¬ ì´ìŠˆ/PR ì¼ê´„ ë¶„ì„
            - íŒ¨í„´ ê¸°ë°˜ ìë™ ë¼ë²¨ë§
            - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì •ë ¬
            - ì¤‘ë³µ ì´ìŠˆ ê°ì§€ ë° í†µí•©
            
            {% elif needs.pre-analysis.outputs.processing_mode == 'health_check' %}
            ### ğŸ©º í—¬ìŠ¤ì²´í¬ ëª¨ë“œ
            - ì €ì¥ì†Œ ìƒíƒœ ì ê²€
            - ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì´ë ¥ ë¶„ì„
            - ì´ìŠˆ/PR ì²˜ë¦¬ ì†ë„ ë¦¬í¬íŠ¸
            - ìë™í™” ì„±ëŠ¥ ì§€í‘œ
            
            {% endif %}
            
            ---
            
            ## ğŸ”„ ì‹¤í–‰ ê°€ì´ë“œë¼ì¸
            
            1. **í•œêµ­ ì˜ë£Œë²•ê·œ ì¤€ìˆ˜** - ê°œì¸ê±´ê°•ì •ë³´ ë³´í˜¸ë²•, ì˜ë£Œë²• ê¸°ì¤€ ì ìš©
            2. **ì‹¤í–‰ ê°€ëŠ¥í•œ ì†”ë£¨ì…˜** - êµ¬ì²´ì ì´ê³  ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì½”ë“œ/ì„¤ì • ì œê³µ
            3. **ë‹¨ê³„ë³„ ê²€ì¦** - ê° ë‹¨ê³„ë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ë°©ë²• ì œì‹œ
            4. **ë¡¤ë°± ê³„íš** - ë¬¸ì œ ë°œìƒ ì‹œ ë˜ëŒë¦´ ìˆ˜ ìˆëŠ” ë°©ë²• í¬í•¨
            5. **ë¬¸ì„œí™”** - ë³€ê²½ì‚¬í•­ì— ëŒ€í•œ ëª…í™•í•œ ê¸°ë¡
            
            ## ğŸ¯ ìµœì¢… ëª©í‘œ
            SafeWork ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±, ë³´ì•ˆì„±, ì‚¬ìš©ì„±ì„ ë†’ì´ë©°, 
            í•œêµ­ ì‚°ì—…ì•ˆì „ë³´ê±´ í™˜ê²½ì— ìµœì í™”ëœ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.
            
            **ì§€ê¸ˆ ì‹œì‘í•˜ì„¸ìš”! ğŸš€**

  # ğŸ“Š í›„ì† ì‘ì—… ë° ëª¨ë‹ˆí„°ë§
  post-processing:
    needs: [pre-analysis, claude-ai]
    if: always() && needs.pre-analysis.outputs.should_process == 'true'
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“ˆ Claude ì‘ì—… ê²°ê³¼ ë¶„ì„ ë° ë¡œê¹…
        run: |
          echo "ğŸ“Š Claude AI ì‘ì—… ì™„ë£Œ ë¶„ì„..."
          echo "â° ì™„ë£Œ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          echo "ğŸ¯ ì²˜ë¦¬ëœ ëª¨ë“œ: ${{ needs.pre-analysis.outputs.processing_mode }}"
          echo "ğŸ“ˆ ìš°ì„ ìˆœìœ„: ${{ needs.pre-analysis.outputs.priority_level }}"
          echo "ğŸ“‹ ëŒ€ìƒ: ${{ needs.pre-analysis.outputs.target_context }}"
          
          if [ "${{ needs.claude-ai.result }}" = "success" ]; then
            echo "âœ… Claude AI ì‘ì—… ì„±ê³µ"
            
            # ì„±ê³µí•œ ê²½ìš° ë°°í¬ íŒŒì´í”„ë¼ì¸ íŠ¸ë¦¬ê±° ê³ ë ¤
            if [ "${{ needs.pre-analysis.outputs.priority_level }}" = "P0-CRITICAL" ] || [ "${{ needs.pre-analysis.outputs.priority_level }}" = "P1-HIGH" ]; then
              echo "ğŸš€ ê³ ìš°ì„ ìˆœìœ„ ì‘ì—… ì™„ë£Œ - ìë™ ë°°í¬ ê³ ë ¤ ì¤‘"
            fi
            
          elif [ "${{ needs.claude-ai.result }}" = "failure" ]; then
            echo "âŒ Claude AI ì‘ì—… ì‹¤íŒ¨"
            echo "ğŸ” ì‹¤íŒ¨ ì›ì¸ ë¶„ì„ í•„ìš”"
            
          else
            echo "âš ï¸ Claude AI ì‘ì—… ìƒíƒœ ë¶ˆëª… (${{ needs.claude-ai.result }})"
          fi
          
      - name: ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
        if: needs.claude-ai.result == 'success'
        run: |
          echo "ğŸ“Š Claude AI ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘..."
          
          # ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
          START_TIME="${{ github.event.repository.updated_at }}"
          END_TIME=$(date -u +%Y-%m-%dT%H:%M:%SZ)
          
          echo "â±ï¸ ì‹¤í–‰ ì‹œê°„ ê¸°ë¡:"
          echo "  - ì‹œì‘: $START_TIME"  
          echo "  - ì¢…ë£Œ: $END_TIME"
          echo "  - ëª¨ë“œ: ${{ needs.pre-analysis.outputs.processing_mode }}"
          echo "  - ìš°ì„ ìˆœìœ„: ${{ needs.pre-analysis.outputs.priority_level }}"
          
          # í–¥í›„ ë©”íŠ¸ë¦­ ë¶„ì„ì„ ìœ„í•œ êµ¬ì¡°í™”ëœ ë¡œê·¸
          echo "METRICS|${{ github.repository }}|${{ needs.pre-analysis.outputs.processing_mode }}|${{ needs.pre-analysis.outputs.priority_level }}|${{ needs.claude-ai.result }}|$END_TIME"