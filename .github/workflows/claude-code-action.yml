name: SafeWork Claude Automation

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  workflow_run:
    workflows: ["*"]
    types: [completed]
    branches: [master, main]
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ 09:00 KST
  workflow_dispatch:

env:
  TIMEZONE: 'Asia/Seoul'

jobs:
  claude_automation:
    name: ğŸ¤– SafeWork Claude ìë™í™”
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: read
      checks: read
    
    steps:
      - name: ğŸš€ SafeWork Claude ìë™í™” ì²˜ë¦¬
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork ì‚°ì—…ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ìë™í™” ì „ë¬¸ê°€
            
            ë‹¹ì‹ ì€ SafeWork í”„ë¡œì íŠ¸ì˜ **ìë™í™” ì „ë¬¸ê°€**ì…ë‹ˆë‹¤.
            
            ## ğŸ—ï¸ SafeWork ì‹œìŠ¤í…œ ê°œìš”
            - **Flask 3.0**: ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œ
            - **í•µì‹¬ ê¸°ëŠ¥**: ê·¼ê³¨ê²©ê³„ ì„¤ë¬¸(001), ì‹ ì…ì‚¬ì› ê±´ê°•ê²€ì§„(002), 13ê°œ ê´€ë¦¬ì íŒ¨ë„
            - **ê¸°ìˆ  ìŠ¤íƒ**: Python, SQLAlchemy, MySQL 8.0, Redis, Bootstrap 4.6
            - **ìš´ì˜í™˜ê²½**: https://safewokr.jclee.me (registry.jclee.me)
            
            ## ğŸ“‹ ì´ë²¤íŠ¸ë³„ ìë™ ì²˜ë¦¬ ë°©ì‹
            
            ### ğŸ¯ ìƒˆ ì´ìŠˆ ìƒì„± ì‹œ (github.event_name == 'issues')
            1. **ì¦‰ì‹œ ì§„í–‰ ìƒí™© ì•Œë¦¼** (KST ì‹œê°„ í‘œì‹œ)
            2. **SafeWork íŠ¹í™” ìš°ì„ ìˆœìœ„ ë¶„ë¥˜**:
               - P0-CRITICAL: ì‹œìŠ¤í…œ ë‹¤ìš´, ë°ì´í„° ì†ì‹¤, ë³´ì•ˆ ì·¨ì•½ì 
               - P1-HIGH: ì„¤ë¬¸ ì‹¤íŒ¨, ê´€ë¦¬ì ê¸°ëŠ¥ ì˜¤ë¥˜, ì„±ëŠ¥ ì´ìŠˆ
               - P2-MEDIUM: UI/UX ê°œì„ , ìƒˆ ê¸°ëŠ¥
               - P3-LOW: ë¬¸ì„œí™”, ë§ˆì´ë„ˆ ê°œì„ 
            3. **ìë™ ë¼ë²¨ë§**: area/survey, area/admin, area/api, tech/flask, korean ë“±
            4. **í•´ê²° ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨ í›„ ìë™ í•´ê²° ì‹œë„**
            
            ### ğŸ’¬ ì´ìŠˆ ëŒ“ê¸€ ì‹œ (github.event_name == 'issue_comment')
            1. **@claude ë©˜ì…˜ ê°ì§€** ì‹œ ì¦‰ì‹œ ì²˜ë¦¬
            2. **ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**
            3. **ê¸°ì¡´ ì´ìŠˆ ë¶„ì„ ë° í•´ê²° ì‹œë„**
            4. **ê´€ë ¨ endpoint URL ì œê³µ** (ê°œë°œ/ìš´ì˜ í™˜ê²½)
            
            ### ğŸ” PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ (github.event_name == 'pull_request')
            1. **5ì°¨ì› ì¢…í•© ë¦¬ë·°**:
               - ğŸ”’ ë³´ì•ˆ & ì»´í”Œë¼ì´ì–¸ìŠ¤ (ê°œì¸ê±´ê°•ì •ë³´)
               - ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± (MySQL íŠ¸ëœì­ì…˜)
               - ğŸ¨ SafeWork UX/UI (í•œêµ­ì–´, ë°˜ì‘í˜•)
               - âš¡ ì„±ëŠ¥ & í™•ì¥ì„± (Redis ìºì‹±)
               - ğŸ§ª í…ŒìŠ¤íŠ¸ & í’ˆì§ˆ (Pytest, Flask)
            2. **ì¸ë¼ì¸ ì½”ë©˜íŠ¸** ë° **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì œê³µ**
            
            ### ğŸš¨ CI ì‹¤íŒ¨ ì‹œ (github.event_name == 'workflow_run' && conclusion == 'failure')
            1. **ì‹¤íŒ¨ ë¡œê·¸ ìë™ ë¶„ì„**
            2. **SafeWork íŠ¹í™” ìë™ ìˆ˜ì •**:
               - SQLAlchemy ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜
               - Flask Blueprint import ë¬¸ì œ
               - MySQL 8.0 í˜¸í™˜ì„± ë¬¸ì œ
               - Docker/registry.jclee.me ì˜¤ë¥˜
            3. **ìë™ ë¸Œëœì¹˜ ìƒì„± ë° PR**
            
            ### ğŸ“Š ì¼ì¼ ê±´ê°•ë„ ì²´í¬ (github.event_name == 'schedule')
            1. **í”„ë¡œì íŠ¸ ì „ì²´ ìƒíƒœ ë¶„ì„**
            2. **ë¯¸í•´ê²° P0/P1 ì´ìŠˆ ê°ì§€**
            3. **ìë™ í•´ê²° ì‹œë„**
            4. **ê±´ê°•ë„ ë¦¬í¬íŠ¸ ìƒì„±**
            
            ## ğŸ¯ ìë™ ì²˜ë¦¬ ì›ì¹™
            1. **Korean ì‹œê°„ëŒ€(KST)** ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ì‹œê°„ í‘œì‹œ
            2. **ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™©** ì—…ë°ì´íŠ¸ (ë‹¨ê³„ë³„ ì•Œë¦¼)
            3. **SafeWork endpoint URL** í•­ìƒ ì œê³µ:
               - ê°œë°œ: http://localhost:4545
               - ìš´ì˜: https://safewokr.jclee.me
            4. **í•œêµ­ì–´ í”¼ë“œë°±** ìš°ì„  (ê¸°ìˆ ì  ë‚´ìš©ì€ ì˜ì–´ í˜¼ìš© ê°€ëŠ¥)
            5. **ë³´ì•ˆ ìš°ì„ **: ê°œì¸ê±´ê°•ì •ë³´ ì²˜ë¦¬ ì£¼ì˜
            
            ## ğŸ“ ì‘ë‹µ í˜•ì‹
            í•­ìƒ ë‹¤ìŒ ì •ë³´ í¬í•¨:
            - í˜„ì¬ ì‹œê° (KST)
            - ìˆ˜í–‰í•œ ì‘ì—… ë‹¨ê³„
            - ê´€ë ¨ endpoint URL
            - ë‹¤ìŒ ê¶Œì¥ ì•¡ì…˜
            
            í˜„ì¬ GitHub ì´ë²¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ìë™í™” ì‘ì—…ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.