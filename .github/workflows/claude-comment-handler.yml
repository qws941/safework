name: ğŸ’¬ Claude Comment Handler

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  claude-comment:
    runs-on: ubuntu-latest
    # Only run if comment mentions @claude
    if: contains(github.event.comment.body, '@claude')
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      id-token: write
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ’¬ Claude Comment Response
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            ${{ github.event_name == 'issue_comment' && format('ISSUE NUMBER: {0}', github.event.issue.number) || format('PR NUMBER: {0}', github.event.pull_request.number) }}
            COMMENT: ${{ github.event.comment.body }}
            AUTHOR: ${{ github.event.comment.user.login }}

            ğŸ’¬ **SafeWork ì‹œìŠ¤í…œ Claude ì–´ì‹œìŠ¤í„´íŠ¸**
            
            ì‚¬ìš©ìê°€ @claudeë¥¼ ë©˜ì…˜í•˜ì—¬ ìš”ì²­í•œ ë‚´ìš©ì— ì‘ë‹µí•´ì£¼ì„¸ìš”.
            
            **ì‘ë‹µ ê°€ëŠ¥í•œ ìš”ì²­ ìœ í˜•:**

            **1. ì½”ë“œ ì§ˆë¬¸ ë° ì„¤ëª…**
            - Flask ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡° ì„¤ëª…
            - SQLAlchemy ëª¨ë¸ ê´€ê³„ í•´ì„
            - API ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©ë²•
            - ì—ëŸ¬ ë©”ì‹œì§€ ë¶„ì„ ë° í•´ê²°ë°©ì•ˆ

            **2. ê¸°ëŠ¥ êµ¬í˜„ ì§€ì›**
            - ìƒˆë¡œìš´ ì„¤ë¬¸ì¡°ì‚¬ í•­ëª© ì¶”ê°€
            - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½
            - API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
            - ë³´ì•ˆ ê¸°ëŠ¥ ê°•í™”

            **3. ë²„ê·¸ ë¶„ì„ ë° ìˆ˜ì •**
            - ë¡œê·¸ ë¶„ì„ ë° ë¬¸ì œì  íŒŒì•…
            - ì½”ë“œ ë¦¬ë·° ë° ê°œì„ ì‚¬í•­ ì œì•ˆ
            - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
            - ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ

            **4. ë°°í¬ ë° ìš´ì˜ ì§€ì›**
            - Docker ì„¤ì • ìµœì í™”
            - CI/CD íŒŒì´í”„ë¼ì¸ ê°œì„ 
            - ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì„¤ì •
            - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

            **5. SafeWork ë„ë©”ì¸ ì „ë¬¸ ì§€ì›**
            - ì‚°ì—…ì•ˆì „ë³´ê±´ ê·œì • í•´ì„
            - ì„¤ë¬¸ì¡°ì‚¬ ì–‘ì‹ ê°œì„ 
            - ê°œì¸ì •ë³´ë³´í˜¸ ì •ì±… ì ìš©
            - í•œêµ­ì–´ UI/UX ìµœì í™”

            **ìë™ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—…:**
            - ê°„ë‹¨í•œ ì½”ë“œ ìˆ˜ì •
            - ë¬¸ì„œ ì—…ë°ì´íŠ¸
            - í…ŒìŠ¤íŠ¸ ì¶”ê°€
            - ì„¤ì • íŒŒì¼ ê°œì„ 

            ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì •í™•íˆ ì´í•´í•˜ê³ , ê°€ëŠ¥í•œ ê²½ìš° ì§ì ‘ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜
            ìƒì„¸í•œ ê°€ì´ë“œë¥¼ ì œê³µí•´ì£¼ì„¸ìš”. SafeWork ë„ë©”ì¸ ì§€ì‹ì„ í™œìš©í•œ ì „ë¬¸ì ì¸ ë‹µë³€ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

          claude_args: |
            --allowedTools "mcp__serena__*,mcp__sequential-thinking__*,mcp__shrimp-task-manager__*,mcp__github__*,Bash(gh:*),Bash(git:*)"