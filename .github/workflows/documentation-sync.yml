name: SafeWork Documentation Sync

on:
  push:
    branches: [master, main]
    paths:
      - 'app/routes/**/*.py'
      - 'app/models*.py'
      - 'app/api/**/*.py'
      - 'CLAUDE.md'
      - 'README.md'
      - 'docs/**/*'
  pull_request:
    branches: [master, main]
    paths:
      - 'app/routes/**/*.py'
      - 'app/models*.py'
      - 'app/api/**/*.py'
  schedule:
    - cron: '0 2 * * 0'  # ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 2ì‹œ ì „ì²´ ë¬¸ì„œ ë™ê¸°í™”
  workflow_dispatch:
    inputs:
      sync_type:
        description: 'ë™ê¸°í™” ìœ í˜•'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - api_docs_only
          - user_manual_only
          - developer_docs_only

env:
  PYTHON_VERSION: '3.11'
  DOCS_OUTPUT_DIR: 'docs'

jobs:
  # ğŸ“š API ë¬¸ì„œ ìë™ ìƒì„±
  generate-api-docs:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ğŸ“¦ ë¬¸ì„œ ìƒì„± ë„êµ¬ ì„¤ì¹˜
        run: |
          cd app/
          pip install --upgrade pip
          pip install -r requirements.txt
          pip install sphinx sphinx-rtd-theme pydoc-markdown flask-autodoc

      - name: ğŸ“‹ SafeWork API ë¬¸ì„œ ìë™ ìƒì„±
        run: |
          echo "ğŸ“‹ SafeWork API ë¬¸ì„œ ìë™ ìƒì„±..."
          
          cd app/
          
          # API ì—”ë“œí¬ì¸íŠ¸ ìë™ ê²€ìƒ‰ ë° ë¬¸ì„œí™”
          python << 'EOF'
          import os
          import re
          import json
          from datetime import datetime
          
          def extract_api_endpoints():
              """API ì—”ë“œí¬ì¸íŠ¸ ë° ë¬¸ì„œ ìë™ ì¶”ì¶œ"""
              endpoints = []
              
              # routes ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  Python íŒŒì¼ ìŠ¤ìº”
              for root, dirs, files in os.walk('routes'):
                  for file in files:
                      if file.endswith('.py'):
                          file_path = os.path.join(root, file)
                          with open(file_path, 'r', encoding='utf-8') as f:
                              content = f.read()
                          
                          # ë¼ìš°íŠ¸ íŒ¨í„´ ì¶”ì¶œ
                          route_pattern = re.findall(r"@.*\.route\(['\"](.*?)['\"].*?methods.*?\[(.*?)\]", content)
                          for route, methods in route_pattern:
                              # í•¨ìˆ˜ëª… ë° docstring ì¶”ì¶œ
                              func_match = re.search(rf"@.*\.route\(['\"].*?{re.escape(route)}.*?\).*?\ndef\s+(\w+)\s*\([^)]*\):\s*['\"]([^'\"]*)['\"]", content, re.DOTALL)
                              if func_match:
                                  func_name = func_match.group(1)
                                  docstring = func_match.group(2) if len(func_match.groups()) > 1 else ""
                              else:
                                  func_name = "unknown"
                                  docstring = ""
                              
                              endpoints.append({
                                  'path': route,
                                  'methods': [m.strip().strip('"\'') for m in methods.split(',')],
                                  'function': func_name,
                                  'description': docstring,
                                  'file': file_path
                              })
              
              return endpoints
          
          # API ì—”ë“œí¬ì¸íŠ¸ ì¶”ì¶œ
          api_endpoints = extract_api_endpoints()
          
          # Markdown ë¬¸ì„œ ìƒì„±
          markdown_content = f"""# SafeWork API ë¬¸ì„œ
          
          **ìƒì„± ì‹œê°„:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S KST')}
          **ë²„ì „:** v2.0
          **ë² ì´ìŠ¤ URL:** https://safework.jclee.me
          
          ## ğŸ¥ SafeWork ê°œìš”
          
          SafeWorkëŠ” í•œêµ­ ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ë¥¼ ìœ„í•œ ì¢…í•©ì ì¸ ì›¹ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
          - **ì£¼ìš” ê¸°ëŠ¥**: ì„¤ë¬¸ì¡°ì‚¬, ê±´ê°•ê²€ì§„ ê´€ë¦¬, ì˜ë¬´ì‹¤ ìš´ì˜, ë¬¸ì„œ ê´€ë¦¬
          - **ê¸°ìˆ  ìŠ¤íƒ**: Flask 3.0+, SQLAlchemy 2.0, MySQL 8.0, Redis 5.0
          - **ë³´ì•ˆ**: PHI(ê°œì¸ê±´ê°•ì •ë³´) ë³´í˜¸ ìµœìš°ì„ 
          
          ## ğŸ“Š API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
          
          ì´ {len(api_endpoints)}ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
          
          """
          
          # ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
          categories = {
              'API': [],
              'Survey': [],
              'Admin': [],
              'Auth': [],
              'Document': [],
              'Health': [],
              'Main': []
          }
          
          for endpoint in api_endpoints:
              path = endpoint['path']
              if path.startswith('/api/'):
                  categories['API'].append(endpoint)
              elif 'survey' in path:
                  categories['Survey'].append(endpoint)
              elif 'admin' in path:
                  categories['Admin'].append(endpoint)
              elif 'auth' in path:
                  categories['Auth'].append(endpoint)
              elif 'document' in path:
                  categories['Document'].append(endpoint)
              elif 'health' in path:
                  categories['Health'].append(endpoint)
              else:
                  categories['Main'].append(endpoint)
          
          # ì¹´í…Œê³ ë¦¬ë³„ ë¬¸ì„œ ìƒì„±
          for category, endpoints in categories.items():
              if endpoints:
                  markdown_content += f"### ğŸ”— {category} ì—”ë“œí¬ì¸íŠ¸\n\n"
                  for endpoint in endpoints:
                      methods_str = ', '.join(endpoint['methods'])
                      markdown_content += f"#### `{methods_str}` {endpoint['path']}\n\n"
                      if endpoint['description']:
                          markdown_content += f"**ì„¤ëª…:** {endpoint['description']}\n\n"
                      markdown_content += f"**í•¨ìˆ˜:** {endpoint['function']}\n"
                      markdown_content += f"**íŒŒì¼:** {endpoint['file']}\n\n"
                      markdown_content += "---\n\n"
          
          # ì‚¬ìš© ì˜ˆì œ ì¶”ê°€
          markdown_content += """
          ## ğŸ“ ì‚¬ìš© ì˜ˆì œ
          
          ### 1. ê±´ê°• ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
          ```bash
          curl -X GET "https://safework.jclee.me/health"
          ```
          
          ### 2. ì„¤ë¬¸ì¡°ì‚¬ 001 (ê·¼ê³¨ê²©ê³„)
          ```bash
          curl -X GET "https://safework.jclee.me/survey/001"
          ```
          
          ### 3. API í†µê³„ ì¡°íšŒ (ì¸ì¦ í•„ìš”)
          ```bash
          curl -X GET "https://safework.jclee.me/api/safework/v2/statistics" \\
               -H "Authorization: Bearer YOUR_TOKEN"
          ```
          
          ## ğŸ” ì¸ì¦ ë°©ì‹
          
          SafeWork APIëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¸ì¦ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤:
          - **ì„¸ì…˜ ì¸ì¦**: ì›¹ ì¸í„°í˜ì´ìŠ¤ ê¸°ë³¸ ë°©ì‹
          - **í† í° ì¸ì¦**: API ì „ìš© (í—¤ë”: `Authorization: Bearer TOKEN`)
          - **ìµëª… ì ‘ê·¼**: íŠ¹ì • ì„¤ë¬¸ì¡°ì‚¬ ì—”ë“œí¬ì¸íŠ¸ (rate limiting ì ìš©)
          
          ## ğŸ“Š ì‘ë‹µ í˜•ì‹
          
          ëª¨ë“  APIëŠ” ì¼ê´€ëœ JSON ì‘ë‹µ í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
          
          ```json
          {
            "success": true,
            "data": {...},
            "message": "ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤",
            "timestamp": "2024-01-01T00:00:00+09:00"
          }
          ```
          
          ## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬
          
          | HTTP Code | ì„¤ëª… | ëŒ€ì‘ ë°©ì•ˆ |
          |-----------|------|-----------|
          | 400 | ì˜ëª»ëœ ìš”ì²­ | ìš”ì²­ íŒŒë¼ë¯¸í„° í™•ì¸ |
          | 401 | ì¸ì¦ í•„ìš” | ë¡œê·¸ì¸ ë˜ëŠ” í† í° í™•ì¸ |
          | 403 | ê¶Œí•œ ë¶€ì¡± | ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ |
          | 404 | ë¦¬ì†ŒìŠ¤ ì—†ìŒ | URL ê²½ë¡œ í™•ì¸ |
          | 500 | ì„œë²„ ì˜¤ë¥˜ | ì ì‹œ í›„ ì¬ì‹œë„ |
          
          ## ğŸ“ ì§€ì› ë° ë¬¸ì˜
          
          - **ê¸°ìˆ  ì§€ì›**: GitHub Issues
          - **ë³´ì•ˆ ë¬¸ì œ**: ë¹„ê³µê°œ ì±„ë„ í†µí•´ ì‹ ê³ 
          - **ê¸°ëŠ¥ ìš”ì²­**: @claude ë©˜ì…˜ìœ¼ë¡œ AI ì§€ì› ìš”ì²­
          
          ---
          ğŸ¤– *ìë™ ìƒì„±ëœ API ë¬¸ì„œ - SafeWork Documentation System*
          """
          
          # API ë¬¸ì„œ íŒŒì¼ ì €ì¥
          os.makedirs('../docs', exist_ok=True)
          with open('../docs/API.md', 'w', encoding='utf-8') as f:
              f.write(markdown_content)
          
          # JSON í˜•íƒœë¡œë„ ì €ì¥ (í–¥í›„ í™œìš©)
          with open('../docs/api-endpoints.json', 'w', encoding='utf-8') as f:
              json.dump(api_endpoints, f, ensure_ascii=False, indent=2)
          
          print(f"âœ… API ë¬¸ì„œ ìƒì„± ì™„ë£Œ: {len(api_endpoints)}ê°œ ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œí™”")
          print("ğŸ“„ ìƒì„± íŒŒì¼:")
          print("  - docs/API.md")
          print("  - docs/api-endpoints.json")
          EOF

      - name: ğŸ“– ì‚¬ìš©ì ë§¤ë‰´ì–¼ ì—…ë°ì´íŠ¸
        run: |
          echo "ğŸ“– SafeWork ì‚¬ìš©ì ë§¤ë‰´ì–¼ ìë™ ì—…ë°ì´íŠ¸..."
          
          cat > docs/USER_MANUAL.md << 'EOF'
          # SafeWork ì‚¬ìš©ì ë§¤ë‰´ì–¼
          
          **ì—…ë°ì´íŠ¸:** $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')
          
          ## ğŸ¥ SafeWorkë€?
          
          SafeWorkëŠ” ì‚°ì—… í˜„ì¥ì˜ ì•ˆì „ë³´ê±´ ê´€ë¦¬ë¥¼ ìœ„í•œ ì¢…í•©ì ì¸ ì›¹ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
          ì˜ë£Œì§„, ì•ˆì „ê´€ë¦¬ì, ê·¼ë¡œì ëª¨ë‘ê°€ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
          
          ## ğŸ‘¥ ì‚¬ìš©ìë³„ ê°€ì´ë“œ
          
          ### ğŸ‘· ê·¼ë¡œììš© ê°€ì´ë“œ
          
          #### 1. ì„¤ë¬¸ì¡°ì‚¬ ì°¸ì—¬
          - **ê·¼ê³¨ê²©ê³„ ì„¤ë¬¸ (001)**: https://safework.jclee.me/survey/001
          - **ì‹ ê·œì…ì‚¬ì ê±´ê°•ì²´í¬ (002)**: https://safework.jclee.me/survey/002
          
          **ì°¸ì—¬ ë°©ë²•:**
          1. ìœ„ ë§í¬ì— ì ‘ì†
          2. ê°œì¸ì •ë³´ ë™ì˜ í›„ ì„¤ë¬¸ ì‹œì‘
          3. ì‹ ì²´ ë¶€ìœ„ë³„ ì¦ìƒ ì²´í¬ (001) ë˜ëŠ” ì˜ë£Œë ¥ ì…ë ¥ (002)
          4. ì œì¶œ ì™„ë£Œ í›„ í™•ì¸ ë©”ì‹œì§€ í™•ì¸
          
          #### 2. ì˜ë¬´ì‹¤ ì´ìš©
          - **ìœ„ì¹˜**: ë³¸ê´€ 1ì¸µ ì˜ë¬´ì‹¤
          - **ìš´ì˜ì‹œê°„**: í‰ì¼ 09:00-17:00
          - **ì˜ˆì•½**: ë‚´ì„  1234 ë˜ëŠ” ì§ì ‘ ë°©ë¬¸
          
          ### ğŸ‘©â€âš•ï¸ ì˜ë£Œì§„ìš© ê°€ì´ë“œ
          
          #### 1. ê´€ë¦¬ì ë¡œê·¸ì¸
          - **ë¡œê·¸ì¸ í˜ì´ì§€**: https://safework.jclee.me/auth/login
          - **ê³„ì • ë¬¸ì˜**: ì‹œìŠ¤í…œ ê´€ë¦¬ì
          
          #### 2. ì˜ë¬´ì‹¤ ê´€ë¦¬
          - **í™˜ì ê¸°ë¡**: /admin/safework/medical-visits
          - **ì˜ì•½í’ˆ ê´€ë¦¬**: /admin/safework/medications
          - **ê±´ê°•ê²€ì§„ ê²°ê³¼**: /admin/safework/health-checks
          
          #### 3. ì£¼ìš” ê¸°ëŠ¥
          - ë°©ë¬¸ì ì¦ìƒ ê¸°ë¡
          - íˆ¬ì•½ ë‚´ì—­ ê´€ë¦¬
          - ê±´ê°•ê²€ì§„ ì¼ì • ê´€ë¦¬
          - íŠ¹ìˆ˜ê±´ê°•ì§„ë‹¨ ëŒ€ìƒì ê´€ë¦¬
          
          ### ğŸ‘¨â€ğŸ’¼ ì•ˆì „ê´€ë¦¬ììš© ê°€ì´ë“œ
          
          #### 1. ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
          - **ë©”ì¸ ëŒ€ì‹œë³´ë“œ**: https://safework.jclee.me/admin
          - **SafeWork í†µí•© ê´€ë¦¬**: /admin/safework
          
          #### 2. 13ê°œ ê´€ë¦¬ ì˜ì—­
          1. **ê·¼ë¡œì ê´€ë¦¬**: ì§ì› ì •ë³´, ë¶€ì„œë³„ í˜„í™©
          2. **ê±´ê°•ê²€ì§„**: ì¼ë°˜/íŠ¹ìˆ˜ ê±´ê°•ê²€ì§„ ì¼ì •
          3. **ì˜ë£Œ ë°©ë¬¸**: ì˜ë¬´ì‹¤ ì´ìš© í˜„í™©
          4. **ì˜ì•½í’ˆ**: ì¬ê³  ê´€ë¦¬, ìœ í†µê¸°í•œ ê´€ë¦¬
          5. **ê±´ê°• ìƒë‹´**: ìƒë‹´ ì¼ì • ë° ê¸°ë¡
          6. **ê±´ê°• í”„ë¡œê·¸ë¨**: êµìœ¡ ë° í”„ë¡œê·¸ë¨ ìš´ì˜
          7. **íŠ¹ìˆ˜ ê´€ë¦¬**: íŠ¹ìˆ˜ê±´ê°•ì§„ë‹¨ ëŒ€ìƒì
          8. **í™˜ê²½ ì¸¡ì •**: ì‘ì—…í™˜ê²½ì¸¡ì • ê²°ê³¼
          9. **ìœ„í—˜ í‰ê°€**: ìœ„í—˜ì„± í‰ê°€ ìë£Œ
          10. **MSDS**: ë¬¼ì§ˆì•ˆì „ë³´ê±´ìë£Œ ê´€ë¦¬
          11. **ë³´í˜¸êµ¬**: ê°œì¸ë³´í˜¸êµ¬ ì§€ê¸‰/ê´€ë¦¬
          12. **ì•ˆì „êµìœ¡**: êµìœ¡ ê³„íš ë° ì´ìˆ˜ í˜„í™©
          13. **ìê²©ì¦**: ì•ˆì „ê´€ë¦¬ì ìê²© ê´€ë¦¬
          
          ## ğŸ“± ëª¨ë°”ì¼ ì‚¬ìš© ê°€ì´ë“œ
          
          SafeWorkëŠ” ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œë„ ì™„ì „í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤:
          - **ë¸Œë¼ìš°ì €**: Chrome, Safari, Samsung Internet ê¶Œì¥
          - **í™”ë©´**: ë°˜ì‘í˜• ë””ìì¸ìœ¼ë¡œ ëª¨ë“  í™”ë©´ í¬ê¸° ì§€ì›
          - **í„°ì¹˜**: í„°ì¹˜ ì¹œí™”ì  ì¸í„°í˜ì´ìŠ¤
          
          ## ğŸ” ë¬¸ì œí•´ê²° ê°€ì´ë“œ
          
          ### ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)
          
          **Q: ì„¤ë¬¸ì¡°ì‚¬ê°€ ì €ì¥ë˜ì§€ ì•Šì•„ìš”**
          A: ì¸í„°ë„· ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
          
          **Q: ë¡œê·¸ì¸ì´ ì•ˆ ë©ë‹ˆë‹¤**
          A: ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³ , ê´€ë¦¬ìì—ê²Œ ê³„ì • ìƒíƒœë¥¼ ë¬¸ì˜í•˜ì„¸ìš”.
          
          **Q: ëª¨ë°”ì¼ì—ì„œ ê¸€ìê°€ ì‘ê²Œ ë³´ì—¬ìš”**
          A: ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ê¸€ì í¬ê¸°ë¥¼ ì¡°ì •í•˜ê±°ë‚˜, í™•ëŒ€/ì¶•ì†Œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì„¸ìš”.
          
          ### ë¸Œë¼ìš°ì €ë³„ ë¬¸ì œí•´ê²°
          
          | ë¸Œë¼ìš°ì € | ê¶Œì¥ ë²„ì „ | ì•Œë ¤ì§„ ë¬¸ì œ | í•´ê²° ë°©ë²• |
          |----------|-----------|-------------|-----------|
          | Chrome | 90+ | ì—†ìŒ | - |
          | Safari | 14+ | ì—†ìŒ | - |
          | Firefox | 88+ | íŒŒì¼ ì—…ë¡œë“œ ì´ìŠˆ | ìµœì‹  ë²„ì „ ì—…ë°ì´íŠ¸ |
          | Edge | 90+ | ì—†ìŒ | - |
          | IE | 11 | ê¸°ëŠ¥ ì œí•œ | Chrome ì‚¬ìš© ê¶Œì¥ |
          
          ## ğŸ“ ì§€ì› ë° ë¬¸ì˜
          
          ### ì¦‰ì‹œ ë„ì›€ì´ í•„ìš”í•œ ê²½ìš°
          1. **ê¸°ìˆ  ë¬¸ì œ**: GitHubì— ì´ìŠˆ ìƒì„± + @claude ë©˜ì…˜
          2. **ê¸´ê¸‰ ì˜ë£Œ**: ì˜ë¬´ì‹¤ ì§í†µ (ë‚´ì„  1234)
          3. **ì‹œìŠ¤í…œ ì¥ì• **: ì‹œìŠ¤í…œ ê´€ë¦¬ì (ë‚´ì„  5678)
          
          ### í”¼ë“œë°± ë° ê°œì„  ìš”ì²­
          - **ê¸°ëŠ¥ ê°œì„ **: GitHub Issuesì— [ê°œì„ ìš”ì²­] íƒœê·¸ë¡œ ë“±ë¡
          - **ë²„ê·¸ ì‹ ê³ **: ìƒì„¸í•œ ì¬í˜„ ë°©ë²•ê³¼ í•¨ê»˜ ì‹ ê³ 
          - **ì‚¬ìš©ì„± í”¼ë“œë°±**: ì–´ë ¤ìš´ ì ì´ë‚˜ ê°œì„  ì•„ì´ë””ì–´ ê³µìœ 
          
          ## ğŸ” ê°œì¸ì •ë³´ ë³´í˜¸
          
          SafeWorkëŠ” ê°œì¸ê±´ê°•ì •ë³´(PHI) ë³´í˜¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í•©ë‹ˆë‹¤:
          - **ì•”í˜¸í™”**: ëª¨ë“  ë¯¼ê°í•œ ë°ì´í„°ëŠ” ì•”í˜¸í™” ì €ì¥
          - **ì ‘ê·¼ ì œí•œ**: ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
          - **ê°ì‚¬ ë¡œê·¸**: ëª¨ë“  ì ‘ê·¼ ê¸°ë¡ì´ ë³´ê´€ë¨
          - **ë²•ê·œ ì¤€ìˆ˜**: ê°œì¸ì •ë³´ë³´í˜¸ë²•, ì˜ë£Œë²• ì™„ì „ ì¤€ìˆ˜
          
          ---
          
          **SafeWork ì‹œìŠ¤í…œ ì •ë³´**
          - ë²„ì „: v3.2
          - ì§€ì›: 24ì‹œê°„ ëª¨ë‹ˆí„°ë§
          - ì—…ë°ì´íŠ¸: ì§€ì†ì  ê°œì„ 
          
          ğŸ¤– *SafeWork ìë™ ë¬¸ì„œ ì‹œìŠ¤í…œì—ì„œ ìƒì„±ë¨*
          EOF
          
          echo "âœ… ì‚¬ìš©ì ë§¤ë‰´ì–¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ"

      - name: ğŸ› ï¸ ê°œë°œì ë¬¸ì„œ ë™ê¸°í™”
        run: |
          echo "ğŸ› ï¸ SafeWork ê°œë°œì ë¬¸ì„œ ë™ê¸°í™”..."
          
          # ê°œë°œ ê°€ì´ë“œ ìƒì„±
          cat > docs/DEVELOPER_GUIDE.md << 'EOF'
          # SafeWork ê°œë°œì ê°€ì´ë“œ
          
          ## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì„¤ì •
          
          ### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½
          ```bash
          # ì €ì¥ì†Œ í´ë¡ 
          git clone https://github.com/qws941/safework.git
          cd safework
          
          # Docker í™˜ê²½ ì‹¤í–‰
          docker-compose up -d
          
          # ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸
          docker-compose logs -f app
          ```
          
          ### 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
          ```bash
          # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ê·¼
          docker-compose exec app bash
          
          # ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
          cd app/
          python migrate.py migrate
          
          # ìƒíƒœ í™•ì¸
          python migrate.py status
          ```
          
          ## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
          
          ```
          safework/
          â”œâ”€â”€ app/                    # Flask ì• í”Œë¦¬ì¼€ì´ì…˜
          â”‚   â”œâ”€â”€ routes/            # ë¼ìš°íŠ¸ ëª¨ë“ˆë“¤
          â”‚   â”‚   â”œâ”€â”€ main.py       # ë©”ì¸ í˜ì´ì§€
          â”‚   â”‚   â”œâ”€â”€ auth.py       # ì¸ì¦
          â”‚   â”‚   â”œâ”€â”€ survey.py     # ì„¤ë¬¸ì¡°ì‚¬
          â”‚   â”‚   â”œâ”€â”€ admin.py      # ê´€ë¦¬ì
          â”‚   â”‚   â””â”€â”€ api_safework_v2.py  # API
          â”‚   â”œâ”€â”€ models.py         # ê¸°ë³¸ ëª¨ë¸ë“¤
          â”‚   â”œâ”€â”€ models_safework_v2.py   # SafeWork ëª¨ë¸ë“¤
          â”‚   â”œâ”€â”€ models_document.py      # ë¬¸ì„œ ê´€ë¦¬ ëª¨ë¸ë“¤
          â”‚   â”œâ”€â”€ app.py           # Flask ì•± íŒ©í† ë¦¬
          â”‚   â”œâ”€â”€ config.py        # ì„¤ì •
          â”‚   â””â”€â”€ requirements.txt # Python ì˜ì¡´ì„±
          â”œâ”€â”€ docs/                # ë¬¸ì„œ
          â”œâ”€â”€ .github/workflows/   # GitHub Actions
          â””â”€â”€ docker-compose.yml   # Docker ì„¤ì •
          ```
          
          ## ğŸ¯ ê°œë°œ ì›Œí¬í”Œë¡œìš°
          
          ### 1. ê¸°ëŠ¥ ê°œë°œ í”„ë¡œì„¸ìŠ¤
          1. **ì´ìŠˆ ìƒì„±**: GitHub Issuesì— ê¸°ëŠ¥ ëª…ì„¸ ì‘ì„±
          2. **ë¸Œëœì¹˜ ìƒì„±**: `feature/ì´ìŠˆë²ˆí˜¸-ì„¤ëª…` í˜•íƒœ
          3. **ê°œë°œ & í…ŒìŠ¤íŠ¸**: ë¡œì»¬ì—ì„œ ê°œë°œ ë° í…ŒìŠ¤íŠ¸
          4. **PR ìƒì„±**: Claude AIê°€ ìë™ ë¦¬ë·° ìˆ˜í–‰
          5. **ë°°í¬**: merge ì‹œ ìë™ ë°°í¬
          
          ### 2. ì½”ë”© ì»¨ë²¤ì…˜
          ```python
          # ëª¨ë¸ í´ë˜ìŠ¤ (models_safework_v2.py)
          class SafeworkWorker(db.Model):
              """ê·¼ë¡œì ì •ë³´"""
              __tablename__ = 'safework_workers'
              
              id = db.Column(db.Integer, primary_key=True)
              name = db.Column(db.String(100), nullable=False)
              created_at = db.Column(db.DateTime, default=kst_now)
          
          # ë¼ìš°íŠ¸ í•¨ìˆ˜ (routes/)
          @bp.route('/workers', methods=['GET', 'POST'])
          @login_required
          def workers():
              """ê·¼ë¡œì ëª©ë¡ ë° ë“±ë¡"""
              try:
                  # ë¡œì§ êµ¬í˜„
                  return render_template('admin/safework/workers.html')
              except Exception as e:
                  flash(f'ì˜¤ë¥˜: {str(e)}', 'error')
                  return redirect(url_for('admin.safework_dashboard'))
          ```
          
          ## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
          
          ### 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          ```bash
          cd app/
          pytest                    # ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          pytest -v               # ìƒì„¸ ì¶œë ¥
          pytest tests/test_models.py  # íŠ¹ì • íŒŒì¼
          pytest --cov=.         # ì»¤ë²„ë¦¬ì§€ í¬í•¨
          ```
          
          ### 2. í…ŒìŠ¤íŠ¸ ì‘ì„± íŒ¨í„´
          ```python
          def test_worker_creation(client, auth):
              """ê·¼ë¡œì ìƒì„± í…ŒìŠ¤íŠ¸"""
              auth.login()
              
              response = client.post('/admin/safework/workers', data={
                  'name': 'í™ê¸¸ë™',
                  'employee_number': 'EMP001',
                  'department': 'ì•ˆì „íŒ€'
              })
              
              assert response.status_code == 302
              assert SafeworkWorker.query.filter_by(name='í™ê¸¸ë™').first()
          ```
          
          ## ğŸ” ë³´ì•ˆ ê°€ì´ë“œë¼ì¸
          
          ### 1. PHI ë³´í˜¸ íŒ¨í„´
          ```python
          # âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
          logger.info(f"Worker ID {worker.id} accessed")
          
          # âŒ ì˜ëª»ëœ ë°©ë²•
          logger.info(f"Worker {worker.name} with medical condition {worker.medical_conditions}")
          ```
          
          ### 2. SQL ì¸ì ì…˜ ë°©ì§€
          ```python
          # âœ… SQLAlchemy ORM ì‚¬ìš©
          workers = SafeworkWorker.query.filter_by(department=dept).all()
          
          # âŒ ì§ì ‘ SQL ì‹¤í–‰ ê¸ˆì§€
          query = f"SELECT * FROM workers WHERE dept = '{dept}'"
          ```
          
          ## ğŸ“Š ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ
          
          ### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
          ```python
          # âœ… ì¡°ì¸ ìµœì í™”
          workers = db.session.query(SafeworkWorker)\
              .options(joinedload(SafeworkWorker.health_checks))\
              .filter(SafeworkWorker.is_active == True).all()
          
          # âœ… í˜ì´ì§€ë„¤ì´ì…˜
          workers = SafeworkWorker.query.paginate(
              page=page, per_page=20, error_out=False)
          ```
          
          ### 2. Redis ìºì‹± í™œìš©
          ```python
          from redis import Redis
          
          @cache_key('worker_{worker_id}_stats')
          def get_worker_stats(worker_id):
              # ë³µì¡í•œ ê³„ì‚° ê²°ê³¼ ìºì‹±
              pass
          ```
          
          ## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤
          
          ### ìë™ ë°°í¬ íŒŒì´í”„ë¼ì¸
          1. **ì½”ë“œ í‘¸ì‹œ** â†’ GitHub
          2. **Claude AI ê²€í† ** â†’ ìë™ ì½”ë“œ ë¦¬ë·°
          3. **ë³´ì•ˆ ìŠ¤ìº”** â†’ Bandit, Safety ê²€ì‚¬
          4. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰** â†’ pytest ì „ì²´ í…ŒìŠ¤íŠ¸
          5. **Docker ë¹Œë“œ** â†’ registry.jclee.me
          6. **ë°°í¬ ì‹¤í–‰** â†’ Watchtower ìë™ ì—…ë°ì´íŠ¸
          7. **ìƒíƒœ í™•ì¸** â†’ í—¬ìŠ¤ì²´í¬
          
          ### ìˆ˜ë™ ë°°í¬ (ê¸´ê¸‰ì‹œ)
          ```bash
          # ì´ë¯¸ì§€ ë¹Œë“œ
          docker build -t registry.jclee.me/safework/app:manual ./app
          
          # ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‘¸ì‹œ
          docker push registry.jclee.me/safework/app:manual
          
          # Watchtower API í˜¸ì¶œ
          curl -H "Authorization: Bearer $WATCHTOWER_TOKEN" \
               -X POST https://watchtower.jclee.me/v1/update
          ```
          
          ## ğŸ¤– Claude AI í†µí•©
          
          SafeWorkëŠ” Claude AIì™€ ì™„ì „ í†µí•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
          
          ### ìë™í™”ëœ ì‘ì—…
          - **ì½”ë“œ ë¦¬ë·°**: PR ìƒì„± ì‹œ ìë™ ë³´ì•ˆ/ì„±ëŠ¥ ê²€í† 
          - **ì´ìŠˆ ë¶„ë¥˜**: ì´ìŠˆ ìƒì„± ì‹œ ìë™ ë¼ë²¨ë§ ë° ìš°ì„ ìˆœìœ„ ì„¤ì •
          - **ë¬¸ì„œ ìƒì„±**: API ë³€ê²½ ì‹œ ë¬¸ì„œ ìë™ ì—…ë°ì´íŠ¸
          - **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì„±ëŠ¥ ì €í•˜ ê°ì§€ ì‹œ ìë™ ìµœì í™” ì œì•ˆ
          
          ### Claude AI í™œìš©ë²•
          ```markdown
          # ì´ìŠˆì—ì„œ Claude AI í˜¸ì¶œ
          @claude ì´ ì„±ëŠ¥ ë¬¸ì œë¥¼ ë¶„ì„í•˜ê³  ìµœì í™” ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.
          
          # PRì—ì„œ ë³´ì•ˆ ê²€í†  ìš”ì²­
          @claude ì´ ë³€ê²½ì‚¬í•­ì˜ ë³´ì•ˆ ì˜í–¥ë„ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.
          ```
          
          ## ğŸ“ ê°œë°œ ì§€ì›
          
          ### ë¬¸ì œ í•´ê²° ìˆœì„œ
          1. **ë¡œê·¸ í™•ì¸**: `docker-compose logs app`
          2. **ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ**: MySQL, Redis ì—°ê²° í™•ì¸
          3. **GitHub Issues**: ë¹„ìŠ·í•œ ë¬¸ì œ ê²€ìƒ‰
          4. **Claude AI**: @claude ë©˜ì…˜ìœ¼ë¡œ ì¦‰ì‹œ ì§€ì›
          
          ### ìœ ìš©í•œ ëª…ë ¹ì–´
          ```bash
          # ê°œë°œ í™˜ê²½ ë¦¬ì…‹
          docker-compose down -v && docker-compose up -d
          
          # ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
          docker-compose exec mysql mysqldump -u safework -p safework_db > backup.sql
          
          # ë¡œê·¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
          docker-compose logs -f --tail=100 app
          ```
          
          ---
          
          **ê°œë°œíŒ€ ì—°ë½ì²˜**
          - **ê¸°ìˆ  ì§€ì›**: GitHub Issues
          - **ê¸´ê¸‰ ë¬¸ì˜**: Claude AI (@claude)
          - **ë³´ì•ˆ ì œë³´**: ë¹„ê³µê°œ ì±„ë„
          
          ğŸ¤– *SafeWork ìë™ ë¬¸ì„œ ì‹œìŠ¤í…œ*
          EOF
          
          echo "âœ… ê°œë°œì ê°€ì´ë“œ ìƒì„± ì™„ë£Œ"

      - name: ğŸ“¤ ë¬¸ì„œ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
        if: github.event_name != 'pull_request'
        run: |
          git config --global user.name "SafeWork Documentation Bot"
          git config --global user.email "noreply@safework.jclee.me"
          
          # ë³€ê²½ì‚¬í•­ í™•ì¸
          if git diff --quiet docs/; then
            echo "ğŸ“„ ë¬¸ì„œ ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            echo "ğŸ“¤ ë¬¸ì„œ ë³€ê²½ì‚¬í•­ ì»¤ë°‹..."
            git add docs/
            git commit -m "ğŸ“š ìë™ ë¬¸ì„œ ì—…ë°ì´íŠ¸

            - API ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œ ìë™ ìƒì„±
            - ì‚¬ìš©ì ë§¤ë‰´ì–¼ ì—…ë°ì´íŠ¸  
            - ê°œë°œì ê°€ì´ë“œ ë™ê¸°í™”
            
            ğŸ¤– Generated by SafeWork Documentation System
            â° $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
            
            git push origin HEAD
            echo "âœ… ë¬¸ì„œ ë³€ê²½ì‚¬í•­ í‘¸ì‹œ ì™„ë£Œ"
          fi

  # ğŸ“‹ ë¬¸ì„œ í’ˆì§ˆ ê²€ì‚¬
  documentation-quality-check:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ“‹ ë¬¸ì„œ í’ˆì§ˆ ë° ì¼ê´€ì„± ê²€ì‚¬
        run: |
          echo "ğŸ“‹ SafeWork ë¬¸ì„œ í’ˆì§ˆ ê²€ì‚¬..."
          
          # ë¬¸ì„œ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
          REQUIRED_DOCS=(
            "README.md"
            "CLAUDE.md" 
            "docs/API.md"
            "docs/USER_MANUAL.md"
            "docs/DEVELOPER_GUIDE.md"
          )
          
          MISSING_DOCS=()
          for doc in "${REQUIRED_DOCS[@]}"; do
            if [ ! -f "$doc" ]; then
              MISSING_DOCS+=("$doc")
            else
              echo "âœ… $doc ì¡´ì¬"
            fi
          done
          
          if [ ${#MISSING_DOCS[@]} -gt 0 ]; then
            echo "âŒ ëˆ„ë½ëœ ë¬¸ì„œ:"
            printf '  - %s\n' "${MISSING_DOCS[@]}"
          else
            echo "âœ… ëª¨ë“  í•„ìˆ˜ ë¬¸ì„œ ì¡´ì¬"
          fi
          
          # ë¬¸ì„œ ë‚´ìš© í’ˆì§ˆ ê²€ì‚¬
          echo "ğŸ” ë¬¸ì„œ ë‚´ìš© í’ˆì§ˆ ê²€ì‚¬..."
          
          # í•œê¸€ ë¬¸ì„œ ê¹¨ì§ ê²€ì‚¬
          if find docs/ -name "*.md" -exec grep -l "????" {} \; | head -5; then
            echo "âš ï¸ í•œê¸€ ê¹¨ì§ ë¬¸ì„œ ë°œê²¬"
          fi
          
          # ë§í¬ ê²€ì‚¬ (ê¸°ë³¸ì ì¸ ë‚´ë¶€ ë§í¬)
          echo "ğŸ”— ë‚´ë¶€ ë§í¬ ê²€ì‚¬..."
          BROKEN_LINKS=$(find docs/ -name "*.md" -exec grep -H "](.*\.md)" {} \; | while read line; do
            file=$(echo "$line" | cut -d: -f1)
            link=$(echo "$line" | sed 's/.*](\([^)]*\)).*/\1/')
            if [[ "$link" == *".md" ]] && [ ! -f "$(dirname "$file")/$link" ] && [ ! -f "$link" ]; then
              echo "$file: $link"
            fi
          done)
          
          if [ -n "$BROKEN_LINKS" ]; then
            echo "ğŸ”— ê¹¨ì§„ ë‚´ë¶€ ë§í¬ ë°œê²¬:"
            echo "$BROKEN_LINKS"
          else
            echo "âœ… ë‚´ë¶€ ë§í¬ ê²€ì‚¬ í†µê³¼"
          fi
          
          # ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë‚ ì§œ í™•ì¸
          echo "ğŸ“… ë¬¸ì„œ ìµœì‹ ì„± í™•ì¸..."
          find docs/ -name "*.md" -mtime +30 -ls | while read old_doc; do
            echo "âš ï¸ 30ì¼ ì´ìƒ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ë¬¸ì„œ: $old_doc"
          done

      - name: ğŸ“Š ë¬¸ì„œ í†µê³„ ë° ë¦¬í¬íŠ¸
        run: |
          echo "ğŸ“Š SafeWork ë¬¸ì„œ í†µê³„..."
          
          # ë¬¸ì„œ íŒŒì¼ ê°œìˆ˜
          TOTAL_DOCS=$(find . -name "*.md" | wc -l)
          DOCS_SIZE=$(find . -name "*.md" -exec cat {} \; | wc -c)
          DOCS_LINES=$(find . -name "*.md" -exec cat {} \; | wc -l)
          
          echo "ğŸ“ˆ ë¬¸ì„œ í†µê³„:"
          echo "  - ì´ ë¬¸ì„œ íŒŒì¼: $TOTAL_DOCS ê°œ"
          echo "  - ì´ ë¬¸ì„œ í¬ê¸°: $(numfmt --to=iec $DOCS_SIZE)B"
          echo "  - ì´ ë¬¸ì„œ ë¼ì¸: $DOCS_LINES ì¤„"
          
          # ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
          echo "ğŸ“‹ ì¹´í…Œê³ ë¦¬ë³„ ë¬¸ì„œ:"
          echo "  - API ë¬¸ì„œ: $(find docs/ -name "*API*" -o -name "*api*" | wc -l) ê°œ"
          echo "  - ì‚¬ìš©ì ê°€ì´ë“œ: $(find docs/ -name "*USER*" -o -name "*user*" -o -name "*MANUAL*" | wc -l) ê°œ"
          echo "  - ê°œë°œì ê°€ì´ë“œ: $(find docs/ -name "*DEV*" -o -name "*dev*" | wc -l) ê°œ"
          echo "  - ì„¤ì • íŒŒì¼: $(find . -name "*.md" -path "./.github/*" | wc -l) ê°œ"
          
          echo "âœ… ë¬¸ì„œ í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"

  # ğŸ“ˆ ë¬¸ì„œ ë™ê¸°í™” ê²°ê³¼ ë¦¬í¬íŠ¸
  documentation-report:
    needs: [generate-api-docs, documentation-quality-check]
    if: always()
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“ˆ SafeWork ë¬¸ì„œ ë™ê¸°í™” ê²°ê³¼ ë¦¬í¬íŠ¸
        run: |
          echo "ğŸ“ˆ SafeWork ë¬¸ì„œ ë™ê¸°í™” ì™„ë£Œ ë¦¬í¬íŠ¸"
          echo "â° ì™„ë£Œ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          
          # ì‘ì—… ê²°ê³¼ ìš”ì•½
          echo "ğŸ¯ ì‘ì—… ê²°ê³¼ ìš”ì•½:"
          echo "  - API ë¬¸ì„œ ìƒì„±: ${{ needs.generate-api-docs.result }}"
          echo "  - ë¬¸ì„œ í’ˆì§ˆ ê²€ì‚¬: ${{ needs.documentation-quality-check.result }}"
          
          if [ "${{ needs.generate-api-docs.result }}" = "success" ] && [ "${{ needs.documentation-quality-check.result }}" = "success" ]; then
            echo "âœ… ëª¨ë“  ë¬¸ì„œ ë™ê¸°í™” ì‘ì—… ì„±ê³µ!"
            echo "ğŸ“š ì—…ë°ì´íŠ¸ëœ ë¬¸ì„œ:"
            echo "  - docs/API.md (API ì—”ë“œí¬ì¸íŠ¸ ìë™ ìƒì„±)"
            echo "  - docs/USER_MANUAL.md (ì‚¬ìš©ì ë§¤ë‰´ì–¼)"
            echo "  - docs/DEVELOPER_GUIDE.md (ê°œë°œì ê°€ì´ë“œ)"
            echo "  - docs/api-endpoints.json (API ë©”íƒ€ë°ì´í„°)"
          else
            echo "âš ï¸ ì¼ë¶€ ë¬¸ì„œ ë™ê¸°í™” ì‘ì—… ì‹¤íŒ¨"
          fi
          
          echo "ğŸ”„ ë‹¤ìŒ ìë™ ë™ê¸°í™”: ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 2ì‹œ"
          echo "ğŸ“ ë¬¸ì„œ ê´€ë ¨ ë¬¸ì˜: @claude ë©˜ì…˜ìœ¼ë¡œ ì¦‰ì‹œ ì§€ì›"