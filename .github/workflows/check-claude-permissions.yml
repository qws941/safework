name: Claude Token ê¶Œí•œ í™•ì¸

on:
  workflow_dispatch:

jobs:
  check-permissions:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      issues: write
      id-token: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Claude í† í° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        run: |
          echo "ğŸ” Claude OAuth Token í™•ì¸ ì¤‘..."
          if [ -z "${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}" ]; then
            echo "âŒ CLAUDE_CODE_OAUTH_TOKENì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!"
            echo ""
            echo "ì„¤ì • ë°©ë²•:"
            echo "1. https://claude.ai â†’ Settings â†’ Developer"
            echo "2. API Key ìƒì„±"
            echo "3. GitHub â†’ Settings â†’ Secrets â†’ CLAUDE_CODE_OAUTH_TOKEN ì¶”ê°€"
            exit 1
          else
            echo "âœ… CLAUDE_CODE_OAUTH_TOKENì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
            TOKEN_LENGTH=$(echo '${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}' | wc -c)
            echo "í† í° ê¸¸ì´: $TOKEN_LENGTH ë¬¸ì"
            
            if [ $TOKEN_LENGTH -lt 50 ]; then
              echo "âš ï¸  í† í°ì´ ë„ˆë¬´ ì§§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ Claude OAuth í† í°ì¸ì§€ í™•ì¸í•˜ì„¸ìš”."
            elif [ $TOKEN_LENGTH -gt 200 ]; then
              echo "âš ï¸  í† í°ì´ ë„ˆë¬´ ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Claude OAuth í† í°ì¸ì§€ í™•ì¸í•˜ì„¸ìš”."
            else
              echo "âœ… í† í° ê¸¸ì´ê°€ ì •ìƒì ì…ë‹ˆë‹¤."
            fi
          fi
      
      - name: Claude Code Action ê¶Œí•œ í…ŒìŠ¤íŠ¸
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            ğŸ” **Claude Code ê¶Œí•œ í…ŒìŠ¤íŠ¸**
            
            í˜„ì¬ ë‹¤ìŒ ê¶Œí•œì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤:
            
            1. âœ… ì €ì¥ì†Œ ì½ê¸° ê¶Œí•œ
            2. âœ… ì´ìŠˆ ì½ê¸°/ì“°ê¸° ê¶Œí•œ  
            3. âœ… PR ì½ê¸°/ì“°ê¸° ê¶Œí•œ
            4. âœ… ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê¶Œí•œ
            
            ì´ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ ê¸°ë³¸ ê¶Œí•œì€ ì •ìƒì…ë‹ˆë‹¤! ğŸ‰
            
            **ë‹¤ìŒìœ¼ë¡œ í•  ì¼:**
            - ì‹¤ì œ ì´ìŠˆì—ì„œ @claude ë©˜ì…˜ í…ŒìŠ¤íŠ¸
            - PRì—ì„œ Claude ì‹¤í–‰ í…ŒìŠ¤íŠ¸
            - ë³µì¡í•œ ì‘ì—… ìˆ˜í–‰ í…ŒìŠ¤íŠ¸
          claude_args: |
            --max-turns 2
            --use-tools
      
      - name: GitHub API ì ‘ê·¼ ê¶Œí•œ í™•ì¸
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ğŸ” GitHub API ì ‘ê·¼ ê¶Œí•œ í™•ì¸..."
          
          # Repository ì •ë³´ í™•ì¸
          REPO_INFO=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/${{ github.repository }}")
          
          if echo "$REPO_INFO" | grep -q '"full_name"'; then
            echo "âœ… Repository ì½ê¸° ê¶Œí•œ í™•ì¸"
          else
            echo "âŒ Repository ì½ê¸° ê¶Œí•œ ì—†ìŒ"
          fi
          
          # Issues ê¶Œí•œ í™•ì¸  
          ISSUES_URL="https://api.github.com/repos/${{ github.repository }}/issues"
          ISSUES_RESPONSE=$(curl -s -w "%{http_code}" -H "Authorization: token $GITHUB_TOKEN" "$ISSUES_URL")
          HTTP_CODE=$(echo "$ISSUES_RESPONSE" | tail -n1)
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Issues ì½ê¸° ê¶Œí•œ í™•ì¸"
          else
            echo "âŒ Issues ì ‘ê·¼ ì‹¤íŒ¨ (HTTP: $HTTP_CODE)"
          fi
          
          # Pull Requests ê¶Œí•œ í™•ì¸
          PRS_URL="https://api.github.com/repos/${{ github.repository }}/pulls"
          PRS_RESPONSE=$(curl -s -w "%{http_code}" -H "Authorization: token $GITHUB_TOKEN" "$PRS_URL")
          HTTP_CODE=$(echo "$PRS_RESPONSE" | tail -n1)
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Pull Requests ì½ê¸° ê¶Œí•œ í™•ì¸"
          else
            echo "âŒ Pull Requests ì ‘ê·¼ ì‹¤íŒ¨ (HTTP: $HTTP_CODE)"
          fi
          
          echo ""
          echo "ğŸ¯ ê¶Œí•œ í™•ì¸ ì™„ë£Œ!"
          echo "Claude Codeê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤."