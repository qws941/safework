name: SafeWork Advanced Claude Automation

on:
  issues:
    types: [opened, edited, labeled, unlabeled]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  workflow_run:
    workflows: ["*"]
    types: [completed]
    branches: [master, main]
  schedule:
    # ë§¤ì¼ 09:00 KST (00:00 UTC) - ëŠ¥ë™ì  ì´ìŠˆ ìŠ¤ìº”
    - cron: '0 0 * * *'
  workflow_dispatch:
    inputs:
      scan_mode:
        description: 'ìŠ¤ìº” ëª¨ë“œ'
        required: false
        default: 'auto'
        type: choice
        options:
          - 'auto'
          - 'issues-only'
          - 'pr-review'
          - 'ci-fix'
          - 'full-analysis'

env:
  TIMEZONE: 'Asia/Seoul'
  SAFEWORK_VERSION: 'v3.2'
  REGISTRY_URL: 'registry.jclee.me'

jobs:
  # Job 1: ì§€ëŠ¥í˜• ì´ìŠˆ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ í• ë‹¹
  intelligent_issue_triage:
    name: ğŸ¯ ì§€ëŠ¥í˜• ì´ìŠˆ ë¶„ë¥˜
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: |
      github.event_name == 'issues' || 
      github.event_name == 'schedule' ||
      (github.event_name == 'workflow_dispatch' && (inputs.scan_mode == 'auto' || inputs.scan_mode == 'issues-only'))
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
      checks: write
      statuses: write
      repository-projects: write
      security-events: write
      deployments: write
    
    outputs:
      priority: ${{ steps.analysis.outputs.priority }}
      category: ${{ steps.analysis.outputs.category }}
      needs_review: ${{ steps.analysis.outputs.needs_review }}
      
    steps:
      - name: ğŸš€ ì´ìŠˆ ë¶„ì„ ì‹œì‘ ì•Œë¦¼
        uses: actions/github-script@v7
        if: github.event_name == 'issues' || github.event_name == 'issue_comment'
        with:
          script: |
            if (context.eventName === 'issue_comment') {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `ğŸ¤– **Claude ìë™í™” ì‹œì‘!**
                
                ğŸ“Š **ì§„í–‰ ìƒí™©**: ì´ìŠˆ ë¶„ì„ ì¤‘...
                â° **ì‹œì‘ ì‹œê°„**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})} KST
                ğŸ¯ **ë¶„ì„ ë‹¨ê³„**: 
                - ğŸ” ì´ìŠˆ ë‚´ìš© ë¶„ì„
                - ğŸ“‹ ìš°ì„ ìˆœìœ„ íŒì •
                - ğŸ·ï¸ ìë™ ë¼ë²¨ë§
                - ğŸ”— ê´€ë ¨ URL ì œê³µ
                
                ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... âš¡`
              });
            } else if (context.eventName === 'issues') {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `ğŸ‰ **ìƒˆ ì´ìŠˆ ìë™ ë¶„ì„ ì‹œì‘!**
                
                ğŸ“Š **SafeWork Claude ìë™í™” ì‹œìŠ¤í…œ**ì´ ì´ ì´ìŠˆë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.
                â° **ë¶„ì„ ì‹œì‘**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})} KST
                
                ğŸ”„ **ìë™ìœ¼ë¡œ ìˆ˜í–‰í•  ì‘ì—…**:
                - ğŸ¯ ìš°ì„ ìˆœìœ„ ìë™ ë¶„ë¥˜ (P0~P3)
                - ğŸ·ï¸ SafeWork ë„ë©”ì¸ íŠ¹í™” ë¼ë²¨ë§
                - ğŸ“ ê´€ë ¨ ë‹´ë‹¹ì í• ë‹¹
                - ğŸ”— í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ endpoint URL ì œê³µ
                
                ë¶„ì„ì´ ì™„ë£Œë˜ë©´ ìƒì„¸í•œ ê²°ê³¼ë¥¼ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤! ğŸš€`
              });
            }

      - name: ğŸ” SafeWork ì´ìŠˆ ì§€ëŠ¥ ë¶„ì„
        id: analysis
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork ì‚°ì—…ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ìŠˆ ë¶„ë¥˜ ì „ë¬¸ê°€
            
            ë‹¹ì‹ ì€ SafeWork í”„ë¡œì íŠ¸ì˜ **ì´ìŠˆ ë¶„ë¥˜ ë° ìš°ì„ ìˆœìœ„ í• ë‹¹ ì „ë¬¸ê°€**ì…ë‹ˆë‹¤.
            
            ## ğŸ—ï¸ SafeWork ì‹œìŠ¤í…œ ì´í•´
            - **Flask 3.0 ê¸°ë°˜**: ì‚°ì—…ì•ˆì „ë³´ê±´ ê´€ë¦¬ ì‹œìŠ¤í…œ
            - **í•µì‹¬ ê¸°ëŠ¥**: ê·¼ê³¨ê²©ê³„ ì„¤ë¬¸(001), ì‹ ì…ì‚¬ì› ê±´ê°•ê²€ì§„(002), 13ê°œ ê´€ë¦¬ì íŒ¨ë„
            - **ê¸°ìˆ  ìŠ¤íƒ**: Python Flask, SQLAlchemy, MySQL 8.0, Redis, Bootstrap
            - **ìš´ì˜í™˜ê²½**: registry.jclee.me, í•œêµ­ ì‹œê°„ëŒ€(KST), í•œêµ­ì–´ ì§€ì›
            
            ## ğŸ“‹ ì´ìŠˆ ë¶„ë¥˜ ê¸°ì¤€
            
            ### ìš°ì„ ìˆœìœ„ (Priority)
            - **P0-CRITICAL**: ì‹œìŠ¤í…œ ë‹¤ìš´, ë°ì´í„° ì†ì‹¤, ë³´ì•ˆ ì·¨ì•½ì 
            - **P1-HIGH**: ì„¤ë¬¸ ì œì¶œ ì‹¤íŒ¨, ê´€ë¦¬ì ê¸°ëŠ¥ ì˜¤ë¥˜, ì„±ëŠ¥ ì´ìŠˆ
            - **P2-MEDIUM**: UI/UX ê°œì„ , ìƒˆ ê¸°ëŠ¥ ì¶”ê°€
            - **P3-LOW**: ë¬¸ì„œí™”, ì½”ë“œ ì •ë¦¬, ë§ˆì´ë„ˆ ê°œì„ 
            
            ### ì¹´í…Œê³ ë¦¬ (Category)
            - **survey**: ì„¤ë¬¸ì¡°ì‚¬ ì‹œìŠ¤í…œ (001/002 í¼)
            - **admin**: SafeWork ê´€ë¦¬ì íŒ¨ë„ë“¤
            - **database**: MySQL/Redis ê´€ë ¨
            - **auth**: ì¸ì¦/ê¶Œí•œ ì‹œìŠ¤í…œ
            - **api**: RESTful API (v2.0)
            - **ui**: í”„ë¡ íŠ¸ì—”ë“œ/í…œí”Œë¦¿
            - **infra**: Docker/ë°°í¬ ê´€ë ¨
            - **security**: ë³´ì•ˆ ê´€ë ¨
            - **docs**: ë¬¸ì„œí™”
            
            ## ğŸ¯ ì‘ì—… ì§€ì‹œ
            1. í˜„ì¬ ì´ìŠˆë¥¼ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ìš°ì„ ìˆœìœ„ì™€ ì¹´í…Œê³ ë¦¬ í• ë‹¹
            2. SafeWork íŠ¹í™” ë¼ë²¨ ìë™ ì ìš©
            3. í•œêµ­ì–´ ì´ìŠˆì¸ ê²½ìš° 'ko' ë¼ë²¨ ì¶”ê°€
            4. ê¸´ê¸‰ ì´ìŠˆì¸ ê²½ìš° ê´€ë ¨ ë‹´ë‹¹ì íƒœê¹…
            5. ê´€ë ¨ endpoint URL ì •ë³´ ì œê³µ
            
            ## ğŸ“Š ì¶œë ¥ í˜•ì‹
            ë‹¤ìŒ GitHub Actions outputsì„ ì„¤ì •í•´ì£¼ì„¸ìš”:
            - priority: P0-CRITICAL, P1-HIGH, P2-MEDIUM, P3-LOW ì¤‘ í•˜ë‚˜
            - category: ìœ„ ì¹´í…Œê³ ë¦¬ ì¤‘ í•˜ë‚˜
            - needs_review: true/false (ì½”ë“œ ë¦¬ë·° í•„ìš” ì—¬ë¶€)
            
            Korean ì‹œê°„ëŒ€(KST)ë¡œ í˜„ì¬ ì‹œê°ì„ í‘œì‹œí•˜ê³  ì´ìŠˆ ë¶„ì„ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.

  # Job 2: SafeWork íŠ¹í™” PR ì¢…í•© ë¦¬ë·°
  comprehensive_pr_review:
    name: ğŸ” SafeWork PR ì¢…í•© ë¦¬ë·°
    runs-on: ubuntu-latest
    timeout-minutes: 20
    if: |
      github.event_name == 'pull_request' ||
      (github.event_name == 'workflow_dispatch' && (inputs.scan_mode == 'auto' || inputs.scan_mode == 'pr-review'))
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
      checks: write
      statuses: write
      repository-projects: write
      security-events: write
      deployments: write
    
    steps:
      - name: ğŸš€ PR ë¦¬ë·° ì‹œì‘ ì•Œë¦¼
        uses: actions/github-script@v7
        if: github.event_name == 'pull_request'
        with:
          script: |
            await github.rest.pulls.createReview({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
              body: `ğŸ” **SafeWork PR ì¢…í•© ë¦¬ë·° ì‹œì‘!**
              
              ğŸ“Š **5ì°¨ì› ë¶„ì„ ì§„í–‰ ì¤‘**:
              - ğŸ”’ ë³´ì•ˆ & ì»´í”Œë¼ì´ì–¸ìŠ¤ (ê°œì¸ê±´ê°•ì •ë³´ ë³´í˜¸)
              - ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± (MySQL íŠ¸ëœì­ì…˜)
              - ğŸ¨ SafeWork UX/UI (í•œêµ­ì–´ ì§€ì›, ë°˜ì‘í˜•)
              - âš¡ ì„±ëŠ¥ & í™•ì¥ì„± (Redis ìºì‹±)
              - ğŸ§ª í…ŒìŠ¤íŠ¸ & í’ˆì§ˆ (Pytest, Flask íŒ¨í„´)
              
              â° **ì‹œì‘ ì‹œê°„**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})} KST
              
              ìƒì„¸í•œ ë¦¬ë·° ê²°ê³¼ë¥¼ ê³§ ì œê³µí•´ë“œë¦½ë‹ˆë‹¤! ğŸš€`,
              event: 'COMMENT'
            });

      - name: ğŸ“Š SafeWork PR ë‹¤ì°¨ì› ë¶„ì„
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork ì½”ë“œ ë¦¬ë·° ì „ë¬¸ê°€
            
            ë‹¹ì‹ ì€ SafeWork ì‚°ì—…ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ **ì½”ë“œ ë¦¬ë·° ì „ë¬¸ê°€**ì…ë‹ˆë‹¤.
            
            ## ğŸ¯ SafeWork íŠ¹í™” ë¦¬ë·° ê¸°ì¤€
            
            ### 1. ğŸ”’ ë³´ì•ˆ & ì»´í”Œë¼ì´ì–¸ìŠ¤ (ìµœìš°ì„ )
            - [ ] ê°œì¸ê±´ê°•ì •ë³´(PHI) ì²˜ë¦¬ ë³´ì•ˆ ê²€ì¦
            - [ ] CSRF í† í° ì ìš© í™•ì¸
            - [ ] SQL Injection ë°©ì§€ (SQLAlchemy ORM ì‚¬ìš©)
            - [ ] ë¡œê·¸ì¸ í•„ìˆ˜ decorator ì ìš©
            - [ ] ì‚°ì—…ì•ˆì „ë³´ê±´ë²• ë°ì´í„° ì²˜ë¦¬ ê·œì • ì¤€ìˆ˜
            
            ### 2. ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„±
            - [ ] MySQL 8.0 íŠ¸ëœì­ì…˜ ì ìš©
            - [ ] ë¡¤ë°± ë¡œì§ êµ¬í˜„
            - [ ] ì¸ë±ìŠ¤ ì„±ëŠ¥ ê³ ë ¤
            - [ ] UTF8MB4 charset í˜¸í™˜ì„±
            - [ ] Redis ìºì‹± ì „ëµ ê²€í† 
            
            ### 3. ğŸ¨ SafeWork UX/UI
            - [ ] Bootstrap 4.6 ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì¤€ìˆ˜
            - [ ] ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼/íƒœë¸”ë¦¿)
            - [ ] í•œêµ­ì–´ í…ìŠ¤íŠ¸ ë° KST ì‹œê°„ í‘œì‹œ
            - [ ] Font Awesome ì•„ì´ì½˜ ì¼ê´€ì„±
            - [ ] ì ‘ê·¼ì„± í‘œì¤€ (WCAG 2.1) ê³ ë ¤
            
            ### 4. âš¡ ì„±ëŠ¥ & í™•ì¥ì„±
            - [ ] ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
            - [ ] Redis ìºì‹± íš¨ìœ¨ì„±
            - [ ] í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„
            - [ ] ì„¤ë¬¸ í¼ ë¡œë”© ì†ë„
            - [ ] Docker ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”
            
            ### 5. ğŸ§ª í…ŒìŠ¤íŠ¸ & í’ˆì§ˆ
            - [ ] Pytest í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€
            - [ ] Flask Blueprint íŒ¨í„´ ì¤€ìˆ˜
            - [ ] Error handler ë° ë¡œê¹…
            - [ ] í•œêµ­ì–´ ì˜¤ë¥˜ ë©”ì‹œì§€
            - [ ] ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ìœ ì§€
            
            ## ğŸ“‹ ë¦¬ë·° í”„ë¡œì„¸ìŠ¤
            1. ë³€ê²½ëœ íŒŒì¼ë“¤ì„ SafeWork ì•„í‚¤í…ì²˜ ê´€ì ì—ì„œ ë¶„ì„
            2. ê° ë¦¬ë·° ê¸°ì¤€ë³„ë¡œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ì„±
            3. ë°œê²¬ëœ ì´ìŠˆì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê°œì„  ë°©ì•ˆ ì œì‹œ
            4. SafeWork endpoint URL ê²€ì¦ ë° í…ŒìŠ¤íŠ¸ ë°©ë²• ì•ˆë‚´
            5. ë°°í¬ ì „ í™•ì¸ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì œê³µ
            
            ## ğŸ”— ê´€ë ¨ URL ì •ë³´
            ê°œë°œí™˜ê²½: http://localhost:4545
            ìš´ì˜í™˜ê²½: https://safewokr.jclee.me
            
            Korean ì‹œê°„ëŒ€(KST)ë¡œ ë¦¬ë·°ë¥¼ ì§„í–‰í•˜ê³  í•œêµ­ì–´ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”.

  # Job 3: CI ì‹¤íŒ¨ ìë™ ìˆ˜ì • (SafeWork íŠ¹í™”)
  safework_ci_auto_fix:
    name: ğŸ”§ SafeWork CI ìë™ ìˆ˜ì •
    runs-on: ubuntu-latest
    timeout-minutes: 25
    if: |
      (github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure') ||
      (github.event_name == 'workflow_dispatch' && inputs.scan_mode == 'ci-fix')
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
      checks: write
      statuses: write
      repository-projects: write
      security-events: write
      deployments: write
    
    steps:
      - name: ğŸš€ CI ìë™ ìˆ˜ì • ì‹œì‘ ì•Œë¦¼
        uses: actions/github-script@v7
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
        with:
          script: |
            const workflowName = context.payload.workflow_run.name;
            const workflowUrl = context.payload.workflow_run.html_url;
            
            // ê´€ë ¨ ì´ìŠˆë‚˜ PR ì°¾ê¸° (ê°„ë‹¨í•œ íœ´ë¦¬ìŠ¤í‹±)
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              sort: 'updated',
              per_page: 5
            });
            
            const recentIssue = issues.data.find(issue => 
              issue.updated_at > new Date(Date.now() - 30 * 60 * 1000).toISOString()
            );
            
            if (recentIssue) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: recentIssue.number,
                body: `ğŸš¨ **CI ì‹¤íŒ¨ ìë™ ìˆ˜ì • ì‹œì‘!**
                
                **ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œìš°**: [${workflowName}](${workflowUrl})
                â° **ìˆ˜ì • ì‹œì‘**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})} KST
                
                ğŸ”§ **ìë™ ìˆ˜ì • ì§„í–‰ ë‹¨ê³„**:
                - ğŸ“Š ì‹¤íŒ¨ ë¡œê·¸ ë¶„ì„ ì¤‘...
                - ğŸ” ê·¼ë³¸ ì›ì¸ íŒŒì•…
                - âš™ï¸ SafeWork íŠ¹í™” ìˆ˜ì • ì ìš©
                - ğŸŒŸ ìƒˆ ë¸Œëœì¹˜ ìƒì„± ë° PR
                - âœ… ìë™ í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰
                
                **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 5-10ë¶„
                ìˆ˜ì •ì´ ì™„ë£Œë˜ë©´ ê²°ê³¼ë¥¼ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤! ğŸ› ï¸`
              });
            }

      - name: ğŸš¨ SafeWork CI ì‹¤íŒ¨ ìë™ ì§„ë‹¨ ë° ìˆ˜ì •
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork CI/CD ìë™ ìˆ˜ì • ì—”ì§€ë‹ˆì–´
            
            ë‹¹ì‹ ì€ SafeWork í”„ë¡œì íŠ¸ì˜ **CI/CD ìë™ ìˆ˜ì • ì „ë¬¸ê°€**ì…ë‹ˆë‹¤.
            
            ## ğŸ—ï¸ SafeWork CI í™˜ê²½ ì´í•´
            - **Flask 3.0**: Python ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
            - **í…ŒìŠ¤íŠ¸**: Pytest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸
            - **ë¦°í„°**: Black, Flake8, Bandit (ë³´ì•ˆ)
            - **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0 + Redis
            - **ë°°í¬**: Docker â†’ registry.jclee.me
            - **ë³´ì•ˆ ìŠ¤ìº”**: Trivy, Safety
            
            ## ğŸ”§ ì¼ë°˜ì ì¸ SafeWork CI ì‹¤íŒ¨ íŒ¨í„´
            
            ### Python/Flask ê´€ë ¨
            - requirements.txt ì˜ì¡´ì„± ì¶©ëŒ
            - SQLAlchemy ëª¨ë¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜  
            - Flask Blueprint import ì˜¤ë¥˜
            - Jinja2 í…œí”Œë¦¿ ë¬¸ë²• ì˜¤ë¥˜
            - Korean charset (UTF-8) ì¸ì½”ë”© ë¬¸ì œ
            
            ### í…ŒìŠ¤íŠ¸ ê´€ë ¨
            - MySQL í…ŒìŠ¤íŠ¸ DB ì—°ê²° ì‹¤íŒ¨
            - Redis ìºì‹œ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì˜¤ë¥˜
            - Flask app context ë¬¸ì œ
            - í•œêµ­ì‹œê°„(KST) timezone í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
            
            ### ë³´ì•ˆ/ë¦°íŒ… ê´€ë ¨
            - Bandit ë³´ì•ˆ ìŠ¤ìº” ì•Œë¦¼
            - Black ì½”ë“œ í¬ë§·íŒ…
            - Flake8 PEP8 ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
            - í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ ê°ì§€
            
            ### Docker/ë°°í¬ ê´€ë ¨
            - Docker ì´ë¯¸ì§€ ë¹Œë“œ ì‹¤íŒ¨
            - registry.jclee.me ì¸ì¦ ì˜¤ë¥˜
            - ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ ìµœì í™”
            
            ## ğŸ¯ ìë™ ìˆ˜ì • ì „ëµ
            1. CI ì‹¤íŒ¨ ë¡œê·¸ ë¶„ì„ ë° ê·¼ë³¸ ì›ì¸ íŒŒì•…
            2. SafeWork ì½”ë”© íŒ¨í„´ì— ë§ëŠ” ìˆ˜ì • ë°©ì•ˆ ì ìš©
            3. ìƒˆë¡œìš´ ë¸Œëœì¹˜ ìƒì„± (hotfix/ci-auto-fix-{timestamp})
            4. í•œêµ­ì–´ ì»¤ë°‹ ë©”ì‹œì§€ë¡œ ìˆ˜ì • ë‚´ì—­ ê¸°ë¡
            5. PR ìƒì„± ë° ìë™ í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰
            
            ## ğŸ“‹ ìˆ˜ì • í›„ ê²€ì¦ ì ˆì°¨
            1. ì „ì²´ pytest ìŠ¤ìœ„íŠ¸ í†µê³¼ í™•ì¸
            2. ë³´ì•ˆ ìŠ¤ìº” í†µê³¼ í™•ì¸
            3. Docker ì´ë¯¸ì§€ ë¹Œë“œ ì„±ê³µ í™•ì¸
            4. SafeWork í•µì‹¬ ê¸°ëŠ¥ smoke test
            
            í˜„ì¬ ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ë¶„ì„í•˜ê³  ìë™ ìˆ˜ì •ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.
            ëª¨ë“  ì‘ì—…ì€ Korean ì‹œê°„ëŒ€(KST)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰í•˜ê³  í•œêµ­ì–´ë¡œ ê²°ê³¼ë¥¼ ë³´ê³ í•´ì£¼ì„¸ìš”.

  # Job 4: ëŠ¥ë™ì  í”„ë¡œì íŠ¸ ê±´ê°•ë„ ì²´í¬
  proactive_health_check:
    name: ğŸ¥ SafeWork í”„ë¡œì íŠ¸ ê±´ê°•ë„ ì²´í¬
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: |
      github.event_name == 'schedule' ||
      (github.event_name == 'workflow_dispatch' && inputs.scan_mode == 'full-analysis')
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
      checks: write
      statuses: write
      repository-projects: write
      security-events: write
      deployments: write
    
    steps:
      - name: ğŸ“Š SafeWork í”„ë¡œì íŠ¸ ì¢…í•© ê±´ê°•ë„ ë¶„ì„
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork í”„ë¡œì íŠ¸ í—¬ìŠ¤ ì²´í¬ ì „ë¬¸ê°€
            
            ë‹¹ì‹ ì€ SafeWork í”„ë¡œì íŠ¸ì˜ **ì¢…í•© ê±´ê°•ë„ ë¶„ì„ê°€**ì…ë‹ˆë‹¤.
            
            ## ğŸ¯ ì¼ì¼ ê±´ê°•ë„ ì²´í¬ í•­ëª©
            
            ### 1. ğŸ“‹ ì´ìŠˆ ê´€ë¦¬ ìƒíƒœ
            - ì—´ë¦° ì´ìŠˆ ìˆ˜ ë° í‰ê·  í•´ê²° ì‹œê°„
            - P0/P1 ê¸´ê¸‰ ì´ìŠˆ ì¥ê¸° ë¯¸í•´ê²° ê±´
            - ì¤‘ë³µ ì´ìŠˆ ë°œìƒ íŒ¨í„´
            - ì´ìŠˆ ë¶„ë¥˜ ì •í™•ë„
            
            ### 2. ğŸ”„ CI/CD íŒŒì´í”„ë¼ì¸ ê±´ê°•ë„  
            - ìµœê·¼ 7ì¼ ë¹Œë“œ ì„±ê³µë¥ 
            - í‰ê·  ë¹Œë“œ ì‹œê°„ ë³€í™”
            - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¶”ì´
            - ë°°í¬ ë¹ˆë„ ë° ì‹¤íŒ¨ìœ¨
            
            ### 3. ğŸ“Š ì½”ë“œ í’ˆì§ˆ ì§€í‘œ
            - ê¸°ìˆ  ë¶€ì±„ ëˆ„ì ë„
            - ì½”ë“œ ë³µì¡ë„ ì¦ê°€ ì¶”ì´
            - ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº” ê²°ê³¼
            - ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ í•„ìš” í˜„í™©
            
            ### 4. ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
            - MySQL ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë°œìƒ íŒ¨í„´
            - Redis ìºì‹œ íˆíŠ¸ìœ¨
            - ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ì ìš© ê±´
            - ë°ì´í„° ë¬´ê²°ì„± ì²´í¬
            
            ### 5. ğŸŒ ìš´ì˜í™˜ê²½ ëª¨ë‹ˆí„°ë§
            - safewokr.jclee.me ì‘ë‹µ ì‹œê°„
            - Docker ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìš©ëŸ‰
            - ì„¤ë¬¸ì¡°ì‚¬ ì‹œìŠ¤í…œ ê°€ìš©ì„±
            - ì‚¬ìš©ì í”¼ë“œë°± ë° ì˜¤ë¥˜ ë³´ê³ 
            
            ## ğŸ“ˆ ê±´ê°•ë„ ë¦¬í¬íŠ¸ ìƒì„±
            1. ê° í•­ëª©ë³„ ì ìˆ˜ (A/B/C/D/F)
            2. ì£¼ìš” ê°œì„  ê¶Œì¥ ì‚¬í•­
            3. ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš” í•­ëª©
            4. ë‹¤ìŒ ì£¼ ê°œì„  ê³„íš ì œì•ˆ
            5. ì„±ê³¼ ì§€í‘œ íŠ¸ë Œë“œ ë¶„ì„
            
            ## ğŸš¨ ìë™ ì•Œë¦¼ ê¸°ì¤€
            - ë¹Œë“œ ì„±ê³µë¥  80% ë¯¸ë§Œ
            - P0 ì´ìŠˆ 24ì‹œê°„ ì´ìƒ ë¯¸í•´ê²°
            - ë³´ì•ˆ ì·¨ì•½ì  ê°ì§€
            - ìš´ì˜í™˜ê²½ ì‘ë‹µì‹œê°„ 5ì´ˆ ì´ìƒ
            
            Korean ì‹œê°„ëŒ€(KST)ë¡œ í˜„ì¬ ì‹œê°ì„ í‘œì‹œí•˜ê³  ì¢…í•©ì ì¸ í”„ë¡œì íŠ¸ ê±´ê°•ë„ ë¶„ì„ì„ ì‹¤ì‹œí•´ì£¼ì„¸ìš”.
            ë°œê²¬ëœ ë¬¸ì œì ì— ëŒ€í•´ì„œëŠ” êµ¬ì²´ì ì¸ í•´ê²°ë°©ì•ˆì„ í•œêµ­ì–´ë¡œ ì œì‹œí•´ì£¼ì„¸ìš”.

  # Job 5: í†µí•© ë¦¬í¬íŒ… ë° ì•Œë¦¼
  integrated_reporting:
    name: ğŸ“¤ í†µí•© ë¦¬í¬íŒ…
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs: [intelligent_issue_triage, comprehensive_pr_review, safework_ci_auto_fix, proactive_health_check]
    if: always()
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      actions: write
      checks: write
      statuses: write
      repository-projects: write
      security-events: write
      deployments: write
    
    steps:
      - name: ğŸ“Š SafeWork ìë™í™” í†µí•© ë¦¬í¬íŠ¸ ìƒì„±
        uses: anthropics/claude-code-action@v1.0.5
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            # SafeWork í†µí•© ë¦¬í¬íŒ… ì‹œìŠ¤í…œ
            
            ## ğŸ“‹ ì‘ì—… ì™„ë£Œ ìƒíƒœ ìš”ì•½
            - **ì´ìŠˆ ë¶„ë¥˜**: ${{ needs.intelligent_issue_triage.result }}
            - **PR ë¦¬ë·°**: ${{ needs.comprehensive_pr_review.result }}  
            - **CI ìë™ ìˆ˜ì •**: ${{ needs.safework_ci_auto_fix.result }}
            - **ê±´ê°•ë„ ì²´í¬**: ${{ needs.proactive_health_check.result }}
            
            ## ğŸ¯ ë¦¬í¬íŒ… ì§€ì‹œì‚¬í•­
            1. ì™„ë£Œëœ ì‘ì—…ë“¤ì˜ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ í•œêµ­ì–´ë¡œ ë¦¬í¬íŠ¸ ìƒì„±
            2. SafeWork ê´€ë ¨ endpoint URL ì •ë³´ í¬í•¨
            3. ë‹¤ìŒ ê¶Œì¥ ì•¡ì…˜ ì•„ì´í…œ ì œì‹œ
            4. Korean ì‹œê°„ëŒ€(KST)ë¡œ ì‘ì—… ì™„ë£Œ ì‹œê°„ í‘œì‹œ
            5. ì´ìŠˆë‚˜ PRì— ê²°ê³¼ ì½”ë©˜íŠ¸ ìë™ ì‘ì„±
            
            ## ğŸ”— SafeWork Endpoint URLs
            - **ê°œë°œí™˜ê²½**: http://localhost:4545
            - **ìš´ì˜í™˜ê²½**: https://safewokr.jclee.me
            - **ì„¤ë¬¸ì¡°ì‚¬ 001**: https://safewokr.jclee.me/survey/001  
            - **ì„¤ë¬¸ì¡°ì‚¬ 002**: https://safewokr.jclee.me/survey/002
            - **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ**: https://safewokr.jclee.me/admin
            - **SafeWork ê´€ë¦¬**: https://safewokr.jclee.me/admin/safework
            - **API v2**: https://safewokr.jclee.me/api/safework/v2
            
            Korean ì‹œê°„ëŒ€ì™€ í•œêµ­ì–´ë¡œ ìµœì¢… í†µí•© ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.