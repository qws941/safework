name: SafeWork Security Monitoring

on:
  push:
    branches: [master, main]
    paths:
      - 'app/**/*.py'
      - 'app/models*.py'
      - 'app/requirements.txt'
      - 'docker-compose.yml'
  pull_request:
    branches: [master, main]
    paths:
      - 'app/**/*.py'
      - 'app/models*.py'
      - 'app/requirements.txt'
      - 'docker-compose.yml'
  schedule:
    - cron: '0 1 * * *'  # ë§¤ì¼ ì˜¤ì „ 1ì‹œ KST (ìì • UTC) ë³´ì•ˆ ìŠ¤ìº”
  workflow_dispatch:
    inputs:
      scan_type:
        description: 'ìŠ¤ìº” ìœ í˜•'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - dependency_check
          - secrets_scan
          - phi_audit

env:
  PYTHON_VERSION: '3.11'
  NODE_VERSION: '18'

jobs:
  # ğŸ” PHI(ê°œì¸ê±´ê°•ì •ë³´) ë³´í˜¸ ê²€ì‚¬
  phi-protection-audit:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ ë¶„ì„

      - name: ğŸ¥ PHI ë³´í˜¸ íŒ¨í„´ ê²€ì‚¬
        id: phi_check
        run: |
          echo "ğŸ¥ ê°œì¸ê±´ê°•ì •ë³´(PHI) ë³´í˜¸ íŒ¨í„´ ê²€ì‚¬ ì‹œì‘..."
          
          # PHI ê´€ë ¨ ìœ„í—˜ íŒ¨í„´ ê²€ìƒ‰
          PHI_VIOLATIONS=()
          
          # 1. ë¡œê·¸ì— ë¯¼ê°í•œ ì •ë³´ ì¶œë ¥ ê²€ì‚¬
          echo "ğŸ” ë¡œê·¸ ë³´ì•ˆ ê²€ì‚¬..."
          PHI_LOG_ISSUES=$(grep -r -n --include="*.py" -E "(print|log|logger)\s*\(.*\b(ssn|birthday|birth_date|medical|health|personal|private)" app/ || true)
          if [ -n "$PHI_LOG_ISSUES" ]; then
            echo "âš ï¸ PHI ë¡œê¹… ìœ„í—˜ ê°ì§€:"
            echo "$PHI_LOG_ISSUES"
            PHI_VIOLATIONS+=("PHI_LOGGING")
          fi
          
          # 2. í•˜ë“œì½”ë”©ëœ ì˜ë£Œ ì •ë³´ ê²€ì‚¬
          echo "ğŸ” í•˜ë“œì½”ë”©ëœ ì˜ë£Œì •ë³´ ê²€ì‚¬..."
          HARDCODED_MEDICAL=$(grep -r -n --include="*.py" -E "birth_date.*=.*[0-9]{4}-[0-9]{2}-[0-9]{2}|ssn.*=.*[0-9]{6}-[0-9]{7}" app/ || true)
          if [ -n "$HARDCODED_MEDICAL" ]; then
            echo "âš ï¸ í•˜ë“œì½”ë”©ëœ ì˜ë£Œì •ë³´ ê°ì§€:"
            echo "$HARDCODED_MEDICAL"
            PHI_VIOLATIONS+=("HARDCODED_MEDICAL")
          fi
          
          # 3. ì•”í˜¸í™”ë˜ì§€ ì•Šì€ ë¯¼ê°í•œ í•„ë“œ ê²€ì‚¬  
          echo "ğŸ” ì•”í˜¸í™” ëˆ„ë½ ê²€ì‚¬..."
          UNENCRYPTED_SENSITIVE=$(grep -r -n --include="*.py" -A 3 -B 3 "medical_conditions.*Text\|allergies.*Text\|diagnosis.*Text" app/ | grep -v -E "(encrypt|hash)" || true)
          if [ -n "$UNENCRYPTED_SENSITIVE" ]; then
            echo "âš ï¸ ì•”í˜¸í™”ë˜ì§€ ì•Šì€ ë¯¼ê°í•œ í•„ë“œ:"
            echo "$UNENCRYPTED_SENSITIVE"
            PHI_VIOLATIONS+=("UNENCRYPTED_SENSITIVE")
          fi
          
          # 4. SQL ì¸ì ì…˜ ìœ„í—˜ íŒ¨í„´
          echo "ğŸ” SQL ì¸ì ì…˜ ìœ„í—˜ ê²€ì‚¬..."
          SQL_INJECTION_RISK=$(grep -r -n --include="*.py" -E "db\.session\.execute\s*\(.*f[\"']|query\s*\(.*f[\"']|raw\s*\(" app/ || true)
          if [ -n "$SQL_INJECTION_RISK" ]; then
            echo "âš ï¸ SQL ì¸ì ì…˜ ìœ„í—˜ íŒ¨í„´:"
            echo "$SQL_INJECTION_RISK"
            PHI_VIOLATIONS+=("SQL_INJECTION_RISK")
          fi
          
          # 5. CSRF ë³´í˜¸ ëˆ„ë½ ê²€ì‚¬
          echo "ğŸ” CSRF ë³´í˜¸ ê²€ì‚¬..."
          CSRF_MISSING=$(grep -r -n --include="*.py" -E "@app\.route.*methods.*POST" app/routes/ | while read -r line; do
            file=$(echo "$line" | cut -d: -f1)
            lineno=$(echo "$line" | cut -d: -f2)
            if ! grep -A 10 -B 5 "$lineno" "$file" | grep -q "csrf"; then
              echo "$line"
            fi
          done || true)
          if [ -n "$CSRF_MISSING" ]; then
            echo "âš ï¸ CSRF ë³´í˜¸ ëˆ„ë½ ê°€ëŠ¥ì„±:"
            echo "$CSRF_MISSING"
            PHI_VIOLATIONS+=("CSRF_MISSING")
          fi
          
          # ê²°ê³¼ ìš”ì•½
          VIOLATION_COUNT=${#PHI_VIOLATIONS[@]}
          echo "phi_violation_count=$VIOLATION_COUNT" >> $GITHUB_OUTPUT
          echo "phi_violations=${PHI_VIOLATIONS[*]}" >> $GITHUB_OUTPUT
          
          if [ $VIOLATION_COUNT -eq 0 ]; then
            echo "âœ… PHI ë³´í˜¸ ê²€ì‚¬ í†µê³¼!"
          else
            echo "âŒ PHI ë³´í˜¸ ìœ„ë°˜ ì‚¬í•­ $VIOLATION_COUNT ê°œ ë°œê²¬"
          fi

  # ğŸ”’ ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬
  dependency-security-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          cd app/
          pip install --upgrade pip
          pip install safety bandit semgrep
          pip install -r requirements.txt

      - name: ğŸ” Python ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ (Safety)
        run: |
          echo "ğŸ” Python íŒ¨í‚¤ì§€ ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬..."
          cd app/
          safety check --json --output safety-report.json || true
          if [ -f safety-report.json ]; then
            echo "ğŸ“‹ Safety ê²€ì‚¬ ê²°ê³¼:"
            cat safety-report.json | python -m json.tool
          fi

      - name: ğŸ” ì½”ë“œ ë³´ì•ˆ ë¶„ì„ (Bandit)
        run: |
          echo "ğŸ” Python ì½”ë“œ ë³´ì•ˆ ë¶„ì„..."
          cd app/
          bandit -r . -f json -o bandit-report.json || true
          if [ -f bandit-report.json ]; then
            echo "ğŸ“‹ Bandit ê²€ì‚¬ ê²°ê³¼:"
            cat bandit-report.json | python -m json.tool
          fi

      - name: ğŸ” ê³ ê¸‰ ë³´ì•ˆ ë¶„ì„ (Semgrep)
        run: |
          echo "ğŸ” ê³ ê¸‰ ë³´ì•ˆ íŒ¨í„´ ë¶„ì„..."
          cd app/
          semgrep --config=auto --json --output=semgrep-report.json . || true
          if [ -f semgrep-report.json ]; then
            echo "ğŸ“‹ Semgrep ê²€ì‚¬ ê²°ê³¼ ìš”ì•½:"
            cat semgrep-report.json | python -c "
            import json, sys
            data = json.load(sys.stdin)
            results = data.get('results', [])
            print(f'ì´ {len(results)}ê°œ ì´ìŠˆ ë°œê²¬')
            for result in results[:5]:  # ìƒìœ„ 5ê°œë§Œ ì¶œë ¥
                print(f'- {result.get(\"check_id\")}: {result.get(\"message\")}')
            "
          fi

      - name: ğŸ“Š ë³´ì•ˆ ê²€ì‚¬ ê²°ê³¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-scan-reports
          path: |
            app/safety-report.json
            app/bandit-report.json  
            app/semgrep-report.json
          retention-days: 30

  # ğŸ” ì‹œí¬ë¦¿ ìŠ¤ìº”
  secrets-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” Git íˆìŠ¤í† ë¦¬ ì‹œí¬ë¦¿ ìŠ¤ìº”
        run: |
          echo "ğŸ” Git íˆìŠ¤í† ë¦¬ì—ì„œ ì‹œí¬ë¦¿ íŒ¨í„´ ê²€ìƒ‰..."
          
          # ì¼ë°˜ì ì¸ ì‹œí¬ë¦¿ íŒ¨í„´ë“¤
          SECRET_PATTERNS=(
            "password\s*=\s*['\"][^'\"]{8,}['\"]"
            "secret\s*=\s*['\"][^'\"]{8,}['\"]"
            "api[_-]?key\s*=\s*['\"][^'\"]{8,}['\"]"
            "token\s*=\s*['\"][^'\"]{8,}['\"]"
            "mysql.*://.*:.*@"
            "redis.*://.*:.*@"
            "['\"][0-9a-fA-F]{32,}['\"]"
            "sk-[a-zA-Z0-9]{48,}"
          )
          
          SECRETS_FOUND=false
          
          for pattern in "${SECRET_PATTERNS[@]}"; do
            echo "ğŸ” íŒ¨í„´ ê²€ì‚¬: $pattern"
            MATCHES=$(git log --all -p -S "$pattern" --regexp-ignore-case | head -20 || true)
            if [ -n "$MATCHES" ]; then
              echo "âš ï¸ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‹œí¬ë¦¿ íŒ¨í„´ ë°œê²¬!"
              echo "$MATCHES"
              SECRETS_FOUND=true
            fi
          done
          
          # í˜„ì¬ íŒŒì¼ì—ì„œ ì‹œí¬ë¦¿ ê²€ì‚¬
          echo "ğŸ” í˜„ì¬ íŒŒì¼ë“¤ì—ì„œ ì‹œí¬ë¦¿ ê²€ì‚¬..."
          grep -r -E -n "(password|secret|key|token)\s*=\s*['\"][^'\"]{8,}['\"]" . --include="*.py" --include="*.yml" --include="*.yaml" --exclude-dir=.git || true
          
          if [ "$SECRETS_FOUND" = "false" ]; then
            echo "âœ… ì‹œí¬ë¦¿ ìŠ¤ìº” í†µê³¼!"
          else
            echo "âš ï¸ ì ì¬ì  ì‹œí¬ë¦¿ ë…¸ì¶œ ìœ„í—˜ ë°œê²¬"
          fi

  # ğŸ“‹ ì¢…í•© ë³´ì•ˆ ë¦¬í¬íŠ¸ ìƒì„±
  security-report:
    needs: [phi-protection-audit, dependency-security-scan, secrets-scan]
    if: always()
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“Š SafeWork ë³´ì•ˆ ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±
        run: |
          echo "ğŸ“Š SafeWork ë³´ì•ˆ ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±..."
          echo "â° ìŠ¤ìº” ì™„ë£Œ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S KST')"
          
          # PHI ë³´í˜¸ ê²€ì‚¬ ê²°ê³¼
          echo "ğŸ¥ PHI ë³´í˜¸ ê²€ì‚¬:"
          if [ "${{ needs.phi-protection-audit.result }}" = "success" ]; then
            PHI_VIOLATIONS="${{ needs.phi-protection-audit.outputs.phi_violation_count }}"
            if [ "$PHI_VIOLATIONS" = "0" ]; then
              echo "  âœ… PHI ë³´í˜¸ íŒ¨í„´ ëª¨ë“  ê²€ì‚¬ í†µê³¼"
            else
              echo "  âš ï¸ PHI ë³´í˜¸ ìœ„ë°˜ $PHI_VIOLATIONS ê±´ ë°œê²¬"
              echo "  ğŸ“‹ ìœ„ë°˜ ìœ í˜•: ${{ needs.phi-protection-audit.outputs.phi_violations }}"
            fi
          else
            echo "  âŒ PHI ë³´í˜¸ ê²€ì‚¬ ì‹¤íŒ¨"
          fi
          
          # ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬ ê²°ê³¼
          echo "ğŸ“¦ ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬:"
          if [ "${{ needs.dependency-security-scan.result }}" = "success" ]; then
            echo "  âœ… ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œ"
          else
            echo "  âš ï¸ ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬ì—ì„œ ë¬¸ì œ ë°œê²¬"
          fi
          
          # ì‹œí¬ë¦¿ ìŠ¤ìº” ê²°ê³¼
          echo "ğŸ” ì‹œí¬ë¦¿ ìŠ¤ìº”:"
          if [ "${{ needs.secrets-scan.result }}" = "success" ]; then
            echo "  âœ… ì‹œí¬ë¦¿ ìŠ¤ìº” í†µê³¼"
          else
            echo "  âš ï¸ ì ì¬ì  ì‹œí¬ë¦¿ ë…¸ì¶œ ìœ„í—˜"
          fi
          
          # ì „ì²´ ë³´ì•ˆ ë“±ê¸‰ ê³„ì‚°
          SECURITY_SCORE=100
          
          if [ "${{ needs.phi-protection-audit.result }}" != "success" ]; then
            SECURITY_SCORE=$((SECURITY_SCORE - 30))
          elif [ "${{ needs.phi-protection-audit.outputs.phi_violation_count }}" != "0" ]; then
            SECURITY_SCORE=$((SECURITY_SCORE - 15))
          fi
          
          if [ "${{ needs.dependency-security-scan.result }}" != "success" ]; then
            SECURITY_SCORE=$((SECURITY_SCORE - 25))
          fi
          
          if [ "${{ needs.secrets-scan.result }}" != "success" ]; then
            SECURITY_SCORE=$((SECURITY_SCORE - 20))
          fi
          
          echo "ğŸ¯ ì „ì²´ ë³´ì•ˆ ì ìˆ˜: $SECURITY_SCORE/100"
          
          if [ $SECURITY_SCORE -ge 90 ]; then
            echo "ğŸŸ¢ ë³´ì•ˆ ë“±ê¸‰: ìš°ìˆ˜ (A)"
          elif [ $SECURITY_SCORE -ge 80 ]; then
            echo "ğŸŸ¡ ë³´ì•ˆ ë“±ê¸‰: ì–‘í˜¸ (B)"
          elif [ $SECURITY_SCORE -ge 70 ]; then
            echo "ğŸŸ  ë³´ì•ˆ ë“±ê¸‰: ë³´í†µ (C)"
          else
            echo "ğŸ”´ ë³´ì•ˆ ë“±ê¸‰: ìœ„í—˜ (D) - ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”!"
          fi
          
          # ê¸´ê¸‰ ì•Œë¦¼ì´ í•„ìš”í•œ ê²½ìš° ì´ìŠˆ ìƒì„± íŠ¸ë¦¬ê±°
          if [ $SECURITY_SCORE -lt 70 ]; then
            echo "ğŸš¨ ì‹¬ê°í•œ ë³´ì•ˆ ìœ„í—˜ ê°ì§€ - ìë™ ì´ìŠˆ ìƒì„± í•„ìš”"
            echo "CRITICAL_SECURITY_ALERT=true" >> $GITHUB_ENV
          fi

      - name: ğŸš¨ ê¸´ê¸‰ ë³´ì•ˆ ì•Œë¦¼ ì´ìŠˆ ìƒì„±
        if: env.CRITICAL_SECURITY_ALERT == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const securityIssue = {
              title: 'ğŸš¨ [CRITICAL] SafeWork ë³´ì•ˆ ìœ„í—˜ ê°ì§€ - ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”',
              body: `
            # ğŸš¨ ì¤‘ìš”í•œ ë³´ì•ˆ ìœ„í—˜ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤
            
            **â° ê°ì§€ ì‹œê°„:** ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})}
            **ğŸ” ê²€ì‚¬ ìœ í˜•:** ìë™ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§
            **ğŸ“Š ë³´ì•ˆ ì ìˆ˜:** 70ì  ë¯¸ë§Œ (ìœ„í—˜)
            
            ## ğŸ“‹ ê°ì§€ëœ ë¬¸ì œ
            
            ### ğŸ¥ PHI ë³´í˜¸ ê²€ì‚¬
            - PHI ìœ„ë°˜ ê±´ìˆ˜: ${{ needs.phi-protection-audit.outputs.phi_violation_count }}ê±´
            - ìœ„ë°˜ ìœ í˜•: ${{ needs.phi-protection-audit.outputs.phi_violations }}
            
            ### ğŸ“¦ ì˜ì¡´ì„± ë³´ì•ˆ
            - ìƒíƒœ: ${{ needs.dependency-security-scan.result }}
            
            ### ğŸ” ì‹œí¬ë¦¿ ë³´ì•ˆ  
            - ìƒíƒœ: ${{ needs.secrets-scan.result }}
            
            ## ğŸ¯ ì¦‰ì‹œ í•„ìš”í•œ ì¡°ì¹˜
            
            1. **PHI ë³´í˜¸ ê°•í™”**
               - [ ] ë¡œê·¸ì—ì„œ ê°œì¸ê±´ê°•ì •ë³´ ì œê±°
               - [ ] ë¯¼ê°í•œ ë°ì´í„° ì•”í˜¸í™” í™•ì¸
               - [ ] SQL ì¸ì ì…˜ ë°©ì§€ íŒ¨í„´ ì ìš©
            
            2. **ì˜ì¡´ì„± ì—…ë°ì´íŠ¸** 
               - [ ] ì·¨ì•½í•œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
               - [ ] ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
            
            3. **ì‹œí¬ë¦¿ ê´€ë¦¬**
               - [ ] í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ ì œê±°
               - [ ] í™˜ê²½ë³€ìˆ˜ë¡œ ì´ì „
               - [ ] Git íˆìŠ¤í† ë¦¬ ì •ë¦¬
            
            ## ğŸ“ ê¸´ê¸‰ ì—°ë½ì²˜
            
            - **ì¦‰ì‹œ ì²˜ë¦¬**: @claude ë©˜ì…˜ìœ¼ë¡œ AI ì§€ì› ìš”ì²­
            - **ê¸°ìˆ  ì§€ì›**: SafeWork ê°œë°œíŒ€
            - **ë³´ì•ˆ ë‹´ë‹¹**: ì •ë³´ë³´ì•ˆíŒ€
            
            ---
            ğŸ¤– *SafeWork ìë™ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ*`,
              labels: ['ğŸš¨ ê¸´ê¸‰', 'ğŸ›¡ï¸ ë³´ì•ˆ/ê°œì¸ì •ë³´', 'P0-CRITICAL']
            };
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ...securityIssue
            });
            
            console.log("ğŸš¨ ê¸´ê¸‰ ë³´ì•ˆ ì•Œë¦¼ ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
            
            // Claude AI ìë™ í˜¸ì¶œ
            const issueNumber = (await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              sort: 'created',
              per_page: 1
            })).data[0].number;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: '@claude ì´ ì¤‘ìš”í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì¦‰ì‹œ ë¶„ì„í•˜ê³  êµ¬ì²´ì ì¸ í•´ê²° ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”. ìš°ì„ ìˆœìœ„: P0-CRITICAL'
            });

  # Slack ë³´ì•ˆ ì•Œë¦¼ Job ì¶”ê°€
  security-notification:
    runs-on: ubuntu-latest
    needs: [dependency-check, code-security-scan, phi-compliance-check, generate-security-report]
    if: always()
    steps:
      - name: ğŸ”” SafeWork ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ Slack ì•Œë¦¼
        run: |
          # ë³´ì•ˆ ìƒíƒœ ê²°ì •
          if [ "${{ needs.phi-compliance-check.result }}" = "success" ] && [ "${{ needs.code-security-scan.result }}" = "success" ]; then
            STATUS="PASSED"
            COLOR="good"
            EMOJI="ğŸ›¡ï¸"
          else
            STATUS="SECURITY ISSUES DETECTED"
            COLOR="danger" 
            EMOJI="ğŸš¨"
          fi
          
          # Slack ë³´ì•ˆ ì•Œë¦¼ ì „ì†¡
          curl -X POST \
            -H "Authorization: Bearer xoxb-9456976950066-9491938773873-UE79hj1fLat2dyqeIptwGLbj" \
            -H "Content-type: application/json" \
            --data "{
              \"channel\": \"#safework-alerts\",
              \"text\": \"$EMOJI SafeWork ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ $STATUS\",
              \"attachments\": [{
                \"color\": \"$COLOR\",
                \"title\": \"SafeWork Security Monitoring\",
                \"fields\": [
                  {\"title\": \"Status\", \"value\": \"$STATUS\", \"short\": true},
                  {\"title\": \"PHI Compliance\", \"value\": \"${{ needs.phi-compliance-check.result }}\", \"short\": true},
                  {\"title\": \"Code Security\", \"value\": \"${{ needs.code-security-scan.result }}\", \"short\": true},
                  {\"title\": \"Dependencies\", \"value\": \"${{ needs.dependency-check.result }}\", \"short\": true}
                ],
                \"footer\": \"SafeWork Security\",
                \"ts\": $(date +%s)
              }]
            }" \
            https://slack.com/api/chat.postMessage