{% extends "base.html" %}

{% block title %}조사표 목록 - {{ app_name }}{% endblock %}

{% block content %}
<h2 class="mb-4">
    <i class="bi bi-list-ul"></i> 조사표 목록
</h2>

<div class="section-card mb-3">
    <form method="GET" class="row g-3">
        <div class="col-md-4">
            <input type="text" name="search" class="form-control" placeholder="이름, 사번, 부서 검색" value="{{ request.args.get('search', '') }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">검색</button>
        </div>
        <div class="col-md-2">
            <a href="{{ url_for('admin.export_excel') }}?{{ request.query_string.decode() }}" class="btn btn-success w-100">
                <i class="bi bi-file-excel"></i> Excel
            </a>
        </div>
    </form>
</div>

<div class="section-card">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>제출일시</th>
                <th>이름</th>
                <th>부서/직위</th>
                <th>나이/성별</th>
                <th>근무정보</th>
                <th>증상여부</th>
                <th>상태</th>
            </tr>
        </thead>
        <tbody>
            {% for survey in surveys.items %}
            <tr>
                <td>
                    <strong>{{ survey.created_at.strftime('%Y-%m-%d %H:%M') }}</strong><br>
                    <small class="text-muted">{{ survey.form_type }}양식</small>
                </td>
                <td>
                    <a href="{{ url_for('admin.survey_detail', id=survey.id) }}" class="text-decoration-none">
                        <strong>{{ survey.name }}</strong>
                    </a><br>
                    <small class="text-muted">{{ survey.employee_number or '사번없음' }}</small>
                </td>
                <td>
                    {{ survey.department or '-' }}<br>
                    <small class="text-muted">{{ survey.position or '-' }}</small>
                </td>
                <td>
                    {{ survey.age }}세<br>
                    <small class="text-muted">{{ survey.gender or '-' }}</small>
                </td>
                <td>
                    <small>재직 {{ survey.years_of_service or 0 }}년<br>
                    근무 {{ survey.work_years or 0 }}년 {{ survey.work_months or 0 }}개월</small>
                </td>
                <td>
                    <span class="badge bg-{% if survey.has_symptoms %}warning{% else %}success{% endif %}">
                        {% if survey.has_symptoms %}증상 있음{% else %}증상 없음{% endif %}
                    </span>
                </td>
                <td>
                    <span class="badge bg-primary">{{ survey.status }}</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- 페이지네이션 -->
    {% if surveys.has_prev or surveys.has_next %}
    <nav>
        <ul class="pagination justify-content-center">
            <li class="page-item {% if not surveys.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('admin.survey', page=surveys.prev_num) }}">이전</a>
            </li>
            <li class="page-item active">
                <span class="page-link">{{ surveys.page }} / {{ surveys.pages }}</span>
            </li>
            <li class="page-item {% if not surveys.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('admin.survey', page=surveys.next_num) }}">다음</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}