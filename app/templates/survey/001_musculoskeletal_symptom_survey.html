{% extends "base.html" %}

{% block title %}근골격계 증상조사표 - {{ app_name }}{% endblock %}

{% block extra_css %}
<style>
    .survey-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 15px;
        min-width: 0;
        overflow-x: hidden;
    }
    
    .section-card {
        background: #ffffff;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb;
    }
    
    .section-title {
        color: #1f2937;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3b82f6;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .form-group {
        flex: 1;
        min-width: 250px;
    }
    
    .form-group.half {
        flex: 0 0 calc(50% - 7.5px);
        min-width: 150px;
    }
    
    .form-group.third {
        flex: 0 0 calc(33.333% - 10px);
        min-width: 120px;
    }
    
    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 5px;
        font-size: 0.9rem;
    }
    
    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        background: #ffffff;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .checkbox-group,
    .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 8px;
    }
    
    .checkbox-item,
    .radio-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .checkbox-item input,
    .radio-item input {
        margin: 0;
    }
    
    .checkbox-item label,
    .radio-item label {
        margin: 0;
        font-size: 0.9rem;
        color: #374151;
        cursor: pointer;
    }
    
    .symptoms-grid {
        display: grid;
        gap: 15px;
    }
    
    .symptom-card {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 15px;
        min-width: 0;
        overflow-x: auto;
    }
    
    .symptom-title {
        font-weight: 600;
        color: #1e40af;
        margin-bottom: 12px;
        font-size: 1rem;
    }
    
    .symptom-questions {
        display: grid;
        gap: 10px;
    }
    
    .question-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .question-row:last-child {
        border-bottom: none;
    }
    
    .question-text {
        font-size: 0.85rem;
        color: #374151;
        flex: 1;
        line-height: 1.4;
        word-break: keep-all;
        overflow-wrap: break-word;
    }
    
    .answer-options {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }
    
    .option-btn {
        padding: 6px 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #ffffff;
        font-size: 0.75rem;
        cursor: pointer;
        min-width: 50px;
        text-align: center;
        word-break: keep-all;
        white-space: normal;
        line-height: 1.2;
        flex: 0 0 auto;
        transition: all 0.2s ease;
    }
    
    .option-btn.selected {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
    }
    
    .question-row.disabled {
        opacity: 0.6;
        pointer-events: none;
    }
    
    .question-row.disabled .question-text {
        color: #9ca3af;
    }
    
    /* PDF 테이블 스타일 */
    .symptoms-table {
        margin-bottom: 0;
        font-size: 0.85rem;
    }
    
    .symptoms-table th {
        background-color: #e3f2fd !important;
        text-align: center;
        vertical-align: middle;
        font-weight: 600;
        padding: 12px 8px;
        border: 1px solid #90caf9;
    }
    
    .question-cell {
        background-color: #f8f9fa;
        font-weight: 500;
        vertical-align: middle;
        padding: 15px 12px;
        border: 1px solid #dee2e6;
        width: 300px;
        min-width: 300px;
    }
    
    .answer-cell {
        text-align: center;
        vertical-align: middle;
        padding: 10px 8px;
        border: 1px solid #dee2e6;
        min-width: 120px;
    }
    
    .radio-group-vertical,
    .checkbox-group-vertical {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: flex-start;
    }
    
    .radio-group-vertical label,
    .checkbox-group-vertical label {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        margin-bottom: 0;
        cursor: pointer;
        white-space: nowrap;
    }
    
    .radio-group-vertical input,
    .checkbox-group-vertical input[type="checkbox"],
    .checkbox-group-vertical input[type="radio"] {
        margin: 0;
        flex-shrink: 0;
    }
    
    .checkbox-group-vertical input[type="text"] {
        margin-top: 4px;
        font-size: 0.75rem;
        padding: 2px 4px;
    }
    
    .severity-guide {
        margin-top: 8px;
        padding: 8px;
        background-color: #f0f9ff;
        border-radius: 4px;
        border-left: 3px solid #0ea5e9;
    }
    
    .severity-guide small {
        line-height: 1.4;
    }
    
    .required {
        color: #ef4444;
    }
    
    .submit-section {
        text-align: center;
        margin-top: 30px;
    }
    
    .submit-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .submit-btn:hover {
        background: #2563eb;
    }
    
    /* 모바일 반응형 */
    @media (max-width: 768px) {
        .option-btn {
            padding: 5px 6px;
            font-size: 0.7rem;
            min-width: 45px;
        }
        .survey-container {
            padding: 10px;
        }
        
        .section-card {
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .form-row {
            flex-direction: column;
            gap: 10px;
        }
        
        .form-group,
        .form-group.half,
        .form-group.third {
            flex: 1;
            min-width: unset;
        }
        
        .checkbox-group,
        .radio-group {
            flex-direction: column;
            gap: 10px;
        }
        
        .question-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        
        .answer-options {
            align-self: stretch;
            justify-content: flex-start;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            flex: 1;
            min-width: 0;
            font-size: 0.75rem;
            padding: 6px 8px;
            white-space: normal;
            word-break: keep-all;
            line-height: 1.2;
            height: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="survey-container">
    <form method="POST" action="{{ url_for('survey.musculoskeletal_symptom_survey') }}" id="surveyForm">
        
        <div class="text-center mb-4">
            <h2 style="color: #1f2937; margin-bottom: 5px;">
                <i class="bi bi-clipboard2-pulse"></i> 근골격계 증상조사표
            </h2>
            <p style="color: #6b7280; font-size: 0.9rem;">PDF 001 - 정확한 데이터 수집</p>
        </div>

        <!-- I. 기본정보 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-person"></i> I. 기본정보
            </h4>
            
            <div class="form-row">
                <div class="form-group third">
                    <label class="form-label">사번</label>
                    <input type="text" name="employee_number" class="form-control" placeholder="EMP001">
                </div>
                <div class="form-group third">
                    <label class="form-label required">성명</label>
                    <input type="text" name="name" class="form-control" placeholder="홍길동" required>
                </div>
                <div class="form-group third">
                    <label class="form-label required">연령</label>
                    <input type="number" name="age" class="form-control" placeholder="35" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label required">성별</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="gender_male" name="gender" value="남" required>
                            <label for="gender_male">남</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="gender_female" name="gender" value="여" required>
                            <label for="gender_female">여</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label class="form-label required">작업부서</label>
                    <input type="text" name="department" class="form-control" placeholder="생산1팀" required>
                </div>
                <div class="form-group half">
                    <label class="form-label">직위</label>
                    <input type="text" name="position" class="form-control" placeholder="사원">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label class="form-label">현 직장경력 (년)</label>
                    <input type="number" name="work_years" class="form-control" placeholder="5">
                </div>
                <div class="form-group half">
                    <label class="form-label">현 직장경력 (개월)</label>
                    <input type="number" name="work_months" class="form-control" placeholder="3">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">라인</label>
                    <input type="text" name="line" class="form-control" placeholder="A라인">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">수행작업</label>
                    <input type="text" name="work_name" class="form-control" placeholder="조립 작업">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">결혼여부</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="marriage_single" name="marriage_status" value="미혼">
                            <label for="marriage_single">미혼</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="marriage_married" name="marriage_status" value="기혼">
                            <label for="marriage_married">기혼</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 현재하고 있는 작업 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-briefcase"></i> 현재하고 있는 작업
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">작업내용 (구체적으로)</label>
                    <textarea name="current_work_details" class="form-control" rows="3" placeholder="예: 컨베이어 벨트에서 제품 조립 작업"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group third">
                    <label class="form-label">작업기간 (년)</label>
                    <input type="number" name="current_work_years" class="form-control" placeholder="2">
                </div>
                <div class="form-group third">
                    <label class="form-label">작업기간 (개월)</label>
                    <input type="number" name="current_work_months" class="form-control" placeholder="6">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group third">
                    <label class="form-label">1일 근무시간</label>
                    <input type="number" name="work_hours_per_day" class="form-control" placeholder="8">
                </div>
                <div class="form-group third">
                    <label class="form-label">휴식시간(분)</label>
                    <input type="number" name="break_time_minutes" class="form-control" placeholder="60">
                </div>
                <div class="form-group third">
                    <label class="form-label">휴식횟수</label>
                    <input type="number" name="break_frequency" class="form-control" placeholder="2">
                </div>
            </div>
        </div>

        <!-- 현작업을 하기 전에 했던 작업 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-clock-history"></i> 현작업을 하기 전에 했던 작업
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">작업내용</label>
                    <textarea name="previous_work_details" class="form-control" rows="2" placeholder="예: 포장 작업"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label class="form-label">작업기간 (년)</label>
                    <input type="number" name="previous_work_years" class="form-control" placeholder="1">
                </div>
                <div class="form-group half">
                    <label class="form-label">작업기간 (개월)</label>
                    <input type="number" name="previous_work_months" class="form-control" placeholder="6">
                </div>
            </div>
        </div>

        <!-- 1. 여가 및 취미활동 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-palette"></i> 1. 여가 및 취미활동
            </h4>
            <p class="mb-3"><small>규칙적인 (한번에 30분 이상, 1주일에 2-3회, 적어도 1회 이상) 여가 및 취미활동을 하고 계시는 곳에 표시(✓)하여 주십시오.</small></p>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_computer" name="hobby_computer">
                    <label for="hobby_computer">컴퓨터 관련활동</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_instrument" name="hobby_instrument">
                    <label for="hobby_instrument">악기연주 (피아노, 바이올린 등)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_knitting" name="hobby_knitting">
                    <label for="hobby_knitting">뜨개질/자수/붓글씨</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_racket_sports" name="hobby_racket_sports">
                    <label for="hobby_racket_sports">테니스/배드민턴/스쿼시</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_ball_sports" name="hobby_ball_sports">
                    <label for="hobby_ball_sports">축구/족구/농구/스키</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hobby_none" name="hobby_none">
                    <label for="hobby_none">해당사항 없음</label>
                </div>
            </div>
        </div>

        <!-- 2. 가사노동시간 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-house"></i> 2. 가사노동시간
            </h4>
            <p class="mb-3"><small>귀하의 하루 평균 가사노동시간 (밥하기, 빨래하기, 청소하기, 2살 미만의 아이 돌보기 등)은 얼마나 됩니까?</small></p>
            
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="housework_none" name="housework_hours" value="거의하지않는다">
                    <label for="housework_none">거의 하지 않는다</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="housework_1h" name="housework_hours" value="1시간미만">
                    <label for="housework_1h">1시간 미만</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="housework_2h" name="housework_hours" value="1-2시간">
                    <label for="housework_2h">1-2시간 미만</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="housework_3h" name="housework_hours" value="2-3시간">
                    <label for="housework_3h">2-3시간 미만</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="housework_over3h" name="housework_hours" value="3시간이상">
                    <label for="housework_over3h">3시간 이상</label>
                </div>
            </div>
        </div>

        <!-- 3. 진단받은 질병 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-heart-pulse"></i> 3. 진단받은 질병
            </h4>
            <p class="mb-3"><small>귀하는 의사로부터 다음과 같은 질병에 대해 진단을 받은 적이 있습니까? (해당 질병에 체크)</small></p>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_rheumatoid" name="disease_rheumatoid">
                    <label for="disease_rheumatoid">류머티스 관절염</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_diabetes" name="disease_diabetes">
                    <label for="disease_diabetes">당뇨병</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_lupus" name="disease_lupus">
                    <label for="disease_lupus">루프스병</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_gout" name="disease_gout">
                    <label for="disease_gout">통풍</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_alcoholism" name="disease_alcoholism">
                    <label for="disease_alcoholism">알코올중독</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="disease_none" name="disease_none">
                    <label for="disease_none">아니오</label>
                </div>
            </div>
            
            <div id="disease_status_section" style="display: none; margin-top: 15px;">
                <label class="form-label">현재상태는?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="disease_cured" name="disease_status" value="완치">
                        <label for="disease_cured">완치</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="disease_treating" name="disease_status" value="치료중">
                        <label for="disease_treating">치료나 관찰 중</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. 과거 사고 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-bandaid"></i> 4. 과거 사고
            </h4>
            <p class="mb-3"><small>과거에 운동 중 혹은 사고로 (교통사고, 넘어짐, 추락 등) 인해 손/손가락/손목, 팔/팔꿈치, 어깨, 목, 허리, 다리/발 부위를 다친 적이 있습니까?</small></p>
            
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="accident_no" name="past_accident" value="아니오">
                    <label for="accident_no">아니오</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="accident_yes" name="past_accident" value="예">
                    <label for="accident_yes">예</label>
                </div>
            </div>
            
            <div id="accident_parts_section" style="display: none; margin-top: 15px;">
                <label class="form-label">상해 부위는? (복수 선택 가능)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_hand" name="accident_hand">
                        <label for="accident_hand">손/손가락/손목</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_arm" name="accident_arm">
                        <label for="accident_arm">팔/팔꿈치</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_shoulder" name="accident_shoulder">
                        <label for="accident_shoulder">어깨</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_neck" name="accident_neck">
                        <label for="accident_neck">목</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_waist" name="accident_waist">
                        <label for="accident_waist">허리</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="accident_leg" name="accident_leg">
                        <label for="accident_leg">다리/발</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. 육체적 부담 정도 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-speedometer2"></i> 5. 육체적 부담 정도
            </h4>
            <p class="mb-3"><small>현재 하고 계시는 일의 육체적 부담 정도는 어느 정도라고 생각합니까?</small></p>
            
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="burden_none" name="physical_burden" value="전혀힘들지않음">
                    <label for="burden_none">전혀 힘들지 않음</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="burden_tolerable" name="physical_burden" value="견딜만함">
                    <label for="burden_tolerable">견딜만 함</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="burden_somewhat" name="physical_burden" value="약간힘듦">
                    <label for="burden_somewhat">약간 힘듦</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="burden_very" name="physical_burden" value="매우힘듦">
                    <label for="burden_very">매우 힘듦</label>
                </div>
            </div>
        </div>

        <!-- II. 근골격계 증상 조사 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-body-text"></i> II. 근골격계 증상조사
            </h4>
            <p class="mb-3"><strong>지난 1년 동안 손/손가락/손목, 팔/팔꿈치, 어깨, 허리, 다리/발 중 어느 한 부위에서라도 귀하의 작업과 관련하여 통증이나 불편함(통증, 쑤시는 느낌, 뻣뻣함, 화끈거리는 느낌, 무감각 혹은 찌릿찌릿함 등)을 느끼신 적이 있습니까?</strong></p>
            
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="symptoms_no" name="has_symptoms" value="아니오" required>
                    <label for="symptoms_no">아니오 (수고하셨습니다. 설문을 다 마치셨습니다.)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="symptoms_yes" name="has_symptoms" value="예" required>
                    <label for="symptoms_yes">예 ("예"라고 답하신 분은 아래 표의 통증부위에 체크(✓)하고, 해당 통증부위의 세로줄로 내려가며 해당사항에 체크(✓)해 주십시오)</label>
                </div>
            </div>
            
            <!-- 증상 상세 정보는 "예" 선택 시 JavaScript로 동적 표시 -->
            <div id="symptom-details" style="display: none; margin-top: 20px;">
                <div class="alert alert-info">
                    <strong>📋 통증부위별 상세 조사</strong><br>
                    아래 표의 통증부위에 해당사항에 체크(✓)하고, 해당 통증부위의 세로줄로 내려가며 해당사항에 체크(✓)해 주십시오.
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered symptoms-table">
                        <thead class="table-primary">
                            <tr>
                                <th rowspan="2">질문</th>
                                <th>목</th>
                                <th>어깨</th>
                                <th>팔/팔꿈치</th>
                                <th>손/손목/손가락</th>
                                <th>허리</th>
                                <th>다리/발</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 1. 통증의 구체적 부위 -->
                            <tr>
                                <td class="question-cell"><strong>1. 통증의 구체적 부위는?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_side" value="오른쪽"> 오른쪽</label>
                                        <label><input type="radio" name="{{ part }}_side" value="왼쪽"> 왼쪽</label>
                                        <label><input type="radio" name="{{ part }}_side" value="양쪽모두"> 양쪽 모두</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 2. 한번 아프기 시작하면 통증기간은 얼마동안 지속됩니까? -->
                            <tr>
                                <td class="question-cell"><strong>2. 한번 아프기 시작하면 통증기간은 얼마동안 지속됩니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_duration" value="1일미만"> 1일 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1일-1주일미만"> 1일-1주일 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1주일-1달미만"> 1주일-1달 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1달-6개월미만"> 1달-6개월 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="6개월이상"> 6개월 이상</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 3. 그때의 아픈 정도는 어느 정도입니까? -->
                            <tr>
                                <td class="question-cell">
                                    <strong>3. 그때의 아픈 정도는 어느 정도입니까?</strong>
                                    <div class="severity-guide">
                                        <small>
                                            <strong>보기:</strong><br>
                                            <strong>약한 통증:</strong> 약간 불편한 정도이나 작업에 열중할 때는 못 느낀다<br>
                                            <strong>중간 통증:</strong> 작업 중 통증이 있으나 귀가 후 휴식을 취하면 괜찮다<br>
                                            <strong>심한 통증:</strong> 작업 중 통증이 비교적 심하고 귀가 후에도 통증이 계속된다<br>
                                            <strong>매우 심한 통증:</strong> 통증 때문에 작업은 물론 일상생활을 하기가 어렵다
                                        </small>
                                    </div>
                                </td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_severity" value="약한통증"> 약한 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="중간통증"> 중간 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="심한통증"> 심한 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="매우심한통증"> 매우 심한 통증</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 4. 지난 1년 동안 이러한 증상을 얼마나 자주 경험하셨습니까? -->
                            <tr>
                                <td class="question-cell"><strong>4. 지난 1년 동안 이러한 증상을 얼마나 자주 경험하셨습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_frequency" value="6개월에1번"> 6개월에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="2-3달에1번"> 2-3달에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="1달에1번"> 1달에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="1주일에1번"> 1주일에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="매일"> 매일</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 5. 지난 1주일 동안에도 이러한 증상이 있었습니까? -->
                            <tr>
                                <td class="question-cell"><strong>5. 지난 1주일 동안에도 이러한 증상이 있었습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_last_week" value="아니오"> 아니오</label>
                                        <label><input type="radio" name="{{ part }}_last_week" value="예"> 예</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 6. 지난 1년 동안 이러한 통증으로 인해 어떤 일이 있었습니까? -->
                            <tr>
                                <td class="question-cell"><strong>6. 지난 1년 동안 이러한 통증으로 인해 어떤 일이 있었습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="checkbox-group-vertical">
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="병원한의원치료"> 병원·한의원 치료</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="약국치료"> 약국치료</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="병가산재"> 병가, 산재</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="작업전환"> 작업 전환</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="해당사항없음"> 해당사항 없음</label>
                                        <label><input type="text" name="{{ part }}_treatment_other" placeholder="기타 (구체적으로)" class="form-control form-control-sm"></label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                        </tbody>
                    </table>
                </div>
                            <input type="radio" id="marriage_married" name="marriage_status" value="기혼">
                            <label for="marriage_married">기혼</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 현재 작업 정보 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-briefcase"></i> 현재하고 있는 작업
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">작업내용</label>
                    <textarea name="current_work_details" class="form-control" rows="3" placeholder="현재 수행하고 있는 작업에 대해 상세히 기술해주세요"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label class="form-label">작업기간 (년)</label>
                    <input type="number" name="current_work_years" class="form-control" placeholder="3">
                </div>
                <div class="form-group half">
                    <label class="form-label">작업기간 (개월)</label>
                    <input type="number" name="current_work_months" class="form-control" placeholder="6">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group third">
                    <label class="form-label">1일 근무시간</label>
                    <input type="number" name="work_hours_per_day" class="form-control" placeholder="8">
                </div>
                <div class="form-group third">
                    <label class="form-label">휴식시간 (분)</label>
                    <input type="number" name="break_time_minutes" class="form-control" placeholder="60">
                </div>
                <div class="form-group third">
                    <label class="form-label">휴식횟수</label>
                    <input type="number" name="break_frequency" class="form-control" placeholder="2">
                </div>
            </div>
        </div>

        <!-- 이전 작업 정보 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-clock-history"></i> 현작업 하기 전 작업
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">이전 작업내용</label>
                    <textarea name="previous_work_details" class="form-control" rows="3" placeholder="이전에 수행했던 작업에 대해 기술해주세요"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label class="form-label">이전 작업기간 (년)</label>
                    <input type="number" name="previous_work_years" class="form-control" placeholder="2">
                </div>
                <div class="form-group half">
                    <label class="form-label">이전 작업기간 (개월)</label>
                    <input type="number" name="previous_work_months" class="form-control" placeholder="4">
                </div>
            </div>
        </div>

        <!-- 여가 및 취미활동 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-palette"></i> 1. 여가 및 취미활동
            </h4>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_computer" id="hobby_computer">
                    <label for="hobby_computer">컴퓨터 관련활동</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_instrument" id="hobby_instrument">
                    <label for="hobby_instrument">악기연주(피아노, 바이올린 등)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_knitting" id="hobby_knitting">
                    <label for="hobby_knitting">뜨개질/자수/붓글씨</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_racket_sports" id="hobby_racket_sports">
                    <label for="hobby_racket_sports">테니스/배드민턴/스쿼시</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_ball_sports" id="hobby_ball_sports">
                    <label for="hobby_ball_sports">축구/족구/농구/스키</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="hobby_none" id="hobby_none">
                    <label for="hobby_none">해당사항 없음</label>
                </div>
            </div>
        </div>

        <!-- 가사노동시간 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-house"></i> 2. 가사노동시간
            </h4>
            
            <div class="form-group">
                <label class="form-label">하루 평균 가사노동시간</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="housework_1" name="housework_hours" value="거의안함">
                        <label for="housework_1">거의안함</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="housework_2" name="housework_hours" value="1시간미만">
                        <label for="housework_2">1시간미만</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="housework_3" name="housework_hours" value="1-2시간">
                        <label for="housework_3">1-2시간</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="housework_4" name="housework_hours" value="2-3시간">
                        <label for="housework_4">2-3시간</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="housework_5" name="housework_hours" value="3시간이상">
                        <label for="housework_5">3시간이상</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 진단받은 질병 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-heart-pulse"></i> 3. 진단받은 질병
            </h4>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_rheumatoid" id="disease_rheumatoid">
                    <label for="disease_rheumatoid">류머티스 관절염</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_diabetes" id="disease_diabetes">
                    <label for="disease_diabetes">당뇨병</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_lupus" id="disease_lupus">
                    <label for="disease_lupus">루프스병</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_gout" id="disease_gout">
                    <label for="disease_gout">통풍</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_alcoholism" id="disease_alcoholism">
                    <label for="disease_alcoholism">알코올중독</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="disease_none" id="disease_none">
                    <label for="disease_none">아니오</label>
                </div>
            </div>
            
            <div class="form-row" style="margin-top: 15px;">
                <div class="form-group">
                    <label class="form-label">현재상태</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="disease_status_cured" name="disease_status" value="완치">
                            <label for="disease_status_cured">완치</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="disease_status_treatment" name="disease_status" value="치료나 관찰 중">
                            <label for="disease_status_treatment">치료나 관찰 중</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 과거 사고 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-bandaid"></i> 4. 과거 사고
            </h4>
            
            <div class="form-group">
                <label class="form-label">과거 운동/사고로 다친 적이 있습니까?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="past_accident_yes" name="past_accident" value="예">
                        <label for="past_accident_yes">예</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="past_accident_no" name="past_accident" value="아니오">
                        <label for="past_accident_no">아니오</label>
                    </div>
                </div>
            </div>
            
            <div id="accident_details_section" class="checkbox-group" style="margin-top: 15px; display: none;">
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_hand" id="accident_hand">
                    <label for="accident_hand">손/손가락/손목</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_arm" id="accident_arm">
                    <label for="accident_arm">팔/팔꿈치</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_shoulder" id="accident_shoulder">
                    <label for="accident_shoulder">어깨</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_neck" id="accident_neck">
                    <label for="accident_neck">목</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_waist" id="accident_waist">
                    <label for="accident_waist">허리</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="accident_leg" id="accident_leg">
                    <label for="accident_leg">다리/발</label>
                </div>
            </div>
        </div>

        <!-- 육체적 부담 정도 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-speedometer2"></i> 5. 육체적 부담 정도
            </h4>
            
            <div class="form-group">
                <label class="form-label">현재 일의 육체적 부담 정도</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="physical_1" name="physical_burden" value="전혀힘들지않음">
                        <label for="physical_1">전혀힘들지않음</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="physical_2" name="physical_burden" value="견딜만함">
                        <label for="physical_2">견딜만함</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="physical_3" name="physical_burden" value="약간힘듦">
                        <label for="physical_3">약간힘듦</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="physical_4" name="physical_burden" value="매우힘듦">
                        <label for="physical_4">매우힘듦</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- II. 근골격계 증상 -->
        <div class="section-card">
            <h4 class="section-title">
                <i class="bi bi-heart-pulse"></i> II. 근골격계 증상
            </h4>
            
            <div class="form-group">
                <label class="form-label required">지난 1년 동안 통증이나 불편함을 느끼신 적이 있습니까?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="has_symptoms_yes" name="has_symptoms" value="예" required>
                        <label for="has_symptoms_yes">예</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="has_symptoms_no" name="has_symptoms" value="아니오" required>
                        <label for="has_symptoms_no">아니오</label>
                    </div>
                </div>
            </div>
            
            <!-- 증상 상세 정보는 "예" 선택 시 JavaScript로 동적 표시 -->
            <div id="symptom-details" style="display: none; margin-top: 20px;">
                <div class="alert alert-info">
                    <strong>📋 통증부위별 상세 조사</strong><br>
                    아래 표의 통증부위에 해당사항에 체크(✓)하고, 해당 통증부위의 세로줄로 내려가며 해당사항에 체크(✓)해 주십시오.
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered symptoms-table">
                        <thead class="table-primary">
                            <tr>
                                <th rowspan="2">질문</th>
                                <th>목</th>
                                <th>어깨</th>
                                <th>팔/팔꿈치</th>
                                <th>손/손목/손가락</th>
                                <th>허리</th>
                                <th>다리/발</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 1. 통증의 구체적 부위 -->
                            <tr>
                                <td class="question-cell"><strong>1. 통증의 구체적 부위는?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_side" value="오른쪽"> 오른쪽</label>
                                        <label><input type="radio" name="{{ part }}_side" value="왼쪽"> 왼쪽</label>
                                        <label><input type="radio" name="{{ part }}_side" value="양쪽모두"> 양쪽 모두</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 2. 한번 아프기 시작하면 통증기간은 얼마동안 지속됩니까? -->
                            <tr>
                                <td class="question-cell"><strong>2. 한번 아프기 시작하면 통증기간은 얼마동안 지속됩니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_duration" value="1일미만"> 1일 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1일-1주일미만"> 1일-1주일 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1주일-1달미만"> 1주일-1달 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="1달-6개월미만"> 1달-6개월 미만</label>
                                        <label><input type="radio" name="{{ part }}_duration" value="6개월이상"> 6개월 이상</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 3. 그때의 아픈 정도는 어느 정도입니까? -->
                            <tr>
                                <td class="question-cell">
                                    <strong>3. 그때의 아픈 정도는 어느 정도입니까?</strong>
                                    <div class="severity-guide">
                                        <small>
                                            <strong>보기:</strong><br>
                                            <strong>약한 통증:</strong> 약간 불편한 정도이나 작업에 열중할 때는 못 느낀다<br>
                                            <strong>중간 통증:</strong> 작업 중 통증이 있으나 귀가 후 휴식을 취하면 괜찮다<br>
                                            <strong>심한 통증:</strong> 작업 중 통증이 비교적 심하고 귀가 후에도 통증이 계속된다<br>
                                            <strong>매우 심한 통증:</strong> 통증 때문에 작업은 물론 일상생활을 하기가 어렵다
                                        </small>
                                    </div>
                                </td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_severity" value="약한통증"> 약한 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="중간통증"> 중간 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="심한통증"> 심한 통증</label>
                                        <label><input type="radio" name="{{ part }}_severity" value="매우심한통증"> 매우 심한 통증</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 4. 지난 1년 동안 이러한 증상을 얼마나 자주 경험하셨습니까? -->
                            <tr>
                                <td class="question-cell"><strong>4. 지난 1년 동안 이러한 증상을 얼마나 자주 경험하셨습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_frequency" value="6개월에1번"> 6개월에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="2-3달에1번"> 2-3달에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="1달에1번"> 1달에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="1주일에1번"> 1주일에 1번</label>
                                        <label><input type="radio" name="{{ part }}_frequency" value="매일"> 매일</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 5. 지난 1주일 동안에도 이러한 증상이 있었습니까? -->
                            <tr>
                                <td class="question-cell"><strong>5. 지난 1주일 동안에도 이러한 증상이 있었습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="radio-group-vertical">
                                        <label><input type="radio" name="{{ part }}_last_week" value="아니오"> 아니오</label>
                                        <label><input type="radio" name="{{ part }}_last_week" value="예"> 예</label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            
                            <!-- 6. 지난 1년 동안 이러한 통증으로 인해 어떤 일이 있었습니까? -->
                            <tr>
                                <td class="question-cell"><strong>6. 지난 1년 동안 이러한 통증으로 인해 어떤 일이 있었습니까?</strong></td>
                                {% for part in ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'] %}
                                <td class="answer-cell">
                                    <div class="checkbox-group-vertical">
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="병원한의원치료"> 병원·한의원 치료</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="약국치료"> 약국치료</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="병가산재"> 병가, 산재</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="작업전환"> 작업 전환</label>
                                        <label><input type="checkbox" name="{{ part }}_treatment" value="해당사항없음"> 해당사항 없음</label>
                                        <label><input type="text" name="{{ part }}_treatment_other" placeholder="기타 (구체적으로)" class="form-control form-control-sm"></label>
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 제출 버튼 -->
        <div class="submit-section">
            <button type="submit" class="submit-btn">제출하기</button>
        </div>
    </form>
</div>

<script>
// 증상 유무에 따른 상세 정보 표시/숨김
document.querySelectorAll('input[name="has_symptoms"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const symptomDetails = document.getElementById('symptom-details');
        if (this.value === '예') {
            symptomDetails.style.display = 'block';
        } else {
            symptomDetails.style.display = 'none';
        }
    });
});

// 폼 검증 및 제출 처리
document.getElementById('surveyForm').addEventListener('submit', function(e) {
    const hasSymptoms = document.querySelector('input[name="has_symptoms"]:checked');
    if (!hasSymptoms) {
        e.preventDefault();
        alert('통증 경험 여부를 선택해 주세요.');
        return false;
    }
    
    // "예"를 선택한 경우 최소 하나의 부위는 응답이 있어야 함
    if (hasSymptoms.value === '예') {
        const bodyParts = ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'];
        let hasAnyResponse = false;
        
        bodyParts.forEach(part => {
            const sideInputs = document.querySelectorAll(`input[name="${part}_side"]:checked`);
            if (sideInputs.length > 0) {
                hasAnyResponse = true;
            }
        });
        
        if (!hasAnyResponse) {
            e.preventDefault();
            alert('통증 부위를 하나 이상 선택해 주세요.');
            return false;
        }
        
        // 증상 데이터 수집
        collectSymptomData();
    }
});

// 질병 상태 조건부 표시
const diseaseCheckboxes = document.querySelectorAll('input[name^="disease_"]:not([name="disease_none"])');
const diseaseStatusDiv = document.getElementById('disease_status_section');

function toggleDiseaseStatus() {
    const hasDisease = Array.from(diseaseCheckboxes).some(cb => cb.checked);
    if (diseaseStatusDiv) {
        diseaseStatusDiv.style.display = hasDisease ? 'block' : 'none';
    }
}

diseaseCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', toggleDiseaseStatus);
});

// "아니오" 체크박스 처리
const diseaseNone = document.querySelector('input[name="disease_none"]');
if (diseaseNone) {
    diseaseNone.addEventListener('change', function() {
        if (this.checked) {
            diseaseCheckboxes.forEach(cb => cb.checked = false);
            toggleDiseaseStatus();
        }
    });
    
    diseaseCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (this.checked) {
                diseaseNone.checked = false;
            }
        });
    });
}

// 과거 사고 부위 조건부 표시
const pastAccident = document.querySelectorAll('input[name="past_accident"]');
const accidentDetailsDiv = document.getElementById('accident_details_section');

pastAccident.forEach(radio => {
    radio.addEventListener('change', function() {
        if (accidentDetailsDiv) {
            accidentDetailsDiv.style.display = this.value === '예' ? 'block' : 'none';
        }
    });
});

// 취미활동 "해당사항 없음" 배타적 선택  
const hobbyNone = document.querySelector('input[name="hobby_none"]');
const hobbyCheckboxes = document.querySelectorAll('input[name^="hobby_"]:not([name="hobby_none"])');

if (hobbyNone) {
    hobbyNone.addEventListener('change', function() {
        if (this.checked) {
            hobbyCheckboxes.forEach(cb => cb.checked = false);
        }
    });
    
    hobbyCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (this.checked) {
                hobbyNone.checked = false;
            }
        });
    });
}

// 폼 제출 전 증상 데이터 수집
function collectSymptomData() {
    const hasSymptoms = document.querySelector('input[name="has_symptoms"]:checked');
    if (hasSymptoms && hasSymptoms.value === '예') {
        const bodyParts = ['목', '어깨', '팔/팔꿈치', '손/손목/손가락', '허리', '다리/발'];
        const symptomData = {};
        
        bodyParts.forEach(part => {
            const partKey = part.replace(/[\/]/g, '_');
            const sideInput = document.querySelector(`input[name="${part}_side"]:checked`);
            
            if (sideInput) {
                const durationInput = document.querySelector(`input[name="${part}_duration"]:checked`);
                const severityInput = document.querySelector(`input[name="${part}_severity"]:checked`);
                const frequencyInput = document.querySelector(`input[name="${part}_frequency"]:checked`);
                const lastWeekInput = document.querySelector(`input[name="${part}_last_week"]:checked`);
                
                const treatmentInputs = document.querySelectorAll(`input[name="${part}_treatment"]:checked`);
                const treatmentOther = document.querySelector(`input[name="${part}_treatment_other"]`);
                
                const treatments = Array.from(treatmentInputs).map(input => input.value);
                if (treatmentOther && treatmentOther.value.trim()) {
                    treatments.push(treatmentOther.value.trim());
                }
                
                symptomData[partKey] = {
                    side: sideInput.value,
                    duration: durationInput ? durationInput.value : '',
                    severity: severityInput ? severityInput.value : '',
                    frequency: frequencyInput ? frequencyInput.value : '',
                    last_week: lastWeekInput ? lastWeekInput.value === '예' : false,
                    treatment: treatments
                };
            }
        });
        
        if (Object.keys(symptomData).length > 0) {
            const existingHidden = document.querySelector('input[name="symptoms_json_data"]');
            if (existingHidden) {
                existingHidden.remove();
            }
            
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'symptoms_json_data';
            hiddenInput.value = JSON.stringify(symptomData);
            document.getElementById('surveyForm').appendChild(hiddenInput);
        }
    }
}

// 초기 상태 설정
document.addEventListener('DOMContentLoaded', function() {
    toggleDiseaseStatus();
});
</script>
{% endblock %}