{% extends "base.html" %}
{% block title %}ì¡°ì‚¬í‘œ ìƒì„¸ë³´ê¸°{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-4">
        <a href="{{ url_for('admin.survey') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>
    
    <h2 class="mb-4">
        ì¡°ì‚¬í‘œ ìƒì„¸ ì •ë³´ #{{ survey.id }}
        {% if survey.form_type %}
            {% if '001' in survey.form_type %}
                <span class="badge bg-primary">001 ê·¼ê³¨ê²©ê³„</span>
            {% elif '002' in survey.form_type %}
                <span class="badge bg-info">002 ì‹ ê·œì…ì‚¬ì</span>
            {% endif %}
        {% else %}
            <span class="badge bg-primary">001 ê·¼ê³¨ê²©ê³„</span>
        {% endif %}
    </h2>
    
    <!-- ê¸°ë³¸ ì •ë³´ -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">ê¸°ë³¸ ì •ë³´</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <strong>ì œì¶œì¼ì‹œ:</strong><br>
                    {{ survey.created_at.strftime('%Y-%m-%d %H:%M:%S') if survey.created_at else '-' }}
                </div>
                <div class="col-md-3">
                    <strong>ì‚¬ë²ˆ:</strong><br>
                    {{ survey.employee_number or '-' }}
                </div>
                <div class="col-md-3">
                    <strong>ì´ë¦„:</strong><br>
                    {{ survey.name }}
                </div>
                <div class="col-md-3">
                    <strong>ë‚˜ì´:</strong><br>
                    {{ survey.age }}ì„¸
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-3">
                    <strong>ì„±ë³„:</strong><br>
                    {{ survey.gender or '-' }}
                </div>
                <div class="col-md-3">
                    <strong>ë¶€ì„œ:</strong><br>
                    {{ survey.department or '-' }}
                </div>
                <div class="col-md-3">
                    <strong>ì§ìœ„:</strong><br>
                    {{ survey.position or '-' }}
                </div>
                <div class="col-md-3">
                    <strong>ê·¼ë¬´ê²½ë ¥:</strong><br>
                    {% if survey.work_years or survey.work_months %}
                        {{ survey.work_years or 0 }}ë…„ {{ survey.work_months or 0 }}ê°œì›”
                    {% else %}
                        -
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Form 001 ê·¼ê³¨ê²©ê³„ ê´€ë ¨ ì •ë³´ -->
    {% if not survey.form_type or '001' in (survey.form_type or '') %}
    <div class="card mb-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0">ì‘ì—… ì •ë³´</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>ì‘ì—…í˜•íƒœ:</strong><br>
                    {{ survey.work_type or '-' }}
                </div>
                <div class="col-md-4">
                    <strong>1ì¼ ê·¼ë¬´ì‹œê°„:</strong><br>
                    {{ survey.work_hours_per_day or '-' }}ì‹œê°„
                </div>
                <div class="col-md-4">
                    <strong>íœ´ì‹ì‹œê°„:</strong><br>
                    {{ survey.break_time_minutes or '-' }}ë¶„
                </div>
            </div>
            {% if survey.work_posture %}
            <hr>
            <div class="row">
                <div class="col-12">
                    <strong>ì‘ì—… ìì„¸:</strong><br>
                    {{ survey.work_posture }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- ì¦ìƒ ì •ë³´ -->
    <div class="card mb-4">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0">ì¦ìƒ ì •ë³´</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>ë¶€ìœ„</th>
                            <th>í†µì¦ì •ë„</th>
                            <th>ì¦ìƒ</th>
                            <th>ë¹ˆë„</th>
                            <th>ì§€ì†ê¸°ê°„</th>
                            <th>ê°•ë„</th>
                            <th>ì—…ë¬´ì˜í–¥</th>
                            <th>ì§€ë‚œ1ë…„</th>
                            <th>ì§€ë‚œ1ì£¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ëª©/ì–´ê¹¨ -->
                        <tr>
                            <td><strong>ëª©/ì–´ê¹¨</strong></td>
                            <td>
                                {% if survey.responses and survey.responses.data and survey.responses.data.symptom_parts %}
                                    {% if "ëª©/ì–´ê¹¨" in survey.responses.data.symptom_parts %}
                                        {{ survey.responses.data.symptom_severity or '-' }}
                                    {% else %}
                                        -
                                    {% endif %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>ì¦ìƒìˆìŒ</td>
                            <td>-</td>
                            <td>-</td>
                            <td>{{ survey.responses.data.symptom_severity if survey.responses and survey.responses.data else '-' }}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <!-- í—ˆë¦¬ -->
                        <tr>
                            <td><strong>í—ˆë¦¬</strong></td>
                            <td>
                                {% if survey.responses and survey.responses.data and survey.responses.data.symptom_parts %}
                                    {% if "í—ˆë¦¬" in survey.responses.data.symptom_parts %}
                                        {{ survey.responses.data.symptom_severity or '-' }}
                                    {% else %}
                                        -
                                    {% endif %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>ì¦ìƒìˆìŒ</td>
                            <td>-</td>
                            <td>-</td>
                            <td>{{ survey.responses.data.symptom_severity if survey.responses and survey.responses.data else '-' }}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <!-- ë‹¤ë¦¬/ë°œ -->
                        <tr>
                            <td><strong>ë‹¤ë¦¬/ë°œ</strong></td>
                            <td>
                                {% if survey.responses and survey.responses.data and survey.responses.data.symptom_parts %}
                                    {% if "ë‹¤ë¦¬/ë°œ" in survey.responses.data.symptom_parts %}
                                        {{ survey.responses.data.symptom_severity or '-' }}
                                    {% else %}
                                        -
                                    {% endif %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>ì¦ìƒìˆìŒ</td>
                            <td>-</td>
                            <td>-</td>
                            <td>{{ survey.responses.data.symptom_severity if survey.responses and survey.responses.data else '-' }}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <!-- ì‘ì—…í™˜ê²½ ì •ë³´ -->
                        <tr>
                            <td><strong>ì‘ì—…í™˜ê²½</strong></td>
                            <td colspan="8">
                                {% if survey.responses and survey.responses.data %}
                                    ê·¼ë¬´ì‹œê°„: {{ survey.responses.data.daily_hours or '-' }}ì‹œê°„<br>
                                    ì‘ì—…í™˜ê²½: {{ survey.responses.data.work_environment or '-' }}<br>
                                    ì¦ìƒì—¬ë¶€: {{ 'ìˆìŒ' if survey.responses.data.has_symptoms else 'ì—†ìŒ' }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Form 002 ì‹ ê·œì…ì‚¬ì ê´€ë ¨ ì •ë³´ -->
    {% if survey.form_type and '002' in survey.form_type %}
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">ì‹ ì²´ ì •ë³´</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <strong>ì‹ ì¥:</strong><br>
                    {{ survey.height_cm or '-' }} cm
                </div>
                <div class="col-md-3">
                    <strong>ì²´ì¤‘:</strong><br>
                    {{ survey.weight_kg or '-' }} kg
                </div>
                <div class="col-md-3">
                    <strong>BMI:</strong><br>
                    {% if survey.height_cm and survey.weight_kg %}
                        {{ ((survey.weight_kg / ((survey.height_cm/100) ** 2)) | round(1)) }}
                    {% else %}
                        -
                    {% endif %}
                </div>
                <div class="col-md-3">
                    <strong>í˜ˆì•¡í˜•:</strong><br>
                    {{ survey.blood_type or '-' }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0">ê±´ê°• ì´ë ¥</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-12 mb-3">
                    <strong>ê¸°ì¡´ ì§ˆí™˜:</strong><br>
                    {{ survey.existing_conditions or 'ì—†ìŒ' }}
                </div>
                <div class="col-md-12 mb-3">
                    <strong>ë³µìš© ì•½ë¬¼:</strong><br>
                    {{ survey.medication_history or 'ì—†ìŒ' }}
                </div>
                <div class="col-md-12">
                    <strong>ì•Œë ˆë¥´ê¸° ì´ë ¥:</strong><br>
                    {{ survey.allergy_history or 'ì—†ìŒ' }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ì„¤ë¬¸ ì‘ë‹µ ë°ì´í„° (ì œì¶œí•œ ê·¸ëŒ€ë¡œ) -->
    {% if survey.responses %}
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">ğŸ“ ì„¤ë¬¸ ì œì¶œ ë°ì´í„° (ì›ë³¸)</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th style="width: 30%;">í•­ëª©</th>
                            <th>ì‘ë‹µ ë‚´ìš©</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in survey.responses.items() %}
                            {% if key not in ['csrf_token'] %}
                            <tr>
                                <td><strong>{{ key }}</strong></td>
                                <td>
                                    {% if value is iterable and value is not string %}
                                        {% if key == 'musculo_details' %}
                                            <!-- ê·¼ê³¨ê²©ê³„ ìƒì„¸ ë°ì´í„° íŠ¹ë³„ í‘œì‹œ -->
                                            {% for detail in value %}
                                            <div class="border p-2 mb-2">
                                                <strong>ë¶€ìœ„:</strong> {{ detail.part or '-' }}<br>
                                                <strong>ì¸¡ë©´:</strong> {{ detail.side or '-' }}<br>
                                                <strong>ì§€ì†ê¸°ê°„:</strong> {{ detail.duration or '-' }}<br>
                                                <strong>ì‹¬ê°ë„:</strong> {{ detail.severity or '-' }}<br>
                                                <strong>ë¹ˆë„:</strong> {{ detail.frequency or '-' }}<br>
                                                <strong>ì§€ë‚œì£¼:</strong> {{ detail.last_week or '-' }}<br>
                                                <strong>ê²°ê³¼:</strong> {{ detail.consequences|join(', ') if detail.consequences else '-' }}
                                            </div>
                                            {% endfor %}
                                        {% else %}
                                            {{ value|join(', ') if value else '-' }}
                                        {% endif %}
                                    {% else %}
                                        {{ value or '-' }}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- JSON ì›ë³¸ ë°ì´í„°ë„ í‘œì‹œ -->
            <details class="mt-3">
                <summary><strong>JSON ì›ë³¸ ë°ì´í„° ë³´ê¸°</strong></summary>
                <pre class="bg-light p-3 mt-2"><code>{{ survey.responses|tojson(indent=2) }}</code></pre>
            </details>
        </div>
    </div>
    {% endif %}

    <!-- ì‘ì—… ë²„íŠ¼ -->
    <div class="mb-5">
        <a href="{{ url_for('admin.survey') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
        </a>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="bi bi-printer"></i> ì¸ì‡„
        </button>
    </div>
</div>
{% endblock %}