{% extends "base.html" %}

{% block title %}근골격계부담작업 유해요인조사 - {{ app_name }}{% endblock %}

{% block extra_head %}{% endblock %}

{% block extra_css %}
<style>
    /* === SafeWork 설문 통합 디자인 시스템 === */
    :root {
        --sw-primary: #6366f1;
        --sw-primary-light: #a5b4fc;
        --sw-primary-dark: #4f46e5;
        --sw-secondary: #64748b;
        --sw-success: #10b981;
        --sw-warning: #f59e0b;
        --sw-danger: #ef4444;
        --sw-white: #ffffff;
        --sw-gray-50: #f8fafc;
        --sw-gray-100: #f1f5f9;
        --sw-gray-200: #e2e8f0;
        --sw-gray-600: #475569;
        --sw-gray-900: #1e293b;
    }
    
    /* 전체 컨테이너 */
    .survey-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(to bottom, #ffffff, #f8f9fa);
    }
    
    /* 헤더 섹션 */
    .survey-header {
        background: linear-gradient(135deg, var(--sw-primary), var(--sw-primary-dark));
        color: white;
        padding: 40px 30px;
        border-radius: 16px 16px 0 0;
        margin: -20px -20px 30px -20px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
    }
    
    .survey-header h1 {
        font-size: 2rem;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    .survey-header p {
        font-size: 1.1rem;
        opacity: 0.95;
        margin-bottom: 0;
    }
    
    /* 섹션 카드 */
    .section-card {
        background: white;
        border-radius: 12px;
        padding: 28px;
        margin-bottom: 24px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(99, 102, 241, 0.1);
        position: relative;
        overflow: hidden;
    }
    
    .section-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--sw-primary), var(--sw-primary-light));
    }
    
    /* 섹션 제목 */
    .section-title {
        color: var(--sw-gray-900);
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 24px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--sw-primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title i {
        color: var(--sw-primary);
    }
    
    /* 폼 그룹 */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        color: var(--sw-gray-900);
        font-weight: 600;
        font-size: 0.95rem;
    }
    
    .form-label .required {
        color: var(--sw-danger);
        margin-left: 4px;
    }
    
    /* 입력 필드 */
    .form-control {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
        background: white;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--sw-primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    /* 체크박스 그룹 */
    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 10px;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        background: var(--sw-gray-50);
        border-radius: 8px;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .checkbox-item:hover {
        background: white;
        border-color: var(--sw-primary-light);
    }
    
    .checkbox-item input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
        cursor: pointer;
    }
    
    .checkbox-item label {
        cursor: pointer;
        margin: 0;
        color: var(--sw-gray-900);
    }
    
    /* 라디오 그룹 */
    .radio-group {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    
    .radio-item {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        background: var(--sw-gray-50);
        border-radius: 8px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .radio-item:hover {
        background: white;
        border-color: var(--sw-primary-light);
    }
    
    .radio-item input[type="radio"]:checked + label {
        color: var(--sw-primary);
        font-weight: 600;
    }
    
    .radio-item input[type="radio"] {
        margin-right: 8px;
        width: 18px;
        height: 18px;
        cursor: pointer;
    }
    
    .radio-item label {
        cursor: pointer;
        margin: 0;
    }
    
    /* 테이블 스타일 */
    .assessment-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .assessment-table th {
        background: var(--sw-gray-100);
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: var(--sw-gray-900);
        border: 1px solid var(--sw-gray-200);
    }
    
    .assessment-table td {
        padding: 12px;
        border: 1px solid var(--sw-gray-200);
        background: white;
    }
    
    .assessment-table tr:hover td {
        background: var(--sw-gray-50);
    }
    
    /* 점수 입력 필드 */
    .score-input {
        width: 80px;
        padding: 8px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        text-align: center;
        font-size: 1rem;
        font-weight: 600;
    }
    
    .score-input:focus {
        outline: none;
        border-color: var(--sw-primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    /* 위험도 표시 */
    .risk-level {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 10px;
    }
    
    .risk-low {
        background: #d1fae5;
        color: #065f46;
    }
    
    .risk-medium {
        background: #fed7aa;
        color: #92400e;
    }
    
    .risk-high {
        background: #fee2e2;
        color: #991b1b;
    }
    
    /* 도움말 텍스트 */
    .help-text {
        display: block;
        margin-top: 6px;
        font-size: 0.875rem;
        color: var(--sw-gray-600);
        line-height: 1.5;
    }
    
    /* 알림 박스 */
    .info-box {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        border-left: 4px solid #3b82f6;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .info-box h4 {
        color: #1e40af;
        margin-bottom: 8px;
        font-weight: 600;
    }
    
    .info-box p {
        color: #1e40af;
        margin: 0;
        line-height: 1.6;
    }
    
    /* 제출 버튼 */
    .submit-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid var(--sw-gray-200);
        text-align: center;
    }
    
    .btn-submit {
        background: linear-gradient(135deg, var(--sw-primary), var(--sw-primary-dark));
        color: white;
        border: none;
        padding: 14px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }
    
    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }
    
    .btn-submit:active {
        transform: translateY(0);
    }
    
    /* 반응형 디자인 */
    @media (max-width: 768px) {
        .survey-container {
            padding: 15px;
        }
        
        .survey-header {
            padding: 30px 20px;
        }
        
        .survey-header h1 {
            font-size: 1.5rem;
        }
        
        .checkbox-group {
            grid-template-columns: 1fr;
        }
        
        .radio-group {
            flex-direction: column;
        }
        
        .assessment-table {
            font-size: 0.9rem;
        }
        
        .assessment-table th,
        .assessment-table td {
            padding: 8px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="survey-container">
    <div class="survey-header">
        <h1><i class="bi bi-clipboard-data"></i> 근골격계부담작업 유해요인조사</h1>
        <p>산업안전보건기준에 관한 규칙 제657조 (유해요인조사 및 개선)</p>
    </div>
    
    <form id="musculoskeletalProgramForm" method="POST">
        <!-- 기본 정보 섹션 -->
        <div class="section-card">
            <h2 class="section-title">
                <i class="bi bi-person-badge"></i> 기본 정보
            </h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="company_name" class="form-label">
                            사업장명 <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="company_name" name="company_name" required>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="department" class="form-label">
                            부서/공정 <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="department" name="department" required>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="job_name" class="form-label">
                            작업명 <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="job_name" name="job_name" required>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="worker_count" class="form-label">
                            작업자 수 <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="worker_count" name="worker_count" min="1" required>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="survey_date" class="form-label">
                            조사일자 <span class="required">*</span>
                        </label>
                        <input type="date" class="form-control" id="survey_date" name="survey_date" required>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 작업 특성 평가 섹션 -->
        <div class="section-card">
            <h2 class="section-title">
                <i class="bi bi-gear-fill"></i> 작업 특성 평가
            </h2>
            
            <div class="info-box">
                <h4><i class="bi bi-info-circle"></i> 평가 안내</h4>
                <p>각 항목별로 해당하는 작업 특성을 체크하고, 빈도 및 강도를 평가해주세요.</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">1. 반복적인 동작</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="repetitive_none" name="repetitive_motion" value="0">
                        <label for="repetitive_none">없음</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="repetitive_low" name="repetitive_motion" value="1">
                        <label for="repetitive_low">낮음 (시간당 2회 미만)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="repetitive_medium" name="repetitive_motion" value="2">
                        <label for="repetitive_medium">중간 (시간당 2-10회)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="repetitive_high" name="repetitive_motion" value="3">
                        <label for="repetitive_high">높음 (시간당 10회 초과)</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">2. 부적절한 작업자세</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_neck" name="inappropriate_posture[]" value="neck_bend">
                        <label for="posture_neck">목 굽힘/비틀림</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_shoulder" name="inappropriate_posture[]" value="shoulder_raise">
                        <label for="posture_shoulder">어깨 들어올림</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_elbow" name="inappropriate_posture[]" value="elbow_bend">
                        <label for="posture_elbow">팔꿈치 굽힘</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_wrist" name="inappropriate_posture[]" value="wrist_bend">
                        <label for="posture_wrist">손목 굽힘/비틀림</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_back" name="inappropriate_posture[]" value="back_bend">
                        <label for="posture_back">허리 굽힘/비틀림</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="posture_squat" name="inappropriate_posture[]" value="squat">
                        <label for="posture_squat">쪼그려 앉기</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">3. 과도한 힘</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="force_none" name="excessive_force" value="0">
                        <label for="force_none">없음</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="force_light" name="excessive_force" value="1">
                        <label for="force_light">가벼움 (2kg 미만)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="force_medium" name="excessive_force" value="2">
                        <label for="force_medium">보통 (2-10kg)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="force_heavy" name="excessive_force" value="3">
                        <label for="force_heavy">무거움 (10kg 초과)</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">4. 진동</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="vibration_none" name="vibration" value="0">
                        <label for="vibration_none">없음</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="vibration_hand" name="vibration" value="1">
                        <label for="vibration_hand">국소진동 (손/팔)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="vibration_whole" name="vibration" value="2">
                        <label for="vibration_whole">전신진동</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">5. 접촉 스트레스</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_palm" name="contact_stress[]" value="palm">
                        <label for="contact_palm">손바닥</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_finger" name="contact_stress[]" value="finger">
                        <label for="contact_finger">손가락</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_wrist" name="contact_stress[]" value="wrist">
                        <label for="contact_wrist">손목</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_elbow" name="contact_stress[]" value="elbow">
                        <label for="contact_elbow">팔꿈치</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_knee" name="contact_stress[]" value="knee">
                        <label for="contact_knee">무릎</label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 위험도 평가 섹션 -->
        <div class="section-card">
            <h2 class="section-title">
                <i class="bi bi-exclamation-triangle-fill"></i> 위험도 평가
            </h2>
            
            <table class="assessment-table">
                <thead>
                    <tr>
                        <th>평가 항목</th>
                        <th>빈도 (0-3점)</th>
                        <th>강도 (0-3점)</th>
                        <th>지속시간 (0-3점)</th>
                        <th>총점</th>
                        <th>위험수준</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>반복 작업</td>
                        <td><input type="number" class="score-input" name="repeat_frequency" min="0" max="3" onchange="calculateRisk('repeat')"></td>
                        <td><input type="number" class="score-input" name="repeat_intensity" min="0" max="3" onchange="calculateRisk('repeat')"></td>
                        <td><input type="number" class="score-input" name="repeat_duration" min="0" max="3" onchange="calculateRisk('repeat')"></td>
                        <td><span id="repeat_total">0</span></td>
                        <td><span id="repeat_risk" class="risk-level risk-low">낮음</span></td>
                    </tr>
                    <tr>
                        <td>부적절한 자세</td>
                        <td><input type="number" class="score-input" name="posture_frequency" min="0" max="3" onchange="calculateRisk('posture')"></td>
                        <td><input type="number" class="score-input" name="posture_intensity" min="0" max="3" onchange="calculateRisk('posture')"></td>
                        <td><input type="number" class="score-input" name="posture_duration" min="0" max="3" onchange="calculateRisk('posture')"></td>
                        <td><span id="posture_total">0</span></td>
                        <td><span id="posture_risk" class="risk-level risk-low">낮음</span></td>
                    </tr>
                    <tr>
                        <td>과도한 힘</td>
                        <td><input type="number" class="score-input" name="force_frequency" min="0" max="3" onchange="calculateRisk('force')"></td>
                        <td><input type="number" class="score-input" name="force_intensity" min="0" max="3" onchange="calculateRisk('force')"></td>
                        <td><input type="number" class="score-input" name="force_duration" min="0" max="3" onchange="calculateRisk('force')"></td>
                        <td><span id="force_total">0</span></td>
                        <td><span id="force_risk" class="risk-level risk-low">낮음</span></td>
                    </tr>
                    <tr>
                        <td>진동</td>
                        <td><input type="number" class="score-input" name="vibration_frequency" min="0" max="3" onchange="calculateRisk('vibration')"></td>
                        <td><input type="number" class="score-input" name="vibration_intensity" min="0" max="3" onchange="calculateRisk('vibration')"></td>
                        <td><input type="number" class="score-input" name="vibration_duration" min="0" max="3" onchange="calculateRisk('vibration')"></td>
                        <td><span id="vibration_total">0</span></td>
                        <td><span id="vibration_risk" class="risk-level risk-low">낮음</span></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="info-box mt-4">
                <h4>위험수준 기준</h4>
                <p>• 낮음 (0-3점): 현 상태 유지, 주기적 모니터링<br>
                • 중간 (4-6점): 개선 권고, 6개월 내 재평가<br>
                • 높음 (7-9점): 즉시 개선 필요, 의학적 관리 고려</p>
            </div>
        </div>
        
        <!-- 개선 계획 섹션 -->
        <div class="section-card">
            <h2 class="section-title">
                <i class="bi bi-tools"></i> 개선 계획
            </h2>
            
            <div class="form-group">
                <label class="form-label">공학적 개선방법</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_automation" name="engineering_improvements[]" value="automation">
                        <label for="eng_automation">자동화 도입</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_tool" name="engineering_improvements[]" value="tool_improvement">
                        <label for="eng_tool">작업도구 개선</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_height" name="engineering_improvements[]" value="height_adjustment">
                        <label for="eng_height">작업대 높이 조절</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_support" name="engineering_improvements[]" value="support_device">
                        <label for="eng_support">지지대/보조기구 설치</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_layout" name="engineering_improvements[]" value="layout_change">
                        <label for="eng_layout">작업장 레이아웃 변경</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eng_vibration" name="engineering_improvements[]" value="vibration_reduction">
                        <label for="eng_vibration">진동 저감장치</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">관리적 개선방법</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_rotation" name="management_improvements[]" value="job_rotation">
                        <label for="mgmt_rotation">작업 순환</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_rest" name="management_improvements[]" value="rest_time">
                        <label for="mgmt_rest">휴식시간 확대</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_stretch" name="management_improvements[]" value="stretching">
                        <label for="mgmt_stretch">스트레칭 프로그램</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_education" name="management_improvements[]" value="education">
                        <label for="mgmt_education">작업자 교육</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_pace" name="management_improvements[]" value="work_pace">
                        <label for="mgmt_pace">작업속도 조절</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mgmt_team" name="management_improvements[]" value="team_work">
                        <label for="mgmt_team">2인 1조 작업</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="improvement_notes" class="form-label">
                    추가 개선사항 및 의견
                </label>
                <textarea class="form-control" id="improvement_notes" name="improvement_notes" rows="4" 
                          placeholder="구체적인 개선 계획이나 추가 의견을 작성해주세요."></textarea>
            </div>
        </div>
        
        <!-- 조사자 정보 섹션 -->
        <div class="section-card">
            <h2 class="section-title">
                <i class="bi bi-person-check-fill"></i> 조사자 정보
            </h2>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="investigator_name" class="form-label">
                            조사자명 <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="investigator_name" name="investigator_name" required>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="investigator_position" class="form-label">
                            직책
                        </label>
                        <input type="text" class="form-control" id="investigator_position" name="investigator_position">
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="investigator_contact" class="form-label">
                            연락처
                        </label>
                        <input type="tel" class="form-control" id="investigator_contact" name="investigator_contact">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 제출 버튼 -->
        <div class="submit-section">
            <button type="submit" class="btn-submit">
                <i class="bi bi-send-fill"></i> 조사 결과 제출
            </button>
        </div>
    </form>
</div>

<script>
// 위험도 계산 함수
function calculateRisk(category) {
    const frequency = parseInt(document.querySelector(`input[name="${category}_frequency"]`).value) || 0;
    const intensity = parseInt(document.querySelector(`input[name="${category}_intensity"]`).value) || 0;
    const duration = parseInt(document.querySelector(`input[name="${category}_duration"]`).value) || 0;
    
    const total = frequency + intensity + duration;
    
    // 총점 업데이트
    document.getElementById(`${category}_total`).textContent = total;
    
    // 위험수준 판정 및 표시
    const riskElement = document.getElementById(`${category}_risk`);
    if (total <= 3) {
        riskElement.textContent = '낮음';
        riskElement.className = 'risk-level risk-low';
    } else if (total <= 6) {
        riskElement.textContent = '중간';
        riskElement.className = 'risk-level risk-medium';
    } else {
        riskElement.textContent = '높음';
        riskElement.className = 'risk-level risk-high';
    }
}

// 폼 제출 처리
document.getElementById('musculoskeletalProgramForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // 폼 유효성 검사
    if (!this.checkValidity()) {
        e.stopPropagation();
        this.classList.add('was-validated');
        return;
    }
    
    // 폼 데이터 수집
    const formData = new FormData(this);
    
    // 체크박스 배열 데이터 처리
    const checkboxGroups = ['inappropriate_posture', 'contact_stress', 'engineering_improvements', 'management_improvements'];
    checkboxGroups.forEach(group => {
        const checked = document.querySelectorAll(`input[name="${group}[]"]:checked`);
        const values = Array.from(checked).map(cb => cb.value);
        formData.set(group, JSON.stringify(values));
    });
    
    // 위험도 평가 데이터 추가
    const categories = ['repeat', 'posture', 'force', 'vibration'];
    categories.forEach(cat => {
        formData.append(`${cat}_total`, document.getElementById(`${cat}_total`).textContent);
        formData.append(`${cat}_risk`, document.getElementById(`${cat}_risk`).textContent);
    });
    
    // 제출
    this.submit();
});

// 오늘 날짜로 초기화
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('survey_date').value = today;
});
</script>
{% endblock %}